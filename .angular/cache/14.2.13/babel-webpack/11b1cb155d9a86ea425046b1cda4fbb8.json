{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { Fournitures } from 'src/app/components/models/fournitures';\nlet RapportExpertiseComponent = class RapportExpertiseComponent {\n  constructor(fb, expertService, sanitizer, fournitureService, cd) {\n    this.fb = fb;\n    this.expertService = expertService;\n    this.sanitizer = sanitizer;\n    this.fournitureService = fournitureService;\n    this.cd = cd;\n    this.actionLabel = 'Enregistrer';\n    this.documentDialog = false;\n    this.selectedDocuments = [];\n    this.cols = [];\n    this.rowsPerPageOptions = [5, 10, 20];\n    this.documents = [];\n    this.activeIndex = 0;\n    this.descriptionLength = 0; // Suivi du nombre de caractères\n\n    this.selectedFiles = [];\n    this.selectedPdfName = ''; // Stocke le nom du PDF\n\n    this.selectedPdf = null;\n    this.displayPdfDialog = false;\n    this.selectedExpert = null;\n    this.displayExpertDialog = false;\n    this.filteredFournitures = [];\n    this.selectedFourniture = null;\n    this.allFournitures = [];\n    this.showAddNewButton = false;\n    this.showFournitureForm = false;\n    this.filteredMainOeuvre = [];\n    this.selectedMainOeuvre = null;\n    this.allMainOeuvre = [];\n    this.showMainOeuvreForm = false;\n    this.showAddNewButtonMO = false;\n  }\n\n  ngOnInit() {\n    this.formGroup = this.fb.group({\n      fournitures: this.fb.array([]),\n      selectedFourniture: [null] // Ajout du contrôle pour l'autocomplete\n\n    });\n    this.mainOeuvreGroup = this.fb.group({\n      mainOeuvres: this.fb.array([]),\n      selectedMainOeuvre: [null] // Ajout du contrôle pour l'autocomplete\n\n    });\n    this.documentForm = this.fb.group({\n      assure: ['', Validators.required],\n      contratAssure: [''],\n      dossier: [''],\n      immatriculation: [''],\n      tiers: [''],\n      contratTiers: [''],\n      cieAdv: [''],\n      immatriculationTiers: [''],\n      dateExamen: [''],\n      vehExpertise: [''],\n      lieuExamen: [''],\n      marque: [''],\n      type: [''],\n      puissance: [''],\n      indexKm: [''],\n      genre: [''],\n      couleur: [''],\n      etatVeh: [''],\n      energie: [''],\n      numSerie: [''],\n      date1MC: [''],\n      circonstance: [''],\n      vn: [''],\n      vv: [''],\n      description: ['', [Validators.maxLength(999)]],\n      mandant: [''],\n      agence: [''],\n      dateAccident: [''],\n      fournitures: this.fb.array([]),\n      mainOeuvres: this.fb.array([]),\n      OuvDossier: [''],\n      enquête: [''],\n      Déplacements: [''],\n      Frais2èmeExp: [''],\n      Photos: [''],\n      FraisPTTAutres: [''],\n      Honoraires: [''],\n      references: [''],\n      nomExpert: [''],\n      emailExpert: [''],\n      nomSocieteExpert: [''],\n      adresseSocieteExpert: [''],\n      patente: [''],\n      images: this.fb.control([]),\n      expertId: ['']\n    });\n    const expertId = this.getUserId();\n\n    if (expertId) {\n      this.documentForm.patchValue({\n        expertId\n      }); // injecter dans le form\n    }\n\n    this.items = [{\n      label: 'Assuré'\n    }, {\n      label: 'Tiers'\n    }, {\n      label: 'Véhicule'\n    }, {\n      label: 'Infos de l\\'éxpert'\n    }, {\n      label: 'Infos'\n    }, {\n      label: 'Fournitures'\n    }, {\n      label: 'Main D\\'oeuve'\n    }, {\n      label: 'Décompte'\n    }, {\n      label: 'Images'\n    }];\n    this.loadRapports();\n    this.loadFournitures();\n  }\n\n  openNew() {\n    this.documentForm.reset(); // Réinitialiser le formulaire\n\n    this.documentDialog = true; // Affiche la boîte de dialogue\n\n    this.actionLabel = 'Enregistrer';\n  }\n\n  getUserId() {\n    return localStorage.getItem('user_id');\n  }\n\n  getUserRole() {\n    return localStorage.getItem('userRole');\n  }\n\n  onSubmit() {\n    if (this.documentForm.valid) {\n      // Appelez la fonction uploadImages pour envoyer les fichiers avant l'envoi du reste du formulaire\n      this.uploadImages().then(() => {\n        const expertId = this.getUserId();\n\n        if (expertId) {\n          this.documentForm.patchValue({\n            expertId\n          });\n        }\n\n        this.syncFournituresToDocumentForm();\n        this.syncMainOeuvresToDocumentForm(); // Une fois l'upload terminé, vous pouvez envoyer les autres données du formulaire\n\n        this.expertService.envoyerRapport(this.documentForm.value).subscribe({\n          next: response => {\n            var _a, _b; // Création de l'URL pour le Blob PDF\n\n\n            const link = document.createElement('a');\n            const url = window.URL.createObjectURL(response);\n            link.href = url;\n            const assureNom = ((_b = (_a = this.documentForm.get('assure')) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.toString().replace(/\\s+/g, '_')) || 'inconnu';\n            link.download = `rapport_expertise_${assureNom}.pdf`;\n            link.click(); // Déclenchement du téléchargement\n\n            window.URL.revokeObjectURL(url); // Libération de l'URL\n\n            const fournitures = this.documentForm.value.fournitures;\n\n            if (Array.isArray(fournitures)) {\n              fournitures.forEach((fournitureItem, index) => {\n                let fournitureId = null; // Cas 1 : l'objet contient un champ \"fourniture\" (objet ou string)\n\n                if (fournitureItem.fourniture) {\n                  fournitureId = typeof fournitureItem.fourniture === 'string' ? fournitureItem.fourniture : fournitureItem.fourniture._id;\n                } // Cas 2 : c'est directement la fourniture (id ou objet)\n                else if (fournitureItem.id) {\n                  fournitureId = fournitureItem.id;\n                }\n\n                if (!fournitureId) {\n                  console.warn(`Fourniture invalide ou manquante à l'index ${index}:`, fournitureItem);\n                  return;\n                }\n\n                const data = {\n                  fourniture: fournitureId,\n                  prix: fournitureItem.prix\n                };\n                this.fournitureService.addFournituresEval(data).subscribe({\n                  next: res => console.log('FournitureEval ajoutée:', res),\n                  error: err => console.error('Erreur ajout FournitureEval:', err)\n                });\n              });\n            }\n          },\n          error: err => {\n            console.error('Erreur lors de l’envoi', err);\n          }\n        });\n      }).catch(error => {\n        console.error('Erreur lors de l’upload des images', error);\n      });\n    }\n  }\n\n  onGlobalFilter(table, event) {\n    table.filterGlobal(event.target.value, 'contains');\n  }\n\n  onActiveIndexChange(index) {\n    this.activeIndex = index;\n  }\n\n  nextStep() {\n    if (this.activeIndex < this.items.length - 1) {\n      this.activeIndex++;\n    }\n  }\n\n  get fournitures() {\n    var _a, _b;\n\n    return ((_a = this.formGroup) === null || _a === void 0 ? void 0 : _a.get('fournitures')) || ((_b = this.documentForm) === null || _b === void 0 ? void 0 : _b.get('fournitures'));\n  }\n\n  removeFourniture(index) {\n    this.fournitures.removeAt(index);\n  }\n\n  get mainOeuvres() {\n    var _a;\n\n    return ((_a = this.mainOeuvreGroup) === null || _a === void 0 ? void 0 : _a.get('mainOeuvres')) || this.documentForm.get('mainOeuvres');\n  }\n\n  removeMainOeuvres(index) {\n    this.mainOeuvres.removeAt(index);\n  }\n\n  onDescriptionChange(event) {\n    this.descriptionLength = event.target.value.length; // Met à jour le compteur de caractères\n  }\n\n  onFileSelected(event) {\n    var _a;\n\n    const files = Array.from(event.target.files);\n    const existingFiles = ((_a = this.documentForm.get('images')) === null || _a === void 0 ? void 0 : _a.value) || []; // Ajouter les fichiers sélectionnés à ceux déjà présents\n\n    const updatedFiles = [...existingFiles, ...files]; // Mettez à jour la valeur du FormControl 'images'\n\n    this.documentForm.patchValue({\n      images: updatedFiles\n    });\n    console.log(\"Fichiers sélectionnés:\", updatedFiles);\n  }\n\n  removeFile(fileToRemove) {\n    var _a;\n\n    const currentFiles = ((_a = this.documentForm.get('images')) === null || _a === void 0 ? void 0 : _a.value) || [];\n    const updatedFiles = currentFiles.filter(file => file !== fileToRemove); // Mettez à jour la valeur du FormControl 'images' après suppression\n\n    this.documentForm.patchValue({\n      images: updatedFiles\n    });\n  }\n\n  uploadImages() {\n    return new Promise((resolve, reject) => {\n      var _a;\n\n      const formData = new FormData();\n      const files = (_a = this.documentForm.get('images')) === null || _a === void 0 ? void 0 : _a.value;\n\n      if (files && files.length > 0) {\n        files.forEach(file => {\n          formData.append('images', file);\n        }); // Envoi de la requête au backend pour l'upload des images\n\n        this.expertService.uploadImages(formData).subscribe(response => {\n          var _a;\n\n          console.log('Réponse upload images:', response);\n\n          if (response.files && Array.isArray(response.files)) {\n            (_a = this.documentForm.get('images')) === null || _a === void 0 ? void 0 : _a.setValue(response.files);\n          }\n\n          resolve(response);\n        }, error => {\n          console.error('Erreur upload images:', error);\n          reject(error);\n        });\n      }\n    });\n  }\n\n  loadRapports() {\n    const userRole = this.getUserRole();\n    const userId = this.getUserId();\n\n    if (userRole === 'expert' && userId) {\n      this.expertService.getRapportsByExpert(userId).subscribe(data => {\n        this.documents = data;\n      });\n    } else if (userRole === 'admin' || userRole === 'gestionnaire_sinistre') {\n      this.expertService.getAllRapports().subscribe(data => {\n        this.documents = data;\n      });\n    }\n  }\n\n  openPdf(pdfPath) {\n    if (!pdfPath) {\n      console.error(\"Aucun chemin de PDF fourni !\");\n      return;\n    }\n\n    const fullPath = `http://localhost:9090/pdf/${pdfPath}`;\n    this.selectedPdf = this.sanitizer.bypassSecurityTrustResourceUrl(fullPath);\n    this.selectedPdfName = pdfPath;\n    this.displayPdfDialog = true;\n  }\n\n  showExpertInfo(expertId) {\n    console.log(\"ID de l'expert reçu :\", expertId); // Vérification\n\n    if (!expertId) {\n      console.error(\"Aucun ID Expert fourni.\");\n      return;\n    }\n\n    this.expertService.getExpertById(expertId).subscribe(expert => {\n      console.log(\"Données de l'expert reçues :\", expert); // Vérification\n\n      this.selectedExpert = expert;\n      this.displayExpertDialog = true;\n    }, error => {\n      console.error(\"Erreur lors du chargement de l'expert :\", error);\n      this.selectedExpert = {\n        error: \"Erreur lors du chargement du client\"\n      };\n      this.displayExpertDialog = true;\n    });\n  }\n\n  loadFournitures() {\n    this.fournitureService.getFournitures().subscribe(data => {\n      this.allFournitures = data.map(f => new Fournitures(f._id, f.nom, f.type));\n      console.log('Fournitures chargées:', this.allFournitures);\n    });\n  }\n\n  searchFournitures(event) {\n    var _a, _b;\n\n    const query = event.query.toLowerCase().trim();\n    console.log('Recherche avec query:', query);\n    console.log('Nombre de fournitures disponibles:', ((_a = this.allFournitures) === null || _a === void 0 ? void 0 : _a.length) || 0); // Vérifier si allFournitures est défini\n\n    if (!this.allFournitures || this.allFournitures.length === 0) {\n      console.warn('La liste des fournitures est vide ou non définie');\n      this.filteredFournitures = [];\n      this.showAddNewButton = query.length > 0; // Afficher le bouton si on a tapé quelque chose\n\n      this.cd.detectChanges();\n      return;\n    } // Vérifier le format des données pour la première fourniture\n\n\n    if (this.allFournitures.length > 0) {\n      const firstItem = this.allFournitures[0];\n      console.log('Format de la première fourniture:', firstItem);\n    } // Filtrer avec vérification de nullité et casse\n\n\n    this.filteredFournitures = this.allFournitures.filter(f => {\n      // Vérification des propriétés pour éviter les erreurs\n      const type = (f.Type || f.Type || '').toLowerCase();\n      const nom = (f.Nom || f.Nom || '').toLowerCase(); // Corriger le filtrage du type (éviter la duplication)\n\n      const typeMatch = type === 'pieces' || type === 'pièces';\n      const nomMatch = nom.includes(query);\n      console.log(`Fourniture: ${nom}, Type: ${type}, TypeMatch: ${typeMatch}, NomMatch: ${nomMatch}`);\n      return typeMatch && nomMatch;\n    });\n    console.log('Fournitures filtrées:', this.filteredFournitures); // Si la requête a du contenu et qu'aucune fourniture exacte n'est trouvée\n\n    const hasExactMatch = this.filteredFournitures.some(f => {\n      const nom = (f.Nom || f.Nom || '').toLowerCase();\n      return nom === query;\n    }); // Afficher le bouton si on a une requête et pas de match exact\n\n    this.showAddNewButton = query.length > 0 && !hasExactMatch;\n    console.log('Query length:', query.length);\n    console.log('Has exact match:', hasExactMatch);\n    console.log('Show add button:', this.showAddNewButton); // Mettre à jour la valeur du formControl pour refléter la recherche\n\n    if (query.length > 0 && this.showAddNewButton) {\n      (_b = this.formGroup.get('selectedFourniture')) === null || _b === void 0 ? void 0 : _b.setValue(query);\n    }\n\n    this.cd.detectChanges();\n  }\n\n  onFournitureSelect(event) {\n    var _a;\n\n    const fourniture = event.value; // Récupérer la fourniture de l'événement\n\n    this.showAddNewButton = false;\n    this.showFournitureForm = true; // Ajouter la fourniture sélectionnée au FormArray\n\n    this.fournitures.push(this.fb.group({\n      id: [fourniture.Id],\n      nom: [fourniture.Nom, Validators.required],\n      prix: ['', [Validators.required, Validators.min(0)]],\n      remise: ['', [Validators.min(0), Validators.max(100)]],\n      VET: ['', [Validators.min(0), Validators.max(100)]],\n      tva: [false]\n    })); // Effacer la sélection après avoir ajouté\n\n    (_a = this.formGroup.get('selectedFourniture')) === null || _a === void 0 ? void 0 : _a.setValue(null);\n  }\n\n  onFournitureClear() {\n    var _a;\n\n    this.showAddNewButton = false;\n    (_a = this.formGroup.get('selectedFourniture')) === null || _a === void 0 ? void 0 : _a.setValue(null);\n  }\n\n  addNewFourniture() {\n    var _a;\n\n    const selectedValue = (_a = this.formGroup.get('selectedFourniture')) === null || _a === void 0 ? void 0 : _a.value;\n    console.log('selectedValue:', selectedValue); // Afficher la valeur sélectionnée\n\n    if (selectedValue) {\n      // Si selectedValue est une chaîne ou un objet avec une propriété nom\n      const nomFourniture = typeof selectedValue === 'string' ? selectedValue : selectedValue.nom || '';\n      console.log('nomFourniture:', nomFourniture); // Afficher le nom de la fourniture\n\n      if (nomFourniture) {\n        // Afficher immédiatement le formulaire\n        this.showFournitureForm = true; // AJOUTER IMMÉDIATEMENT AU FORMULAIRE AVANT L'APPEL API\n\n        const tempFormGroup = this.fb.group({\n          id: [null],\n          nom: [nomFourniture, Validators.required],\n          prix: ['', [Validators.required, Validators.min(0)]],\n          remise: ['', [Validators.min(0), Validators.max(100)]],\n          VET: ['', [Validators.min(0), Validators.max(100)]],\n          tva: [false]\n        });\n        console.log('tempFormGroup avant ajout:', tempFormGroup.value); // Afficher les valeurs du FormGroup avant l'ajout\n        // Ajouter au formulaire avant l'appel API\n\n        this.fournitures.push(tempFormGroup);\n        console.log('fournitures après ajout:', this.fournitures.value); // Afficher le tableau des fournitures après ajout\n        // Garder l'index pour une mise à jour ultérieure\n\n        const newIndex = this.fournitures.length - 1; // Créer une nouvelle fourniture dans la base de données\n\n        const newFourniture = {\n          nom: nomFourniture,\n          type: 'Pieces'\n        };\n        console.log('newFourniture avant appel API:', newFourniture); // Afficher la fourniture avant l'appel API\n\n        this.fournitureService.addFournitures(newFourniture).subscribe(result => {\n          var _a, _b;\n\n          console.log('Résultat brut API:', result); // Mapper le résultat pour correspondre à ton modèle\n\n          const mappedResult = {\n            _id: result.id,\n            nom: result.nom,\n            type: result.type\n          }; // Ajouter la nouvelle fourniture à la liste locale\n\n          this.allFournitures.push(mappedResult); // Mettre à jour l'ID dans le FormGroup\n\n          (_a = this.fournitures.at(newIndex).get('id')) === null || _a === void 0 ? void 0 : _a.setValue(mappedResult._id);\n          this.showAddNewButton = false;\n          (_b = this.formGroup.get('selectedFourniture')) === null || _b === void 0 ? void 0 : _b.setValue(null);\n          console.log('fournitures après mise à jour de l\\'ID:', this.fournitures.value);\n        }, error => {\n          console.error('Erreur lors de l\\'ajout de la fourniture:', error);\n          this.fournitures.removeAt(newIndex);\n          this.showFournitureForm = this.fournitures.length > 0;\n        });\n      }\n    }\n  } // Méthode pour synchroniser les fournitures entre formGroup et documentForm\n\n\n  syncFournituresToDocumentForm() {\n    const documentFournitures = this.documentForm.get('fournitures'); // Vider le tableau existant\n\n    while (documentFournitures.length) {\n      documentFournitures.removeAt(0);\n    } // Ajouter les FormGroup actuels de fournitures avec leurs valeurs mises à jour\n\n\n    this.fournitures.controls.forEach(fg => {\n      var _a, _b, _c, _d, _e, _f;\n\n      const fournitureForm = fg;\n      documentFournitures.push(this.fb.group({\n        id: [(_a = fournitureForm.get('id')) === null || _a === void 0 ? void 0 : _a.value],\n        nom: [(_b = fournitureForm.get('nom')) === null || _b === void 0 ? void 0 : _b.value],\n        prix: [(_c = fournitureForm.get('prix')) === null || _c === void 0 ? void 0 : _c.value],\n        remise: [(_d = fournitureForm.get('remise')) === null || _d === void 0 ? void 0 : _d.value],\n        VET: [(_e = fournitureForm.get('VET')) === null || _e === void 0 ? void 0 : _e.value],\n        tva: [(_f = fournitureForm.get('tva')) === null || _f === void 0 ? void 0 : _f.value]\n      }));\n    });\n    console.log('fournitures après synchronisation avec documentForm:', documentFournitures.value);\n  }\n\n  addNewMainOeuvre() {\n    var _a;\n\n    const selectedValue = (_a = this.mainOeuvreGroup.get('selectedMainOeuvre')) === null || _a === void 0 ? void 0 : _a.value;\n    console.log('selectedValue:', selectedValue);\n\n    if (selectedValue) {\n      const nomMainOeuvre = typeof selectedValue === 'string' ? selectedValue : selectedValue.nom || '';\n      console.log('nomMainOeuvre:', nomMainOeuvre);\n\n      if (nomMainOeuvre) {\n        this.showMainOeuvreForm = true;\n        const tempFormGroup = this.fb.group({\n          id: [null],\n          nom: [nomMainOeuvre, Validators.required],\n          prix: ['', [Validators.required, Validators.min(0)]],\n          R: ['', [Validators.required, Validators.min(0)]],\n          tva: [false]\n        });\n        console.log('tempFormGroup avant ajout:', tempFormGroup.value);\n        this.mainOeuvres.push(tempFormGroup);\n        const newIndex = this.mainOeuvres.length - 1;\n        const newMainOeuvre = {\n          nom: nomMainOeuvre,\n          type: 'MainsDoeuvre' // ✅ Spécifier le type main d’œuvre ici\n\n        };\n        console.log('newMainOeuvre avant appel API:', newMainOeuvre);\n        this.fournitureService.addFournitures(newMainOeuvre).subscribe(result => {\n          var _a, _b;\n\n          console.log('Résultat de l\\'API:', result);\n          this.allMainOeuvre.push(result);\n          (_a = this.mainOeuvres.at(newIndex).get('id')) === null || _a === void 0 ? void 0 : _a.setValue(result.Id);\n          this.showAddNewButtonMO = false;\n          (_b = this.mainOeuvreGroup.get('selectedMainOeuvre')) === null || _b === void 0 ? void 0 : _b.setValue(null);\n          console.log('mainOeuvres après mise à jour de l\\'ID:', this.mainOeuvres.value);\n        }, error => {\n          console.error('Erreur lors de l\\'ajout de la fourniture:', error);\n          this.mainOeuvres.removeAt(newIndex);\n          this.showFournitureForm = this.mainOeuvres.length > 0;\n        });\n      }\n    }\n  }\n\n  searchMainOeuvres(event) {\n    var _a, _b;\n\n    const query = event.query.toLowerCase();\n    console.log('Recherche avec query:', query);\n    console.log('Nombre de fournitures disponibles:', ((_a = this.allFournitures) === null || _a === void 0 ? void 0 : _a.length) || 0); // Vérifier si allFournitures est défini\n\n    if (!this.allFournitures || this.allFournitures.length === 0) {\n      console.warn('La liste des fournitures est vide ou non définie');\n      this.filteredMainOeuvre = [];\n      return;\n    } // Vérifier le format des données pour la première fourniture\n\n\n    if (this.allFournitures.length > 0) {\n      const firstItem = this.allFournitures[0];\n      console.log('Format de la première fourniture:', firstItem);\n    } // Filtrer avec vérification de nullité et casse\n\n\n    this.filteredMainOeuvre = this.allFournitures.filter(f => {\n      // Vérification des propriétés pour éviter les erreurs\n      const type = f.Type || '';\n      const nom = f.Nom || '';\n      const typeMatch = type.toLowerCase() === 'mainsdoeuvre' || type.toLowerCase() === 'mainsdoeuvre';\n      const nomMatch = nom.toLowerCase().includes(query);\n      return typeMatch && nomMatch;\n    });\n    console.log('Fournitures filtrées:', this.filteredMainOeuvre); // Si la requête a du contenu et qu'aucune fourniture exacte n'est trouvée\n\n    const hasExactMatch = this.filteredMainOeuvre.some(f => (f.Nom || '').toLowerCase() === query.toLowerCase());\n    this.showAddNewButtonMO = query.length > 0 && !hasExactMatch; // Mettre à jour la valeur du formControl pour refléter la recherche\n\n    if (query.length > 0 && this.showAddNewButtonMO) {\n      (_b = this.mainOeuvreGroup.get('selectedMainOeuvre')) === null || _b === void 0 ? void 0 : _b.setValue(query);\n    }\n\n    this.cd.detectChanges();\n  }\n\n  onMainOeuvresSelect(event) {\n    var _a;\n\n    const mainOeuvre = event.value; // Récupérer la fourniture de l'événement\n\n    this.showAddNewButtonMO = false;\n    this.showMainOeuvreForm = true; // Ajouter la fourniture sélectionnée au FormArray\n\n    this.mainOeuvres.push(this.fb.group({\n      id: [mainOeuvre.Id],\n      nom: [mainOeuvre.Nom, Validators.required],\n      prix: ['', [Validators.required, Validators.min(0)]],\n      R: ['', [Validators.required, Validators.min(0)]],\n      tva: [false]\n    })); // Effacer la sélection après avoir ajouté\n\n    (_a = this.mainOeuvreGroup.get('selectedMainOeuvre')) === null || _a === void 0 ? void 0 : _a.setValue(null);\n  }\n\n  onMainOeuvresClear() {\n    var _a;\n\n    this.showAddNewButtonMO = false;\n    (_a = this.mainOeuvreGroup.get('selectedMainOeuvre')) === null || _a === void 0 ? void 0 : _a.setValue(null);\n  }\n\n  syncMainOeuvresToDocumentForm() {\n    const documentMainOeuvres = this.documentForm.get('mainOeuvres'); // Vider le tableau existant\n\n    while (documentMainOeuvres.length) {\n      documentMainOeuvres.removeAt(0);\n    } // Ajouter les FormGroup actuels de mainOeuvres avec leurs valeurs mises à jour\n\n\n    this.mainOeuvres.controls.forEach(fg => {\n      var _a, _b, _c, _d, _e;\n\n      const mainOeuvreForm = fg;\n      documentMainOeuvres.push(this.fb.group({\n        id: [(_a = mainOeuvreForm.get('id')) === null || _a === void 0 ? void 0 : _a.value],\n        nom: [(_b = mainOeuvreForm.get('nom')) === null || _b === void 0 ? void 0 : _b.value],\n        prix: [(_c = mainOeuvreForm.get('prix')) === null || _c === void 0 ? void 0 : _c.value],\n        R: [(_d = mainOeuvreForm.get('R')) === null || _d === void 0 ? void 0 : _d.value],\n        tva: [(_e = mainOeuvreForm.get('tva')) === null || _e === void 0 ? void 0 : _e.value]\n      }));\n    });\n    console.log('mainOeuvres après synchronisation avec documentForm:', documentMainOeuvres.value);\n  }\n\n};\nRapportExpertiseComponent = __decorate([Component({\n  selector: 'app-rapport-expertise',\n  templateUrl: './rapport-expertise.component.html',\n  styleUrl: './rapport-expertise.component.scss'\n})], RapportExpertiseComponent);\nexport { RapportExpertiseComponent };","map":null,"metadata":{},"sourceType":"module"}