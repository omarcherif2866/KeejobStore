{"ast":null,"code":"import { Logiciel } from 'src/app/models/logiciel';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/logiciel.service\";\nexport let LogicielComponent = /*#__PURE__*/(() => {\n  class LogicielComponent {\n    constructor(logicielService) {\n      this.logicielService = logicielService;\n      this.showAddNew = true; // Afficher le bouton \"Ajouter nouveau\"\n\n      this.showSelection = true; // Afficher la grille de sÃ©lection\n      // Liste de tous les logiciels disponibles\n\n      this.allLogiciels = []; // Logiciels dÃ©jÃ  associÃ©s Ã  cette sous-formation\n\n      this.selectedLogiciels = []; // Pour le formulaire d'ajout\n\n      this.showAddModal = false;\n      this.newLogiciel = {\n        title: '',\n        description: '',\n        image: ''\n      };\n      this.selectedImage = null;\n      this.loading = false;\n    }\n\n    ngOnInit() {\n      console.log('ðŸš€ LogicielComponent initialisÃ© avec sousFormationId:', this.sousFormationId);\n      this.loadAllLogiciels();\n      this.loadSelectedLogiciels();\n    } // âœ… CHARGER TOUS LES LOGICIELS DISPONIBLES\n\n\n    loadAllLogiciels() {\n      this.loading = true;\n      this.logicielService.getLogiciel().subscribe({\n        next: data => {\n          this.allLogiciels = data.map(l => new Logiciel(l.id, l.title, l.description, l.image));\n          this.loading = false;\n          console.log('âœ… Logiciels chargÃ©s:', this.allLogiciels);\n        },\n        error: err => {\n          console.error('âŒ Erreur chargement logiciels:', err);\n          this.loading = false;\n        }\n      });\n    } // âœ… CHARGER LES LOGICIELS DÃ‰JÃ€ ASSOCIÃ‰S Ã€ CETTE SOUS-FORMATION\n    // loadSelectedLogiciels() {\n    //   this.logicielService.getLogicielsBySousFormation(this.sousFormationId).subscribe({\n    //     next: (data: any[]) => {\n    //       this.selectedLogiciels = data.map(l => ({\n    //         id: l.id,\n    //         title: l.title,\n    //         image: l.image\n    //       }));\n    //       console.log('âœ… Logiciels dÃ©jÃ  associÃ©s:', this.selectedLogiciels);\n    //     },\n    //     error: (err) => {\n    //       console.error('âŒ Erreur chargement logiciels associÃ©s:', err);\n    //     }\n    //   });\n    // }\n    // âœ… OUVRIR LE MODAL POUR AJOUTER UN NOUVEAU LOGICIEL\n\n\n    openAddModal() {\n      this.showAddModal = true;\n      this.newLogiciel = {\n        title: '',\n        description: '',\n        image: ''\n      };\n      this.selectedImage = null;\n    } // âœ… FERMER LE MODAL\n\n\n    closeAddModal() {\n      this.showAddModal = false;\n      this.newLogiciel = {\n        title: '',\n        description: '',\n        image: ''\n      };\n      this.selectedImage = null;\n    } // âœ… GÃ‰RER LA SÃ‰LECTION D'IMAGE\n\n\n    onImageSelected(event) {\n      const file = event.target.files[0];\n\n      if (file) {\n        if (!file.type.startsWith('image/')) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'Veuillez sÃ©lectionner une image valide',\n            timer: 1500\n          });\n          return;\n        }\n\n        if (file.size > 5 * 1024 * 1024) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'L\\'image ne doit pas dÃ©passer 5MB',\n            timer: 1500\n          });\n          return;\n        }\n\n        this.selectedImage = file;\n      }\n    } // âœ… CRÃ‰ER UN NOUVEAU LOGICIEL ET L'ASSOCIER Ã€ LA SOUS-FORMATION\n\n\n    createNewLogiciel() {\n      if (!this.newLogiciel.title || !this.newLogiciel.description) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Attention',\n          text: 'Veuillez remplir tous les champs',\n          timer: 2000\n        });\n        return;\n      }\n\n      if (!this.selectedImage) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Attention',\n          text: 'Veuillez sÃ©lectionner une image',\n          timer: 2000\n        });\n        return;\n      }\n\n      const fd = new FormData();\n      fd.append('title', this.newLogiciel.title);\n      fd.append('description', this.newLogiciel.description);\n      fd.append('image', this.selectedImage, this.selectedImage.name);\n      fd.append('sousFormationId', this.sousFormationId.toString());\n      this.logicielService.addLogiciel(fd).subscribe({\n        next: res => {\n          Swal.fire({\n            icon: 'success',\n            title: 'Logiciel crÃ©Ã©!',\n            text: 'Le logiciel a Ã©tÃ© crÃ©Ã© et associÃ© Ã  la sous-formation',\n            timer: 2000,\n            showConfirmButton: false\n          });\n          this.closeAddModal();\n          this.loadAllLogiciels();\n          this.loadSelectedLogiciels();\n        },\n        error: err => {\n          console.error('âŒ Erreur crÃ©ation logiciel:', err);\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'Impossible de crÃ©er le logiciel',\n            timer: 2000\n          });\n        }\n      });\n    } // âœ… TOGGLE SÃ‰LECTION D'UN LOGICIEL EXISTANT\n\n\n    toggleLogiciel(logiciel) {\n      const index = this.selectedLogiciels.findIndex(l => l.id === logiciel.Id);\n\n      if (index >= 0) {\n        // DÃ©sassocier\n        this.logicielService.removeLogicielFromSousFormation(this.sousFormationId, logiciel.Id).subscribe({\n          next: () => {\n            this.selectedLogiciels.splice(index, 1);\n            Swal.fire({\n              icon: 'success',\n              title: 'Logiciel retirÃ©',\n              timer: 1500,\n              showConfirmButton: false\n            });\n          },\n          error: err => {\n            console.error('âŒ Erreur retrait logiciel:', err);\n          }\n        });\n      } else {\n        // Associer\n        this.logicielService.addLogicielToSousFormation(this.sousFormationId, logiciel.Id).subscribe({\n          next: () => {\n            this.selectedLogiciels.push({\n              id: logiciel.Id,\n              title: logiciel.Title,\n              image: logiciel.Image\n            });\n            Swal.fire({\n              icon: 'success',\n              title: 'Logiciel ajoutÃ©',\n              timer: 1500,\n              showConfirmButton: false\n            });\n          },\n          error: err => {\n            console.error('âŒ Erreur ajout logiciel:', err);\n          }\n        });\n      }\n    } // âœ… VÃ‰RIFIER SI UN LOGICIEL EST SÃ‰LECTIONNÃ‰\n\n\n    isSelected(logiciel) {\n      return this.selectedLogiciels.some(l => l.id === logiciel.Id);\n    } // âœ… SANITIZE IMAGE URL (comme dans formation-keejob)\n\n\n    sanitizeImage(url) {\n      if (!url) return '';\n\n      if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n        const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n        return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n      }\n\n      return url;\n    }\n\n  }\n\n  LogicielComponent.Éµfac = function LogicielComponent_Factory(t) {\n    return new (t || LogicielComponent)(i0.ÉµÉµdirectiveInject(i1.LogicielService));\n  };\n\n  LogicielComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n    type: LogicielComponent,\n    selectors: [[\"app-logiciel\"]],\n    inputs: {\n      sousFormationId: \"sousFormationId\",\n      showAddNew: \"showAddNew\",\n      showSelection: \"showSelection\"\n    },\n    decls: 0,\n    vars: 0,\n    template: function LogicielComponent_Template(rf, ctx) {}\n  });\n  return LogicielComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}