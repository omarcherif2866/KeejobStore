{"ast":null,"code":"import { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { BehaviorSubject, throwError } from 'rxjs';\nimport { tap, catchError } from 'rxjs/operators';\nimport { JwtHelperService } from '@auth0/angular-jwt';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(httpClient) {\n      this.httpClient = httpClient;\n      this.apiUrl = \"http://localhost:8090/api/auth\";\n      this.localStorageKey = \"userAuth\"; // Clé pour le localStorage\n\n      this.loggedIn = new BehaviorSubject(false);\n      this.jwtHelper = new JwtHelperService();\n      const userData = localStorage.getItem(this.localStorageKey);\n\n      if (userData) {\n        const parsedData = JSON.parse(userData);\n        this.loggedIn.next(!!parsedData.accessToken); // Initialiser l'état de connexion\n      }\n    }\n\n    get isLoggedIn() {\n      return this.loggedIn.asObservable();\n    }\n\n    login(loginData) {\n      return this.httpClient.post(`${this.apiUrl}/login`, loginData).pipe(tap(response => {\n        // Sauvegarder l'utilisateur et le token dans le localStorage\n        localStorage.setItem(this.localStorageKey, JSON.stringify(response));\n        this.loggedIn.next(true);\n      }), catchError(error => {\n        // Gérer les erreurs ici si nécessaire\n        console.error(\"Erreur de connexion:\", error);\n        return throwError(error); // Relancer l'erreur pour que le composant traitant puisse la gérer\n      }));\n    }\n\n    logout() {\n      // Supprimer l'utilisateur et le token du localStorage lors de la déconnexion\n      localStorage.removeItem(this.localStorageKey);\n    }\n\n    addUser(user) {\n      return this.httpClient.post(this.apiUrl + \"/register\", user);\n    }\n\n    getToken() {\n      // Récupérer le token JWT depuis le localStorage\n      const currentUser = localStorage.getItem(this.localStorageKey);\n      return currentUser ? JSON.parse(currentUser).accessToken : null;\n    }\n\n    getRoleFromToken(token) {\n      if (!token) {\n        return \"vide\"; // Ou une autre valeur par défaut appropriée\n      }\n\n      const decodedToken = this.decodeToken(token);\n      return decodedToken ? decodedToken.role : \"\";\n    }\n\n    decodeToken(token) {\n      if (!token) {\n        return null; // Ou une valeur par défaut appropriée\n      }\n\n      const tokenPayload = token.split('.')[1];\n      const decodedPayload = JSON.parse(atob(tokenPayload));\n      return decodedPayload;\n    }\n\n    getUserIdFromToken() {\n      const token = localStorage.getItem('accessToken');\n\n      if (token && !this.jwtHelper.isTokenExpired(token)) {\n        const decodedToken = this.jwtHelper.decodeToken(token);\n        return decodedToken.id; // Suppose que l'ID est stocké dans le token sous 'id'\n      }\n\n      return null;\n    }\n\n    storeUserIdFromToken() {\n      const token = localStorage.getItem('accessToken');\n\n      if (token && !this.jwtHelper.isTokenExpired(token)) {\n        const decodedToken = this.jwtHelper.decodeToken(token);\n        const userId = decodedToken.id; // Supposant que 'id' est la clé dans le token JWT contenant l'ID utilisateur\n\n        localStorage.setItem('userId', userId.toString());\n      }\n    } // Méthode pour récupérer l'ID utilisateur depuis localStorage\n\n\n    getUserId() {\n      const userId = localStorage.getItem('userId');\n      return userId ? +userId : null; // Convertir en nombre si trouvé dans localStorage\n    }\n\n    updateUser(id, user) {\n      return this.httpClient.put(`http://localhost:8090/api/auth/${id}`, user, {\n        headers: new HttpHeaders().set('Content-Type', 'application/json')\n      });\n    }\n\n  }\n\n  AuthService.ɵfac = function AuthService_Factory(t) {\n    return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  AuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AuthService,\n    factory: AuthService.ɵfac,\n    providedIn: 'root'\n  });\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module"}