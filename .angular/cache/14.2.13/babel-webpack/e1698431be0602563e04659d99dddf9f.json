{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Actualite } from 'src/app/components/models/actualite';\nimport { Validators } from '@angular/forms';\nlet ActualiteComponent = class ActualiteComponent {\n  constructor(actualiteService, messageService, fb) {\n    this.actualiteService = actualiteService;\n    this.messageService = messageService;\n    this.fb = fb;\n    this.displayModal = false;\n    this.selectedDescription = '';\n    this.actualiteDialog = false;\n    this.actionLabel = 'Enregistrer';\n    this.deleteActualiteDialog = false;\n    this.actualites = [];\n    this.selectedActualites = [];\n    this.submitted = false;\n    this.uploadedFiles = [];\n    this.cols = [];\n    this.rowsPerPageOptions = [5, 10, 20];\n  }\n\n  ngOnInit() {\n    this.actualite = new Actualite('', '', '', '');\n    this.uploadedFiles = [];\n    this.getAllActualites();\n    this.initForm();\n  }\n\n  initForm() {\n    this.actualiteForm = this.fb.group({\n      nom: ['', Validators.required],\n      description: ['', Validators.required],\n      image: [null]\n    });\n  }\n\n  showFullDescription(description) {\n    this.selectedDescription = description;\n    this.displayModal = true;\n  }\n\n  openNew() {\n    this.actualite = new Actualite('', '', '', '');\n    this.submitted = false;\n    this.actualiteDialog = true;\n    this.actionLabel = 'Enregistrer';\n  }\n\n  editActualite(actualite) {\n    const actualiteInstance = new Actualite(actualite._id, actualite.nom, actualite.description, actualite.image);\n\n    if (actualiteInstance && actualiteInstance.Id) {\n      this.actualiteDialog = true;\n      this.actualite = actualiteInstance;\n    }\n\n    this.actionLabel = 'Modifier';\n  }\n\n  deleteActualite(actualite) {\n    const actualiteInstance = new Actualite(actualite._id, actualite.nom, actualite.description, actualite.image);\n\n    if (actualiteInstance && actualiteInstance.Id) {\n      this.deleteActualiteDialog = true;\n      this.actualite = actualiteInstance;\n    } else {\n      console.error('actualite object is missing ID:', actualiteInstance);\n    }\n  }\n\n  confirmDelete() {\n    if (this.actualite && this.actualite.Id) {\n      this.actualiteService.deleteActualite(this.actualite.Id).subscribe(response => {\n        this.actualites = this.actualites.filter(val => val.Id !== this.actualite.Id);\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Actualite supprimé',\n          life: 3000\n        });\n        this.actualite = new Actualite('', '', '', '');\n        this.deleteActualiteDialog = false;\n      }, error => {\n        console.error('Erreur lors de la suppression du actualite:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur',\n          detail: 'Échec de la suppression du actualite',\n          life: 3000\n        });\n        this.deleteActualiteDialog = false;\n      });\n    } else {\n      console.error('ID de actualite invalide:', this.actualite);\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'ID de actualite invalide',\n        life: 3000\n      });\n      this.deleteActualiteDialog = false;\n    }\n  }\n\n  hideDialog() {\n    this.actualiteDialog = false;\n    this.submitted = false;\n  }\n\n  saveActualite() {\n    this.submitted = true; // Vérifier si le formulaire est valide\n\n    if (this.actualiteForm.invalid) {\n      return;\n    } // Créer un objet FormData pour envoyer les données\n\n\n    const actualiteData = new FormData(); // Ajouter les propriétés de base\n\n    actualiteData.append('nom', this.actualiteForm.get('nom').value);\n    actualiteData.append('description', this.actualiteForm.get('description').value); // Ajouter l'image si elle est sélectionnée\n\n    if (this.uploadedFiles && this.uploadedFiles.length > 0) {\n      actualiteData.append('image', this.uploadedFiles[0]);\n    } // Appeler le service pour ajouter l'actualite\n\n\n    this.actualiteService.addActualite(actualiteData).subscribe(response => {\n      this.messageService.add({\n        severity: 'success',\n        summary: 'Succès',\n        detail: 'Actualite ajouté avec succès'\n      });\n      this.actualiteDialog = false; // Fermer le dialogue\n\n      this.actualiteForm.reset(); // Réinitialiser le formulaire\n\n      window.location.reload(); // Recharger la page\n    }, error => {\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'Échec de l\\'ajout de l\\'actualite'\n      });\n    });\n  }\n\n  getAllActualites() {\n    this.actualiteService.getActualite().subscribe(actualites => {\n      this.actualites = actualites;\n    }, error => {\n      console.error('Erreur lors de la récupération des actualites:', error);\n    });\n  }\n\n  onGlobalFilter(table, event) {\n    table.filterGlobal(event.target.value, 'contains');\n  }\n\n  onFileSelected(event) {\n    if (event.files && event.files.length > 0) {\n      this.uploadedFiles = [];\n\n      for (let file of event.files) {\n        this.uploadedFiles.push(file);\n      }\n    } else {\n      console.error(\"Erreur lors de la sélection du fichier : la propriété 'files' n'est pas définie dans l'événement.\");\n    }\n  }\n\n  getImageUrl(imageName) {\n    return `${imageName}`;\n  }\n\n};\nActualiteComponent = __decorate([Component({\n  selector: 'app-actualite',\n  templateUrl: './actualite.component.html',\n  styleUrl: './actualite.component.scss'\n})], ActualiteComponent);\nexport { ActualiteComponent };","map":null,"metadata":{},"sourceType":"module"}