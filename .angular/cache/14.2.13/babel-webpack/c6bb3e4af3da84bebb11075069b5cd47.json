{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Agence, Gouvernorat } from 'src/app/components/models/agence';\nlet AgenceComponent = class AgenceComponent {\n  constructor(agenceService, messageService) {\n    this.agenceService = agenceService;\n    this.messageService = messageService;\n    this.displayModal = false; // Contrôle la visibilité du modal\n\n    this.agenceDialog = false;\n    this.actionLabel = 'Enregistrer';\n    this.deleteAgenceDialog = false;\n    this.agences = [];\n    this.selectedAgences = [];\n    this.submitted = false;\n    this.cols = [];\n    this.rowsPerPageOptions = [5, 10, 20];\n    this.gouvernoratOptions = [];\n  }\n\n  ngOnInit() {\n    this.agence = new Agence('', '', '', '', '', '', '');\n    this.getAllAgences();\n    this.getGouvernaurat();\n  }\n\n  openNew() {\n    this.agence = new Agence('', '', '', '', '', '', '');\n    this.submitted = false;\n    this.agenceDialog = true;\n    this.actionLabel = 'Enregistrer';\n  }\n\n  editAgence(agence) {\n    const agenceInstance = new Agence(agence._id, agence.nom, agence.chefAgence, agence.email, agence.numero, agence.adresse, agence.gouvernorat);\n\n    if (agenceInstance && agenceInstance.Id) {\n      this.agenceDialog = true;\n      this.agence = agenceInstance;\n    }\n\n    this.actionLabel = 'Modifier';\n  }\n\n  deleteAgence(agence) {\n    const agenceInstance = new Agence(agence._id, agence.nom, agence.chefAgence, agence.email, agence.numero, agence.adresse, agence.gouvernorat);\n\n    if (agenceInstance && agenceInstance.Id) {\n      this.deleteAgenceDialog = true;\n      this.agence = agenceInstance;\n    } else {\n      console.error('agence object is missing ID:', agenceInstance);\n    }\n  }\n\n  confirmDelete() {\n    if (this.agence && this.agence.Id) {\n      this.agenceService.deleteAgence(this.agence.Id).subscribe(response => {\n        this.agences = this.agences.filter(val => val.Id !== this.agence.Id);\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Agence supprimé',\n          life: 3000\n        });\n        this.deleteAgenceDialog = false;\n        setTimeout(() => {\n          window.location.reload();\n        }, 1000); // Rafraîchit la page après 1 seconde pour laisser voir le message\n      }, error => {\n        console.error('Erreur lors de la suppression de l\\'agence:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur',\n          detail: 'Échec de la suppression de l\\'agence',\n          life: 3000\n        });\n        this.deleteAgenceDialog = false;\n      });\n    } else {\n      console.error('ID de l\\'agence invalide:', this.agence);\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'ID de l\\'agence invalide',\n        life: 3000\n      });\n      this.deleteAgenceDialog = false;\n    }\n  }\n\n  hideDialog() {\n    this.agenceDialog = false;\n    this.submitted = false;\n  }\n\n  saveAgence() {\n    // Créer un objet agence à envoyer en JSON\n    const agenceData = {\n      nom: this.agence.Nom,\n      chefAgence: this.agence.ChefAgence,\n      email: this.agence.Email,\n      numero: this.agence.Numero,\n      adresse: this.agence.Adresse,\n      gouvernorat: this.agence.Gouvernorat\n    }; // Vérifiez les données dans la console pour vous assurer qu'elles sont bien formatées\n\n    console.log(agenceData);\n\n    if (this.agence.Id) {\n      // Mise à jour du agence existant\n      this.agenceService.putAgence(this.agence.Id, agenceData).subscribe(res => {\n        this.agenceDialog = false;\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Succès',\n          detail: 'Agence mis à jour',\n          life: 3000\n        });\n        this.getAllAgences();\n      }, error => {\n        console.error('Erreur lors de la mise à jour du agence:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur lors de la mise à jour du agence',\n          detail: error.message\n        });\n      });\n    } else {\n      // Ajouter un nouveau agence\n      this.agenceService.addAgence(agenceData).subscribe(res => {\n        this.agenceDialog = false;\n        this.agence = new Agence('', '', '', '', '', '', '');\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Succès',\n          detail: 'Agence ajouté',\n          life: 3000\n        });\n        this.getAllAgences();\n      }, error => {\n        console.error('Erreur lors de l\\'ajout du agence:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur lors de l\\'ajout du agence',\n          detail: error.message\n        });\n      });\n    }\n  }\n\n  getAllAgences() {\n    this.agenceService.getAgence().subscribe(agences => {\n      this.agences = agences;\n    }, error => {\n      console.error('Erreur lors de la récupération des agences:', error);\n    });\n  }\n\n  onGlobalFilter(table, event) {\n    table.filterGlobal(event.target.value, 'contains');\n  }\n\n  getGouvernaurat() {\n    this.gouvernoratOptions = Object.values(Gouvernorat).map(gouv => ({\n      label: gouv,\n      value: gouv // La valeur stockée dans `agence.Gouvernorat`\n\n    }));\n  }\n\n};\nAgenceComponent = __decorate([Component({\n  selector: 'app-agence',\n  templateUrl: './agence.component.html',\n  styleUrl: './agence.component.scss'\n})], AgenceComponent);\nexport { AgenceComponent };","map":null,"metadata":{},"sourceType":"module"}