{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { Emloyees } from 'src/app/components/models/emloyees';\nlet GestionnaireComponent = class GestionnaireComponent {\n  constructor(fb, employeeService, messageService) {\n    this.fb = fb;\n    this.employeeService = employeeService;\n    this.messageService = messageService;\n    this.employeeDialog = false;\n    this.deleteEmployeeDialog = false;\n    this.employees = [];\n    this.uploadedFiles = [];\n    this.actionLabel = 'Enregistrer';\n    this.submitted = false;\n    this.selectedEmloyees = [];\n  }\n\n  ngOnInit() {\n    this.initForm();\n    this.getAllEmloyeess();\n  }\n\n  initForm() {\n    this.employeeForm = this.fb.group({\n      nom: ['', Validators.required],\n      prenom: ['', Validators.required],\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', [Validators.required, Validators.minLength(8), Validators.pattern('^(?=.*[A-Z])(?=.*\\\\d)(?=.*[@$!%*?&#])[A-Za-z\\\\d@$!%*?&#]{8,}$')]],\n      phoneNumber: ['', Validators.required],\n      poste: ['', Validators.required],\n      departement: ['', Validators.required],\n      image: [null]\n    });\n  }\n\n  openNew() {\n    this.employee = new Emloyees('', '', '', '', '', '', '', '', '');\n    this.employeeForm.reset();\n    this.employeeDialog = true;\n  }\n\n  editEmloyees(employee) {\n    const employeeInstance = new Emloyees(employee._id, employee.email, employee.image, employee.phoneNumber, employee.poste, employee.departement, employee.nom, employee.prenom, '');\n\n    if (employeeInstance && employeeInstance.Id) {\n      this.employeeDialog = true;\n      this.employee = employeeInstance;\n    }\n\n    this.employeeForm.patchValue({\n      nom: employee.nom,\n      prenom: employee.prenom,\n      email: employee.email,\n      phoneNumber: employee.phoneNumber,\n      poste: employee.poste,\n      departement: employee.departement,\n      password: '' // Optionnel : laisser vide\n\n    });\n    this.actionLabel = 'Modifier';\n  }\n\n  deleteEmloyees(employee) {\n    const employeeInstance = new Emloyees(employee._id, employee.email, employee.image, employee.phoneNumber, employee.poste, employee.departement, employee.nom, employee.prenom, '');\n\n    if (employeeInstance && employeeInstance.Id) {\n      this.deleteEmployeeDialog = true;\n      this.employee = employeeInstance;\n    } else {\n      console.error('employee object is missing ID:', employeeInstance);\n    }\n  }\n\n  confirmDelete() {\n    if (this.employee && this.employee.Id) {\n      this.employeeService.deleteEmloyees(this.employee.Id).subscribe(response => {\n        this.employees = this.employees.filter(val => val.Id !== this.employee.Id);\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Emloyees supprimé',\n          life: 3000\n        });\n        this.employee = new Emloyees('', '', '', '', '', '', '', '', '');\n        this.deleteEmployeeDialog = false;\n        window.location.reload();\n      }, error => {\n        console.error('Erreur lors de la suppression du employee:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur',\n          detail: 'Échec de la suppression du employee',\n          life: 3000\n        });\n        this.deleteEmployeeDialog = false;\n      });\n    } else {\n      console.error('ID de employee invalide:', this.employee);\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'ID de employee invalide',\n        life: 3000\n      });\n      this.deleteEmployeeDialog = false;\n    }\n  }\n\n  hideDialog() {\n    this.employeeDialog = false;\n    this.submitted = false;\n  }\n\n  onFileSelected(event) {\n    if (event.files && event.files.length > 0) {\n      this.uploadedFiles = [];\n\n      for (let file of event.files) {\n        this.uploadedFiles.push(file);\n      }\n    } else {\n      console.error(\"Erreur lors de la sélection du fichier : la propriété 'files' n'est pas définie dans l'événement.\");\n    }\n  }\n\n  getImageUrl(imageName) {\n    return `${imageName}`;\n  }\n\n  saveEmloyees() {\n    this.submitted = true; // Vérifier si le formulaire est valide\n\n    if (this.employeeForm.invalid) {\n      return;\n    } // Créer un objet FormData pour envoyer les données\n\n\n    const employeeData = new FormData(); // Ajouter les propriétés de base\n\n    employeeData.append('nom', this.employeeForm.get('nom').value);\n    employeeData.append('prenom', this.employeeForm.get('prenom').value);\n    employeeData.append('email', this.employeeForm.get('email').value);\n    employeeData.append('password', this.employeeForm.get('password').value);\n    employeeData.append('phoneNumber', this.employeeForm.get('phoneNumber').value);\n    employeeData.append('poste', this.employeeForm.get('poste').value);\n    employeeData.append('departement', this.employeeForm.get('departement').value); // Ajouter l'image si elle est sélectionnée\n\n    if (this.uploadedFiles && this.uploadedFiles.length > 0) {\n      employeeData.append('image', this.uploadedFiles[0]);\n    } // Appeler le service pour ajouter l'employee\n\n\n    this.employeeService.addEmloyees(employeeData).subscribe(response => {\n      this.messageService.add({\n        severity: 'success',\n        summary: 'Succès',\n        detail: 'Emloyees ajouté avec succès'\n      });\n      this.employeeDialog = false; // Fermer le dialogue\n\n      this.employeeForm.reset(); // Réinitialiser le formulaire\n\n      window.location.reload(); // Recharger la page\n    }, error => {\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'Échec de l\\'ajout de l\\'employee'\n      });\n    });\n  }\n\n  getAllEmloyeess() {\n    this.employeeService.getEmloyees().subscribe(employees => {\n      this.employees = employees;\n    }, error => {\n      console.error('Erreur lors de la récupération des employees:', error);\n    });\n  }\n\n  onGlobalFilter(table, event) {\n    table.filterGlobal(event.target.value, 'contains');\n  }\n\n};\nGestionnaireComponent = __decorate([Component({\n  selector: 'app-gestionnaire',\n  templateUrl: './gestionnaire.component.html',\n  styleUrl: './gestionnaire.component.scss'\n})], GestionnaireComponent);\nexport { GestionnaireComponent };","map":null,"metadata":{},"sourceType":"module"}