{"ast":null,"code":"// import { Component, OnInit } from '@angular/core';\n// import { Router } from '@angular/router';\n// import { Evaluation, EvaluationSection, Category } from 'src/app/models/evaluation';\n// import { AuthService } from 'src/app/services/auth.service';\n// import { EvaluationService } from 'src/app/services/evaluation.service';\n// import Swal from 'sweetalert2';\nimport { __decorate } from \"tslib\"; // @Component({\n//   selector: 'app-evaluation',\n//   templateUrl: './evaluation.component.html',\n//   styleUrls: ['./evaluation.component.css']\n// })\n// export class EvaluationComponent implements OnInit {\n//   sidebarOpen = true;\n//   evaluations: Evaluation[] = [];\n//   loading = false;\n//   currentPage = 1;\n//   itemsPerPage = 5;\n//   showModal = false;\n//   modalMode: 'add' | 'edit' = 'add';\n//   formData = {\n//     id: null as any,\n//     name: '',\n//     description: '',\n//     image: ''\n//   };\n//   editId: any = null;\n//   selectedImage: File | null = null;\n//   currentModalStep: number = 1;\n//   sections: EvaluationSection[] = [];\n//   // Enum et catégories disponibles\n//   categoryEnum = Category;\n//   availableCategories = Object.values(Category);\n//   customCategories: string[] = [];  // Pour les catégories personnalisées\n//   constructor(\n//     private evaluationservice: EvaluationService, \n//     private authService: AuthService,\n//     private router: Router\n//   ) {}\n//   ngOnInit() {\n//     this.fetchEvaluations();\n//   }\n//   private initializeSections() {\n//     this.sections = [\n//       { headline: '', subtitle: '', details: [] },\n//       { headline: '', subtitle: '', details: [] },\n//       { headline: '', subtitle: '', details: [] },\n//       { headline: '', subtitle: '', details: [] }\n//     ];\n//   }\n//   fetchEvaluations() {\n//     this.loading = true;\n//     this.evaluationservice.getEvaluation().subscribe({\n//       next: (response: any[]) => {\n//         this.evaluations = response.map(data => new Evaluation(data));\n//         this.loading = false;\n//         console.log('Données reçues: ', this.evaluations);\n//       },\n//       error: (error) => {\n//         console.error('Erreur lors du chargement des évaluations:', error);\n//         this.loading = false;\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors du chargement des données',\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     });\n//   }\n//   get currentItems(): Evaluation[] {\n//     const indexOfLastItem = this.currentPage * this.itemsPerPage;\n//     const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n//     return this.evaluations.slice(indexOfFirstItem, indexOfLastItem);\n//   }\n//   get totalPages(): number {\n//     return Math.ceil(this.evaluations.length / this.itemsPerPage);\n//   }\n//   get pagesArray(): number[] {\n//     return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n//   }\n//   handlePageChange(pageNumber: number) {\n//     this.currentPage = pageNumber;\n//   }\n//   handleAdd() {\n//     this.modalMode = 'add';\n//     this.formData = {\n//       id: null,\n//       name: '',\n//       description: '',\n//       image: ''\n//     };\n//     this.selectedImage = null;\n//     this.initializeSections();\n//     this.currentModalStep = 1;\n//     this.showModal = true;\n//   }\n//   handleEdit(evaluation: Evaluation) {\n//     this.modalMode = 'edit';\n//     this.formData = {\n//       id: evaluation.Id,\n//       name: evaluation.Name || '',\n//       description: evaluation.Description || '',\n//       image: evaluation.Image || ''\n//     };\n//     this.editId = evaluation.Id;\n//     this.selectedImage = null;\n//     if (evaluation.Sections && evaluation.Sections.length > 0) {\n//       this.sections = [...evaluation.Sections];\n//       while (this.sections.length < 4) {\n//         this.sections.push({ headline: '', subtitle: '', details: [] });\n//       }\n//     } else {\n//       this.initializeSections();\n//     }\n//     this.currentModalStep = 1;\n//     this.showModal = true;\n//   }\n//   closeModal() {\n//     this.showModal = false;\n//     this.formData = {\n//       id: null,\n//       name: '',\n//       description: '',\n//       image: ''\n//     };\n//     this.selectedImage = null;\n//     this.editId = null;\n//     this.sections = [];\n//     this.currentModalStep = 1;\n//   }\n//   handleDelete(id: any) {\n//     Swal.fire({\n//       title: 'Êtes-vous sûr?',\n//       text: \"Vous ne pourrez pas revenir en arrière!\",\n//       icon: 'warning',\n//       showCancelButton: true,\n//       confirmButtonColor: '#3085d6',\n//       cancelButtonColor: '#d33',\n//       confirmButtonText: 'Oui, supprimer!',\n//       cancelButtonText: 'Annuler'\n//     }).then((result) => {\n//       if (result.isConfirmed) {\n//         this.evaluationservice.deleteEvaluation(id).subscribe({\n//           next: () => {\n//             this.evaluations = this.evaluations.filter(item => item.Id !== id);\n//             Swal.fire({\n//               title: 'Supprimé!',\n//               text: 'Évaluation supprimée avec succès',\n//               icon: 'success',\n//               timer: 1500,\n//               showConfirmButton: false\n//             });\n//           },\n//           error: (error) => {\n//             console.error('Erreur lors de la suppression:', error);\n//             Swal.fire({\n//               icon: 'error',\n//               title: 'Erreur lors de la suppression',\n//               text: error.message || 'Une erreur est survenue',\n//               showConfirmButton: false,\n//               timer: 1500\n//             });\n//           }\n//         });\n//       }\n//     });\n//   }\n//   addDetailToSection(sectionIndex: number) {\n//     if (this.sections[sectionIndex]) {\n//       this.sections[sectionIndex].details.push({\n//         titre: '',\n//         description: '',\n//         icon: '',\n//         category: null  // Ajout du champ category\n//       });\n//     }\n//   }\n//   removeDetailFromSection(sectionIndex: number, detailIndex: number) {\n//     if (this.sections[sectionIndex] && this.sections[sectionIndex].details[detailIndex]) {\n//       Swal.fire({\n//         title: 'Supprimer ce détail?',\n//         text: \"Cette action est irréversible\",\n//         icon: 'warning',\n//         showCancelButton: true,\n//         confirmButtonColor: '#f44336',\n//         cancelButtonColor: '#666',\n//         confirmButtonText: 'Oui, supprimer',\n//         cancelButtonText: 'Annuler'\n//       }).then((result) => {\n//         if (result.isConfirmed) {\n//           this.sections[sectionIndex].details.splice(detailIndex, 1);\n//         }\n//       });\n//     }\n//   }\n//   // Ajouter une catégorie personnalisée\n//   addCustomCategory(sectionIndex: number, detailIndex: number) {\n//     Swal.fire({\n//       title: 'Ajouter une catégorie',\n//       input: 'text',\n//       inputPlaceholder: 'Nom de la catégorie',\n//       showCancelButton: true,\n//       confirmButtonText: 'Ajouter',\n//       cancelButtonText: 'Annuler',\n//       inputValidator: (value) => {\n//         if (!value) {\n//           return 'Veuillez entrer un nom de catégorie!';\n//         }\n//         return null;\n//       }\n//     }).then((result) => {\n//       if (result.isConfirmed && result.value) {\n//         const newCategory = result.value.trim();\n//         if (!this.customCategories.includes(newCategory)) {\n//           this.customCategories.push(newCategory);\n//         }\n//         this.sections[sectionIndex].details[detailIndex].category = newCategory as any;\n//       }\n//     });\n//   }\n//   // Obtenir toutes les catégories (prédéfinies + personnalisées)\n//   getAllCategories(): string[] {\n//     return [...this.availableCategories, ...this.customCategories];\n//   }\n//   handleSubmit() {\n//     if (!this.formData.name || !this.formData.description) {\n//       Swal.fire({\n//         icon: 'warning',\n//         title: 'Champs manquants',\n//         text: 'Veuillez remplir tous les champs obligatoires',\n//         timer: 2000,\n//         showConfirmButton: false\n//       });\n//       this.currentModalStep = 1;\n//       return;\n//     }\n//     if (this.modalMode === 'add' && !this.selectedImage) {\n//       Swal.fire({\n//         icon: 'warning',\n//         title: 'Image manquante',\n//         text: 'Veuillez sélectionner une image',\n//         timer: 2000,\n//         showConfirmButton: false\n//       });\n//       this.currentModalStep = 1;\n//       return;\n//     }\n//     // Vérifier que toutes les sections sont complètes\n//     // Category obligatoire seulement pour la section 4\n//     const incompleteSections = this.sections.filter((s, index) => {\n//       if (!s.headline || !s.subtitle || s.details.length === 0) {\n//         return true;\n//       }\n//       // Pour la section 4 (index 3), vérifier aussi la catégorie\n//       if (index === 3) {\n//         return s.details.some(d => !d.titre || !d.icon || !d.category);\n//       }\n//       // Pour les autres sections, catégorie n'est pas obligatoire\n//       return s.details.some(d => !d.titre || !d.icon);\n//     });\n//     if (incompleteSections.length > 0) {\n//       Swal.fire({\n//         icon: 'warning',\n//         title: 'Sections incomplètes',\n//         text: `Il reste ${incompleteSections.length} section(s) à compléter`,\n//         timer: 2000,\n//         showConfirmButton: false\n//       });\n//       return;\n//     }\n//     const formData = new FormData();\n//     formData.append('name', this.formData.name);\n//     formData.append('description', this.formData.description);\n//     const completedSections = this.sections.filter(s => \n//       s.headline && s.subtitle && s.details.length > 0\n//     );\n//     formData.append('sections', JSON.stringify(completedSections));\n//     if (this.selectedImage) {\n//       formData.append('image', this.selectedImage, this.selectedImage.name);\n//     }\n//     if (this.modalMode === 'add') {\n//       this.evaluationservice.addEvaluation(formData).subscribe({\n//         next: (response: any) => {\n//           const newEvaluation = new Evaluation({\n//             id: response.id,\n//             name: response.name,\n//             description: response.description,\n//             image: response.image,\n//             sections: response.sections || []\n//           });\n//           this.evaluations.push(newEvaluation);\n//           this.closeModal();\n//           Swal.fire({\n//             title: 'Succès!',\n//             text: 'Évaluation ajoutée avec succès',\n//             icon: 'success',\n//             timer: 1500,\n//             showConfirmButton: false\n//           }).then(() => {\n//             this.fetchEvaluations();\n//           });\n//         },\n//         error: (error) => {\n//           console.error('Erreur lors de l\\'ajout:', error);\n//           Swal.fire({\n//             icon: 'error',\n//             title: 'Erreur lors de l\\'ajout',\n//             text: error.message || 'Une erreur est survenue',\n//             showConfirmButton: false,\n//             timer: 1500\n//           });\n//         }\n//       });\n//     } else {\n//       this.evaluationservice.putEvaluation(this.editId, formData).subscribe({\n//         next: (response: any) => {\n//           const index = this.evaluations.findIndex(item => item.Id === this.editId);\n//           if (index !== -1) {\n//             this.evaluations[index] = new Evaluation({\n//               id: response.id,\n//               name: response.name,\n//               description: response.description,\n//               image: response.image,\n//               sections: response.sections || []\n//             });\n//           }\n//           this.closeModal();\n//           Swal.fire({\n//             title: 'Succès!',\n//             text: 'Évaluation modifiée avec succès',\n//             icon: 'success',\n//             timer: 1500,\n//             showConfirmButton: false\n//           }).then(() => {\n//             this.fetchEvaluations();\n//           });\n//         },\n//         error: (error) => {\n//           console.error('Erreur lors de la modification:', error);\n//           Swal.fire({\n//             icon: 'error',\n//             title: 'Erreur lors de la modification',\n//             text: error.message || 'Une erreur est survenue',\n//             showConfirmButton: false,\n//             timer: 1500\n//           });\n//         }\n//       });\n//     }\n//   }\n//   toggleSidebar() {\n//     this.sidebarOpen = !this.sidebarOpen;\n//   }\n//   logout(): void {\n//     this.authService.logout();\n//     Swal.fire({\n//       icon: 'info',\n//       title: 'Déconnexion',\n//       text: 'Vous êtes déconnecté',\n//       showConfirmButton: false,\n//       timer: 1500\n//     });\n//     this.router.navigate(['/']);\n//   }\n//   onImageSelected(event: any) {\n//     const file = event.target.files[0];\n//     if (file) {\n//       if (!file.type.startsWith('image/')) {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur',\n//           text: 'Veuillez sélectionner une image valide',\n//           timer: 1500,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//       if (file.size > 5 * 1024 * 1024) {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur',\n//           text: 'L\\'image ne doit pas dépasser 5MB',\n//           timer: 1500,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//       this.selectedImage = file;\n//     }\n//   }\n//   sanitizeImage(url: string | null): string {\n//     if (!url) return '';\n//     if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n//       const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n//       return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n//     }\n//     return url;\n//   }\n//   nextModalStep() {\n//     if (this.currentModalStep === 1) {\n//       if (!this.formData.name || !this.formData.description) {\n//         Swal.fire({\n//           icon: 'warning',\n//           title: 'Champs manquants',\n//           text: 'Veuillez remplir le nom et la description',\n//           timer: 2000,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//       if (this.modalMode === 'add' && !this.selectedImage) {\n//         Swal.fire({\n//           icon: 'warning',\n//           title: 'Image manquante',\n//           text: 'Veuillez sélectionner une image',\n//           timer: 2000,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//     }\n//     if (this.currentModalStep >= 2 && this.currentModalStep <= 5) {\n//       const sectionIndex = this.currentModalStep - 2;\n//       const section = this.sections[sectionIndex];\n//       if (!section.headline || !section.subtitle) {\n//         Swal.fire({\n//           icon: 'warning',\n//           title: 'Section incomplète',\n//           text: `Veuillez remplir les champs headline et subtitle de la section ${sectionIndex + 1}`,\n//           timer: 2000,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//       if (section.details.length === 0) {\n//         Swal.fire({\n//           icon: 'warning',\n//           title: 'Détails manquants',\n//           text: `Veuillez ajouter au moins un détail à la section ${sectionIndex + 1}`,\n//           timer: 2000,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//       // Vérification des champs - Category obligatoire SEULEMENT pour la section 4 (step 5)\n//       let missingFields;\n//       if (this.currentModalStep === 5) {\n//         // Section 4 : category est obligatoire\n//         missingFields = section.details.some(d => !d.titre || !d.description || !d.icon || !d.category);\n//       } else {\n//         // Sections 1, 2, 3 : category n'est pas obligatoire\n//         missingFields = section.details.some(d => !d.titre || !d.description || !d.icon);\n//       }\n//       if (missingFields) {\n//         const fieldsText = this.currentModalStep === 5 \n//           ? 'titre, description, icône et catégorie' \n//           : 'titre, description et icône';\n//         Swal.fire({\n//           icon: 'warning',\n//           title: 'Détails incomplets',\n//           text: `Veuillez remplir tous les champs (${fieldsText}) pour la section ${sectionIndex + 1}`,\n//           timer: 2000,\n//           showConfirmButton: false\n//         });\n//         return;\n//       }\n//     }\n//     if (this.currentModalStep < 5) {\n//       this.currentModalStep++;\n//     }\n//   }\n//   previousModalStep() {\n//     if (this.currentModalStep > 1) {\n//       this.currentModalStep--;\n//     }\n//   }\n//   goToModalStep(step: number) {\n//     if (step <= this.currentModalStep) {\n//       this.currentModalStep = step;\n//     }\n//   }\n//   countCompletedSections(): number {\n//     return this.sections.filter((s, index) => {\n//       if (!s.headline || !s.subtitle || s.details.length === 0) {\n//         return false;\n//       }\n//       // Pour la section 4 (index 3), vérifier aussi la catégorie\n//       if (index === 3) {\n//         return s.details.every(d => d.titre && d.description && d.icon && d.category);\n//       }\n//       // Pour les autres sections, catégorie n'est pas requise\n//       return s.details.every(d => d.titre && d.description && d.icon);\n//     }).length;\n//   }\n// }\n\nimport { Component } from '@angular/core';\nimport { Evaluation, Category } from 'src/app/models/evaluation';\nimport Swal from 'sweetalert2';\nlet EvaluationComponent = class EvaluationComponent {\n  constructor(evaluationservice, partenaireService, authService, router) {\n    this.evaluationservice = evaluationservice;\n    this.partenaireService = partenaireService;\n    this.authService = authService;\n    this.router = router;\n    this.sidebarOpen = true;\n    this.evaluations = [];\n    this.loading = false;\n    this.currentPage = 1;\n    this.itemsPerPage = 5;\n    this.showModal = false;\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      description: '',\n      image: ''\n    };\n    this.editId = null;\n    this.selectedImage = null;\n    this.currentModalStep = 1;\n    this.sections = []; // Enum et catégories disponibles\n\n    this.categoryEnum = Category;\n    this.availableCategories = Object.values(Category);\n    this.customCategories = []; // Partenaires\n\n    this.allPartenaires = [];\n    this.selectedPartenaires = []; // Catalogues\n\n    this.catalogues = [];\n  }\n\n  ngOnInit() {\n    this.fetchEvaluations();\n    this.fetchPartenaires();\n  }\n\n  fetchPartenaires() {\n    this.partenaireService.getPartenaire().subscribe({\n      next: response => {\n        this.allPartenaires = response;\n        console.log('Partenaires chargés:', this.allPartenaires);\n      },\n      error: error => {\n        console.error('Erreur lors du chargement des partenaires:', error);\n      }\n    });\n  }\n\n  initializeSections() {\n    this.sections = [{\n      headline: '',\n      subtitle: '',\n      details: []\n    }, {\n      headline: '',\n      subtitle: '',\n      details: []\n    }, {\n      headline: '',\n      subtitle: '',\n      details: []\n    }, {\n      headline: '',\n      subtitle: '',\n      details: []\n    }];\n  }\n\n  fetchEvaluations() {\n    this.loading = true;\n    this.evaluationservice.getEvaluation().subscribe({\n      next: response => {\n        this.evaluations = response.map(data => new Evaluation(data));\n        this.loading = false;\n        console.log('Données reçues: ', this.evaluations);\n      },\n      error: error => {\n        console.error('Erreur lors du chargement des évaluations:', error);\n        this.loading = false;\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors du chargement des données',\n          showConfirmButton: false,\n          timer: 1500\n        });\n      }\n    });\n  }\n\n  get currentItems() {\n    const indexOfLastItem = this.currentPage * this.itemsPerPage;\n    const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n    return this.evaluations.slice(indexOfFirstItem, indexOfLastItem);\n  }\n\n  get totalPages() {\n    return Math.ceil(this.evaluations.length / this.itemsPerPage);\n  }\n\n  get pagesArray() {\n    return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n  }\n\n  handlePageChange(pageNumber) {\n    this.currentPage = pageNumber;\n  }\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      description: '',\n      image: ''\n    };\n    this.selectedImage = null;\n    this.initializeSections();\n    this.selectedPartenaires = [];\n    this.catalogues = [];\n    this.currentModalStep = 1;\n    this.showModal = true;\n  }\n\n  handleEdit(evaluation) {\n    this.modalMode = 'edit';\n    this.formData = {\n      id: evaluation.Id,\n      name: evaluation.Name || '',\n      description: evaluation.Description || '',\n      image: evaluation.Image || ''\n    };\n    this.editId = evaluation.Id;\n    this.selectedImage = null;\n\n    if (evaluation.Sections && evaluation.Sections.length > 0) {\n      this.sections = [...evaluation.Sections];\n\n      while (this.sections.length < 4) {\n        this.sections.push({\n          headline: '',\n          subtitle: '',\n          details: []\n        });\n      }\n    } else {\n      this.initializeSections();\n    } // Charger les partenaires sélectionnés\n\n\n    this.selectedPartenaires = evaluation.Partenaires ? [...evaluation.Partenaires] : []; // Charger les catalogues existants\n\n    if (evaluation.Catalogues && evaluation.Catalogues.length > 0) {\n      this.catalogues = evaluation.Catalogues.map(cat => ({\n        title: cat.Title,\n        image: null,\n        imagePreview: cat.Image\n      }));\n    } else {\n      this.catalogues = [];\n    }\n\n    this.currentModalStep = 1;\n    this.showModal = true;\n  }\n\n  closeModal() {\n    this.showModal = false;\n    this.formData = {\n      id: null,\n      name: '',\n      description: '',\n      image: ''\n    };\n    this.selectedImage = null;\n    this.editId = null;\n    this.sections = [];\n    this.selectedPartenaires = [];\n    this.catalogues = [];\n    this.currentModalStep = 1;\n  }\n\n  handleDelete(id) {\n    Swal.fire({\n      title: 'Êtes-vous sûr?',\n      text: \"Vous ne pourrez pas revenir en arrière!\",\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#3085d6',\n      cancelButtonColor: '#d33',\n      confirmButtonText: 'Oui, supprimer!',\n      cancelButtonText: 'Annuler'\n    }).then(result => {\n      if (result.isConfirmed) {\n        this.evaluationservice.deleteEvaluation(id).subscribe({\n          next: () => {\n            this.evaluations = this.evaluations.filter(item => item.Id !== id);\n            Swal.fire({\n              title: 'Supprimé!',\n              text: 'Évaluation supprimée avec succès',\n              icon: 'success',\n              timer: 1500,\n              showConfirmButton: false\n            });\n          },\n          error: error => {\n            console.error('Erreur lors de la suppression:', error);\n            Swal.fire({\n              icon: 'error',\n              title: 'Erreur lors de la suppression',\n              text: error.message || 'Une erreur est survenue',\n              showConfirmButton: false,\n              timer: 1500\n            });\n          }\n        });\n      }\n    });\n  }\n\n  addDetailToSection(sectionIndex) {\n    if (this.sections[sectionIndex]) {\n      this.sections[sectionIndex].details.push({\n        titre: '',\n        description: '',\n        icon: '',\n        category: null\n      });\n    }\n  }\n\n  removeDetailFromSection(sectionIndex, detailIndex) {\n    if (this.sections[sectionIndex] && this.sections[sectionIndex].details[detailIndex]) {\n      Swal.fire({\n        title: 'Supprimer ce détail?',\n        text: \"Cette action est irréversible\",\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#f44336',\n        cancelButtonColor: '#666',\n        confirmButtonText: 'Oui, supprimer',\n        cancelButtonText: 'Annuler'\n      }).then(result => {\n        if (result.isConfirmed) {\n          this.sections[sectionIndex].details.splice(detailIndex, 1);\n        }\n      });\n    }\n  }\n\n  addCustomCategory(sectionIndex, detailIndex) {\n    Swal.fire({\n      title: 'Ajouter une catégorie',\n      input: 'text',\n      inputPlaceholder: 'Nom de la catégorie',\n      showCancelButton: true,\n      confirmButtonText: 'Ajouter',\n      cancelButtonText: 'Annuler',\n      inputValidator: value => {\n        if (!value) {\n          return 'Veuillez entrer un nom de catégorie!';\n        }\n\n        return null;\n      }\n    }).then(result => {\n      if (result.isConfirmed && result.value) {\n        const newCategory = result.value.trim();\n\n        if (!this.customCategories.includes(newCategory)) {\n          this.customCategories.push(newCategory);\n        }\n\n        this.sections[sectionIndex].details[detailIndex].category = newCategory;\n      }\n    });\n  }\n\n  getAllCategories() {\n    return [...this.availableCategories, ...this.customCategories];\n  } // Gestion des partenaires\n\n\n  togglePartenaireSelection(partenaire) {\n    const index = this.selectedPartenaires.findIndex(p => p.Id === partenaire.Id);\n\n    if (index > -1) {\n      this.selectedPartenaires.splice(index, 1);\n    } else {\n      this.selectedPartenaires.push(partenaire);\n    }\n  }\n\n  isPartenaireSelected(partenaire) {\n    return this.selectedPartenaires.some(p => p.Id === partenaire.Id);\n  } // Gestion des catalogues\n\n\n  addCatalogue() {\n    this.catalogues.push({\n      title: '',\n      image: null,\n      imagePreview: null\n    });\n  }\n\n  removeCatalogue(index) {\n    Swal.fire({\n      title: 'Supprimer ce catalogue?',\n      text: \"Cette action est irréversible\",\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#f44336',\n      cancelButtonColor: '#666',\n      confirmButtonText: 'Oui, supprimer',\n      cancelButtonText: 'Annuler'\n    }).then(result => {\n      if (result.isConfirmed) {\n        this.catalogues.splice(index, 1);\n      }\n    });\n  }\n\n  onCatalogueImageSelected(event, index) {\n    const file = event.target.files[0];\n\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Veuillez sélectionner une image valide',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'L\\'image ne doit pas dépasser 5MB',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      this.catalogues[index].image = file; // Preview\n\n      const reader = new FileReader();\n\n      reader.onload = e => {\n        this.catalogues[index].imagePreview = e.target.result;\n      };\n\n      reader.readAsDataURL(file);\n    }\n  }\n\n  handleSubmit() {\n    if (!this.formData.name || !this.formData.description) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Champs manquants',\n        text: 'Veuillez remplir tous les champs obligatoires',\n        timer: 2000,\n        showConfirmButton: false\n      });\n      this.currentModalStep = 1;\n      return;\n    }\n\n    if (this.modalMode === 'add' && !this.selectedImage) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Image manquante',\n        text: 'Veuillez sélectionner une image',\n        timer: 2000,\n        showConfirmButton: false\n      });\n      this.currentModalStep = 1;\n      return;\n    }\n\n    const incompleteSections = this.sections.filter((s, index) => {\n      if (!s.headline || !s.subtitle || s.details.length === 0) {\n        return true;\n      }\n\n      if (index === 3) {\n        return s.details.some(d => !d.titre || !d.icon || !d.category);\n      }\n\n      return s.details.some(d => !d.titre || !d.icon);\n    });\n\n    if (incompleteSections.length > 0) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Sections incomplètes',\n        text: `Il reste ${incompleteSections.length} section(s) à compléter`,\n        timer: 2000,\n        showConfirmButton: false\n      });\n      return;\n    }\n\n    const formData = new FormData();\n    formData.append('name', this.formData.name);\n    formData.append('description', this.formData.description);\n    const completedSections = this.sections.filter(s => s.headline && s.subtitle && s.details.length > 0);\n    formData.append('sections', JSON.stringify(completedSections));\n\n    if (this.selectedImage) {\n      formData.append('image', this.selectedImage, this.selectedImage.name);\n    } // Ajouter les IDs des partenaires\n\n\n    if (this.selectedPartenaires.length > 0) {\n      this.selectedPartenaires.forEach(p => {\n        formData.append('partenairesIds', p.Id.toString());\n      });\n    } // Ajouter les catalogues\n\n\n    if (this.catalogues.length > 0) {\n      this.catalogues.forEach((cat, index) => {\n        formData.append('catalogueTitles', cat.title);\n\n        if (cat.image) {\n          formData.append('catalogueImages', cat.image, cat.image.name);\n        }\n      });\n    }\n\n    if (this.modalMode === 'add') {\n      this.evaluationservice.addEvaluation(formData).subscribe({\n        next: response => {\n          const newEvaluation = new Evaluation({\n            id: response.id,\n            name: response.name,\n            description: response.description,\n            image: response.image,\n            sections: response.sections || [],\n            evaluationPartenaires: response.evaluationPartenaires || [],\n            evaluationCatalogues: response.evaluationCatalogues || []\n          });\n          this.evaluations.push(newEvaluation);\n          this.closeModal();\n          Swal.fire({\n            title: 'Succès!',\n            text: 'Évaluation ajoutée avec succès',\n            icon: 'success',\n            timer: 1500,\n            showConfirmButton: false\n          }).then(() => {\n            this.fetchEvaluations();\n          });\n        },\n        error: error => {\n          console.error('Erreur lors de l\\'ajout:', error);\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur lors de l\\'ajout',\n            text: error.message || 'Une erreur est survenue',\n            showConfirmButton: false,\n            timer: 1500\n          });\n        }\n      });\n    } else {\n      this.evaluationservice.putEvaluation(this.editId, formData).subscribe({\n        next: response => {\n          const index = this.evaluations.findIndex(item => item.Id === this.editId);\n\n          if (index !== -1) {\n            this.evaluations[index] = new Evaluation({\n              id: response.id,\n              name: response.name,\n              description: response.description,\n              image: response.image,\n              sections: response.sections || [],\n              evaluationPartenaires: response.evaluationPartenaires || [],\n              evaluationCatalogues: response.evaluationCatalogues || []\n            });\n          }\n\n          this.closeModal();\n          Swal.fire({\n            title: 'Succès!',\n            text: 'Évaluation modifiée avec succès',\n            icon: 'success',\n            timer: 1500,\n            showConfirmButton: false\n          }).then(() => {\n            this.fetchEvaluations();\n          });\n        },\n        error: error => {\n          console.error('Erreur lors de la modification:', error);\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur lors de la modification',\n            text: error.message || 'Une erreur est survenue',\n            showConfirmButton: false,\n            timer: 1500\n          });\n        }\n      });\n    }\n  }\n\n  toggleSidebar() {\n    this.sidebarOpen = !this.sidebarOpen;\n  }\n\n  logout() {\n    this.authService.logout();\n    Swal.fire({\n      icon: 'info',\n      title: 'Déconnexion',\n      text: 'Vous êtes déconnecté',\n      showConfirmButton: false,\n      timer: 1500\n    });\n    this.router.navigate(['/']);\n  }\n\n  onImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Veuillez sélectionner une image valide',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'L\\'image ne doit pas dépasser 5MB',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      this.selectedImage = file;\n    }\n  }\n\n  sanitizeImage(url) {\n    if (!url) return '';\n\n    if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n      const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n      return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n    }\n\n    return url;\n  } // Modifications dans le component TypeScript\n  // Dans la méthode handleSubmit(), remplacer la condition finale:\n  // Ligne: if (this.currentModalStep === 5)\n  // Par: if (this.currentModalStep === 7)\n  // 1. Modifier la progression pour inclure 7 steps au lieu de 5\n\n\n  nextModalStep() {\n    if (this.currentModalStep === 1) {\n      if (!this.formData.name || !this.formData.description) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Champs manquants',\n          text: 'Veuillez remplir le nom et la description',\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      if (this.modalMode === 'add' && !this.selectedImage) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Image manquante',\n          text: 'Veuillez sélectionner une image',\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n    } // Validation des sections 1-4 (steps 2-5)\n\n\n    if (this.currentModalStep >= 2 && this.currentModalStep <= 5) {\n      const sectionIndex = this.currentModalStep - 2;\n      const section = this.sections[sectionIndex];\n\n      if (!section.headline || !section.subtitle) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Section incomplète',\n          text: `Veuillez remplir les champs headline et subtitle de la section ${sectionIndex + 1}`,\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      if (section.details.length === 0) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Détails manquants',\n          text: `Veuillez ajouter au moins un détail à la section ${sectionIndex + 1}`,\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      let missingFields;\n\n      if (this.currentModalStep === 5) {\n        missingFields = section.details.some(d => !d.titre || !d.description || !d.icon || !d.category);\n      } else {\n        missingFields = section.details.some(d => !d.titre || !d.description || !d.icon);\n      }\n\n      if (missingFields) {\n        const fieldsText = this.currentModalStep === 5 ? 'titre, description, icône et catégorie' : 'titre, description et icône';\n        Swal.fire({\n          icon: 'warning',\n          title: 'Détails incomplets',\n          text: `Veuillez remplir tous les champs (${fieldsText}) pour la section ${sectionIndex + 1}`,\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n    } // Step 6: Pas de validation obligatoire pour les partenaires (optionnel)\n    // Step 7: Validation des catalogues\n\n\n    if (this.currentModalStep === 7) {\n      const incompleteCatalogues = this.catalogues.filter(cat => !cat.title || !cat.image && !cat.imagePreview);\n\n      if (incompleteCatalogues.length > 0) {\n        Swal.fire({\n          icon: 'warning',\n          title: 'Catalogues incomplets',\n          text: 'Veuillez remplir tous les champs des catalogues (titre et image)',\n          timer: 2000,\n          showConfirmButton: false\n        });\n        return;\n      }\n    }\n\n    if (this.currentModalStep < 7) {\n      this.currentModalStep++;\n    }\n  }\n\n  previousModalStep() {\n    if (this.currentModalStep > 1) {\n      this.currentModalStep--;\n    }\n  }\n\n  goToModalStep(step) {\n    if (step <= this.currentModalStep) {\n      this.currentModalStep = step;\n    }\n  }\n\n  countCompletedSections() {\n    return this.sections.filter((s, index) => {\n      if (!s.headline || !s.subtitle || s.details.length === 0) {\n        return false;\n      }\n\n      if (index === 3) {\n        return s.details.every(d => d.titre && d.description && d.icon && d.category);\n      }\n\n      return s.details.every(d => d.titre && d.description && d.icon);\n    }).length;\n  }\n\n};\nEvaluationComponent = __decorate([Component({\n  selector: 'app-evaluation',\n  templateUrl: './evaluation.component.html',\n  styleUrls: ['./evaluation.component.css']\n})], EvaluationComponent);\nexport { EvaluationComponent };","map":null,"metadata":{},"sourceType":"module"}