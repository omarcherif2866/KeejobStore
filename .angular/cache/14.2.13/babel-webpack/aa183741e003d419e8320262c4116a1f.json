{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { Expert, Gouvernorat } from 'src/app/components/models/expert';\nlet ExpertComponent = class ExpertComponent {\n  constructor(fb, expertService, messageService) {\n    this.fb = fb;\n    this.expertService = expertService;\n    this.messageService = messageService;\n    this.expertDialog = false;\n    this.deleteexpertDialog = false;\n    this.experts = [];\n    this.uploadedFiles = [];\n    this.actionLabel = 'Enregistrer';\n    this.submitted = false;\n    this.selectedExpert = [];\n    this.gouvernoratOptions = [];\n  }\n\n  ngOnInit() {\n    this.initForm();\n    this.getAllExperts();\n    this.getGouvernaurat();\n  }\n\n  getGouvernaurat() {\n    this.gouvernoratOptions = Object.values(Gouvernorat).map(gouv => ({\n      label: gouv,\n      value: gouv // La valeur stockée dans `agence.Gouvernorat`\n\n    }));\n  }\n\n  initForm() {\n    this.expertForm = this.fb.group({\n      nom: ['', Validators.required],\n      prenom: ['', Validators.required],\n      email: ['', [Validators.required, Validators.email]],\n      password: ['', [Validators.required, Validators.minLength(8), Validators.pattern('^(?=.*[A-Z])(?=.*\\\\d)(?=.*[@$!%*?&#])[A-Za-z\\\\d@$!%*?&#]{8,}$')]],\n      phoneNumber: ['', Validators.required],\n      region: ['', Validators.required],\n      taux: ['', [Validators.required, Validators.min(0)]],\n      image: [null]\n    });\n  }\n\n  getUserRole() {\n    return localStorage.getItem('userRole');\n  }\n\n  openNew() {\n    this.expert = new Expert('', '', '', '', '', '', 0, '', '', []);\n    this.submitted = false;\n    this.expertForm.reset();\n    this.expertDialog = true;\n  }\n\n  editExpert(expert) {\n    const expertInstance = new Expert(expert._id, expert.email, '', // password vide\n    expert.image, expert.phoneNumber, expert.region, expert.taux, expert.nom, expert.prenom, [], []);\n\n    if (expertInstance && expertInstance.Id) {\n      this.expertDialog = true;\n      this.expert = expertInstance; // ✅ Mise à jour du formulaire avec les données de l'expert\n\n      this.expertForm.patchValue({\n        nom: expert.nom,\n        prenom: expert.prenom,\n        email: expert.email,\n        phoneNumber: expert.phoneNumber,\n        region: expert.region,\n        taux: expert.taux,\n        password: '' // Optionnel : laisser vide\n\n      });\n      this.uploadedFiles = []; // Optionnel : réinitialiser le fichier\n\n      this.actionLabel = 'Modifier';\n    }\n  }\n\n  deleteExpert(expert) {\n    const expertInstance = new Expert(expert._id, expert.email, expert.image, expert.phoneNumber, expert.region, expert.taux, expert.nom, expert.prenom, '', []);\n\n    if (expertInstance && expertInstance.Id) {\n      this.deleteexpertDialog = true;\n      this.expert = expertInstance;\n    } else {\n      console.error('expert object is missing ID:', expertInstance);\n    }\n  }\n\n  confirmDelete() {\n    if (this.expert && this.expert.Id) {\n      this.expertService.deleteExpert(this.expert.Id).subscribe(response => {\n        this.experts = this.experts.filter(val => val.Id !== this.expert.Id);\n        this.messageService.add({\n          severity: 'success',\n          summary: 'Successful',\n          detail: 'Expert supprimé',\n          life: 3000\n        });\n        this.expert = new Expert('', '', '', '', '', '', 0, '', '', []);\n        this.deleteexpertDialog = false;\n        window.location.reload();\n      }, error => {\n        console.error('Erreur lors de la suppression du expert:', error);\n        this.messageService.add({\n          severity: 'error',\n          summary: 'Erreur',\n          detail: 'Échec de la suppression du expert',\n          life: 3000\n        });\n        this.deleteexpertDialog = false;\n      });\n    } else {\n      console.error('ID de expert invalide:', this.expert);\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'ID de expert invalide',\n        life: 3000\n      });\n      this.deleteexpertDialog = false;\n    }\n  }\n\n  hideDialog() {\n    this.expertDialog = false;\n    this.submitted = false;\n  }\n\n  onFileSelected(event) {\n    if (event.files && event.files.length > 0) {\n      this.uploadedFiles = [];\n\n      for (let file of event.files) {\n        this.uploadedFiles.push(file);\n      }\n    } else {\n      console.error(\"Erreur lors de la sélection du fichier : la propriété 'files' n'est pas définie dans l'événement.\");\n    }\n  }\n\n  getImageUrl(imageName) {\n    return `${imageName}`;\n  }\n\n  saveExpert() {\n    this.submitted = true; // Vérifier si le formulaire est valide\n\n    if (this.expertForm.invalid) {\n      return;\n    } // Créer un objet FormData pour envoyer les données\n\n\n    const expertData = new FormData(); // Ajouter les propriétés de base\n\n    expertData.append('nom', this.expertForm.get('nom').value);\n    expertData.append('prenom', this.expertForm.get('prenom').value);\n    expertData.append('email', this.expertForm.get('email').value);\n    expertData.append('password', this.expertForm.get('password').value);\n    expertData.append('phoneNumber', this.expertForm.get('phoneNumber').value);\n    expertData.append('region', this.expertForm.get('region').value);\n    expertData.append('taux', this.expertForm.get('taux').value); // Ajouter l'image si elle est sélectionnée\n\n    if (this.uploadedFiles && this.uploadedFiles.length > 0) {\n      expertData.append('image', this.uploadedFiles[0]);\n    } // Appeler le service pour ajouter l'expert\n\n\n    this.expertService.addExpert(expertData).subscribe(response => {\n      this.messageService.add({\n        severity: 'success',\n        summary: 'Succès',\n        detail: 'Expert ajouté avec succès'\n      });\n      this.expertDialog = false; // Fermer le dialogue\n\n      this.expertForm.reset(); // Réinitialiser le formulaire\n\n      window.location.reload(); // Recharger la page\n    }, error => {\n      var _a;\n\n      const errorMsg = ((_a = error === null || error === void 0 ? void 0 : error.error) === null || _a === void 0 ? void 0 : _a.message) || 'Échec de l\\'ajout de l\\'expert';\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: errorMsg\n      });\n    });\n  }\n\n  getAllExperts() {\n    this.expertService.getExpert().subscribe(experts => {\n      this.experts = experts;\n    }, error => {\n      console.error('Erreur lors de la récupération des experts:', error);\n    });\n  }\n\n  onGlobalFilter(table, event) {\n    table.filterGlobal(event.target.value, 'contains');\n  }\n\n};\nExpertComponent = __decorate([Component({\n  selector: 'app-expert',\n  templateUrl: './expert.component.html',\n  styleUrl: './expert.component.scss'\n})], ExpertComponent);\nexport { ExpertComponent };","map":null,"metadata":{},"sourceType":"module"}