{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet ServiceFormateurComponent = class ServiceFormateurComponent {\n  constructor(formationFormateur, authService, router) {\n    this.formationFormateur = formationFormateur;\n    this.authService = authService;\n    this.router = router;\n    this.sidebarOpen = true;\n    this.formations = [];\n    this.loading = false;\n    this.currentPage = 1;\n    this.itemsPerPage = 5;\n    this.showModal = false;\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      title: '',\n      description: []\n    };\n    this.editId = null;\n    this.selectedImage = null;\n  }\n\n  ngOnInit() {\n    this.fetchFormations();\n  } // RÃ©cupÃ©rer les actualitÃ©s depuis le backend\n\n\n  fetchFormations() {\n    this.loading = true; // RÃ©cupÃ©rer l'ID du formateur depuis le localStorage\n\n    const id = localStorage.getItem(\"userId\");\n\n    if (!id) {\n      console.error(\"ID du formateur introuvable dans le localStorage !\");\n      this.loading = false;\n      return;\n    } // Appel au service\n\n\n    this.formationFormateur.getByFormateur(id).subscribe(response => {\n      this.formations = response; // stocker les formations rÃ©cupÃ©rÃ©es\n\n      console.log(\"Formations rÃ©cupÃ©rÃ©ess :\", this.formations);\n      this.loading = false;\n    }, error => {\n      console.error(\"Erreur lors du chargement des formations\", error);\n      this.loading = false;\n    });\n  } // Pagination\n\n\n  get currentItems() {\n    const indexOfLastItem = this.currentPage * this.itemsPerPage;\n    const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n    return this.formations.slice(indexOfFirstItem, indexOfLastItem);\n  }\n\n  get totalPages() {\n    return Math.ceil(this.formations.length / this.itemsPerPage);\n  }\n\n  get pagesArray() {\n    return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n  }\n\n  handlePageChange(pageNumber) {\n    this.currentPage = pageNumber;\n  } // Ajouter un formateur\n\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      title: '',\n      description: [''] // ðŸ‘ˆ crÃ©e le premier textarea automatiquement\n\n    };\n    this.showModal = true;\n  } // Ã‰diter un formateur\n\n\n  handleEdit(formations) {\n    var _a;\n\n    console.log('Formation Ã  Ã©diter:', formations);\n    this.modalMode = 'edit';\n    this.formData.id = (formations === null || formations === void 0 ? void 0 : formations.Id) || null;\n    this.formData.title = (formations === null || formations === void 0 ? void 0 : formations.Title) || ''; // Vider le tableau existant et y copier les valeurs\n\n    this.formData.description.length = 0;\n\n    if (((_a = formations === null || formations === void 0 ? void 0 : formations.Description) === null || _a === void 0 ? void 0 : _a.length) > 0) {\n      formations.Description.forEach(desc => this.formData.description.push(desc));\n    } else {\n      this.formData.description.push(''); // toujours au moins un textarea\n    }\n\n    this.editId = formations.id;\n    this.showModal = true;\n    console.log('FormData aprÃ¨s init:', this.formData);\n  }\n\n  trackByIndex(index, item) {\n    return index;\n  } // Supprimer une actualitÃ©\n  // handleDelete(id: any) {\n  //   if (confirm('ÃŠtes-vous sÃ»r de vouloir supprimer cette actualitÃ© ?')) {\n  //     this.formationFormateur.(id).subscribe(\n  //       () => {\n  //         this.formateurs = this.formateurs.filter(item => item.Id !== id);\n  //         Swal.fire({\n  //           title: 'Success!',\n  //           text: 'ActualitÃ© supprimÃ©e avec succÃ¨s',\n  //           icon: 'success',\n  //           confirmButtonText: 'OK',\n  //           timer: 1500,\n  //         }).then(() => {\n  //           window.location.reload();\n  //         });         \n  //       },\n  //       (error) => {\n  //         Swal.fire({\n  //         icon: 'error',\n  //         title: 'Erreur lors de la suppression',\n  //         showConfirmButton: false,\n  //         timer: 1500\n  //       });          \n  //       }\n  //     );\n  //   }\n  // }\n  // Soumettre le formulaire\n\n\n  handleSubmit() {\n    const id = localStorage.getItem(\"userId\");\n    console.log(\"User ID:\", id); // Debug\n\n    const formationData = {\n      title: this.formData.title,\n      description: this.formData.description.filter(d => d.trim() !== ''),\n      formateur: {\n        id: Number(id)\n      }\n    };\n    console.log(\"Formation Ã  envoyer:\", formationData); // Debug\n\n    console.log(\"Mode:\", this.modalMode); // Debug\n    // âœ… VÃ©rifier le mode (ajout ou modification)\n\n    if (this.modalMode === 'add') {\n      // MODE AJOUT\n      this.formationFormateur.add(formationData).subscribe(res => {\n        console.log('Formation ajoutÃ©e', res);\n        Swal.fire({\n          icon: 'success',\n          title: 'Formation ajoutÃ©e',\n          showConfirmButton: false,\n          timer: 1500\n        });\n        this.showModal = false;\n        this.fetchFormations();\n      }, err => {\n        console.error('Erreur ajout', err);\n        console.error('DÃ©tails:', err.error);\n      });\n    } else if (this.modalMode === 'edit') {\n      // MODE MODIFICATION\n      this.formationFormateur.update(this.editId, formationData).subscribe(res => {\n        console.log('Formation modifiÃ©e', res);\n        Swal.fire({\n          icon: 'success',\n          title: 'Formation modifiÃ©e',\n          showConfirmButton: false,\n          timer: 1500\n        });\n        this.showModal = false;\n        this.fetchFormations();\n      }, err => {\n        console.error('Erreur modification', err);\n        console.error('DÃ©tails:', err.error);\n      });\n    }\n  }\n\n  toggleSidebar() {\n    this.sidebarOpen = !this.sidebarOpen;\n  }\n\n  getServicesTitles(formateur) {\n    if (!formateur.servicesFormateurs) return '';\n    return formateur.servicesFormateurs.map(s => s.title).join(', ');\n  }\n\n  getTitleWhy(formateur) {\n    if (!formateur.titleWhy) return '';\n    return formateur.titleWhy.map(s => s.title).join(', ');\n  }\n\n  logout() {\n    this.authService.logout();\n    Swal.fire({\n      icon: 'error',\n      title: 'Vous Ãªtes deconnectÃ©',\n      showConfirmButton: false,\n      timer: 1500\n    });\n    this.router.navigate(['/']);\n  }\n\n  addDescription() {\n    this.formData.description.push('');\n  }\n\n  removeDescription(index) {\n    this.formData.description.splice(index, 1);\n  }\n\n};\nServiceFormateurComponent = __decorate([Component({\n  selector: 'app-service-formateur',\n  templateUrl: './service-formateur.component.html',\n  styleUrls: ['./service-formateur.component.css']\n})], ServiceFormateurComponent);\nexport { ServiceFormateurComponent };","map":null,"metadata":{},"sourceType":"module"}