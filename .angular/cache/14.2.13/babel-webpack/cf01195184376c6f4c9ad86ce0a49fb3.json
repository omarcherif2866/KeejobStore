{"ast":null,"code":"// import { Component, OnInit } from '@angular/core';\n// import { Router } from '@angular/router';\n// import { FormationKeejob } from 'src/app/models/formation-keejob';\n// import { Partenaire } from 'src/app/models/partenaire';\n// import { AuthService } from 'src/app/services/auth.service';\n// import { FormationKeejobService } from 'src/app/services/formation-keejob.service';\n// import { PartenaireService } from 'src/app/services/partenaire.service';\n// import Swal from 'sweetalert2';\nimport { __decorate } from \"tslib\"; // @Component({\n//   selector: 'app-formation-keejob',\n//   templateUrl: './formation-keejob.component.html',\n//   styleUrls: ['./formation-keejob.component.css']\n// })\n// export class FormationKeejobComponent implements OnInit {\n// sidebarOpen = true;\n//   formationsKeejob: FormationKeejob[] = [];\n//   partenaires: Partenaire[] = [];\n//   selectedPartenaires: any[] = [];\n//   loading = false;\n//   currentPage = 1;\n//   itemsPerPage = 5;\n//   showModal = false;\n//   modalMode: 'add' | 'edit' = 'add';\n//   formData = {\n//     id: null,\n//     title: '',\n//     description: '',\n//     image:'',\n//     partenaires: []\n//   };\n//   editId: any = null;\n//   selectedImage: File | null = null;\n//   constructor(private partenaireservice: PartenaireService, private formationsKeejobervice: FormationKeejobService, private authService: AuthService,private router:Router) {}\n//   ngOnInit() {\n//     this.fetchformationsKeejob();\n//     this.fetchPartenaires();\n//   }\n//   // Récupérer les actualités depuis le backend\n//   fetchformationsKeejob() {\n//     this.loading = true;\n//     this.formationsKeejobervice.getFormationKeejob().subscribe(\n//       (response: any[]) => {\n//         // Transformer chaque JSON en instance de FormationKeejob\n//         this.formationsKeejob = response.map(f => new FormationKeejob(\n//           f.id,\n//           f.title,\n//           f.description,\n//           f.image,\n//         ));\n//         this.formationsKeejob = this.formationsKeejob; // si pagination ou filtrage\n//         this.loading = false;\n//         console.log('Données reçues: ', this.formationsKeejob);\n//       },\n//       (error) => {\n//         console.error('Erreur lors du chargement des formationsKeejob:', error);\n//         this.loading = false;\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors du chargement des données',\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   }\n//     fetchPartenaires() {\n//       this.loading = true;\n//       this.partenaireservice.getPartenaire().subscribe(\n//         (response: any[]) => {\n//           // Transformer chaque JSON en instance de Partenaire\n//           this.partenaires = response.map(f => new Partenaire(\n//             f.id,\n//             f.title,\n//             f.description,\n//             f.image,\n//           ));\n//           this.partenaires = this.partenaires; // si pagination ou filtrage\n//           this.loading = false;\n//           console.log('Données reçues: ', this.partenaires);\n//         },\n//         (error) => {\n//           console.error('Erreur lors du chargement des partenaires:', error);\n//           this.loading = false;\n//           Swal.fire({\n//             icon: 'error',\n//             title: 'Erreur lors du chargement des données',\n//             showConfirmButton: false,\n//             timer: 1500\n//           });\n//         }\n//       );\n//     }\n//   // Pagination\n//   get currentItems(): FormationKeejob[] {\n//     const indexOfLastItem = this.currentPage * this.itemsPerPage;\n//     const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n//     return this.formationsKeejob.slice(indexOfFirstItem, indexOfLastItem);\n//   }\n//   get totalPages(): number {\n//     return Math.ceil(this.formationsKeejob.length / this.itemsPerPage);\n//   }\n//   get pagesArray(): number[] {\n//     return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n//   }\n//   handlePageChange(pageNumber: number) {\n//     this.currentPage = pageNumber;\n//   }\n// // Ajouter un FormationKeejob\n// handleAdd() {\n//   this.modalMode = 'add';\n//   this.formData = {\n//     id: null,\n//     title: '',\n//     description: '',\n//     image: '',\n//     partenaires: []\n//   };\n//   this.showModal = true;\n// }\n// // Éditer un FormationKeejob\n// handleEdit(FormationKeejob: FormationKeejob) {\n//   this.modalMode = 'edit';\n//   this.formData = {\n//     id: FormationKeejob.Id,\n//     title: FormationKeejob.Title,\n//     description: FormationKeejob.Description,\n//     image: FormationKeejob.Image,\n//     partenaires: FormationKeejob.Partenaires,\n//   };\n//   this.editId = FormationKeejob.Id;\n//   this.showModal = true;\n// }\n//   // Supprimer une actualité\n//   handleDelete(id: any) {\n//     if (confirm('Êtes-vous sûr de vouloir supprimer cette actualité ?')) {\n//       this.formationsKeejobervice.deleteFormationKeejob(id).subscribe(\n//         () => {\n//           this.formationsKeejob = this.formationsKeejob.filter(item => item.Id !== id);\n//           Swal.fire({\n//             title: 'Success!',\n//             text: 'Actualité supprimée avec succès',\n//             icon: 'success',\n//             confirmButtonText: 'OK',\n//             timer: 1500,\n//           }).then(() => {\n//             window.location.reload();\n//           });         \n//         },\n//         (error) => {\n//           Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de la suppression',\n//           showConfirmButton: false,\n//           timer: 1500\n//         });          \n//         }\n//       );\n//     }\n//   }\n//   // Soumettre le formulaire\n// handleSubmit() {\n//   // Vérification des champs obligatoires\n//   if (\n//     !this.formData.description || !this.formData.title   ) {\n//     alert('Veuillez remplir tous les champs obligatoires');\n//     return;\n//   }\n//   // Créer FormData pour envoyer les données + l'image\n//   const formData = new FormData();\n//   formData.append('title', this.formData.title);\n//   formData.append('description', this.formData.description);\n//   // Ajouter l'image si elle existe\n//   if (this.selectedImage) {\n//     formData.append('image', this.selectedImage, this.selectedImage.name);\n//   }\n//   formData.append(\"partenaireIds\", JSON.stringify(\n//   this.selectedPartenaires.map(p => p.id)\n// ));\n//   if (this.modalMode === 'add') {\n//     this.formationsKeejobervice.addFormationKeejob(formData).subscribe(\n//       (response) => {\n//         const newFormationKeejob = new FormationKeejob(\n//             response.Id,\n//             response.Title,\n//             response.Description,\n//             response.Image, // Ajouter l'image\n//             response.Partenaires \n//         );\n//         this.formationsKeejob.push(newFormationKeejob);\n//         this.showModal = false;\n//         this.selectedImage = null; // Réinitialiser\n//         Swal.fire({\n//           title: 'Success!',\n//           text: 'FormationKeejob ajouté avec succès',\n//           icon: 'success',\n//           timer: 1500,\n//           showConfirmButton: false\n//         }).then(() => {\n//           window.location.reload();\n//         });\n//       },\n//       (error) => {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de l\\'ajout',\n//           text: error,\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   } else {\n//     this.formationsKeejobervice.putFormationKeejob(this.editId, formData).subscribe(\n//       (response) => {\n//         const index = this.formationsKeejob.findIndex(item => item.Id === this.editId);\n//         if (index !== -1) {\n//           this.formationsKeejob[index] = new FormationKeejob(\n//             response.Id,\n//             response.Title,\n//             response.Description,\n//             response.Image ,\n//             response.Partenaires \n//           );\n//         }\n//         this.showModal = false;\n//         this.selectedImage = null; // Réinitialiser\n//         Swal.fire({\n//           title: 'Success!',\n//           text: 'FormationKeejob modifié avec succès',\n//           icon: 'success',\n//           timer: 1500,\n//           showConfirmButton: false\n//         }).then(() => {\n//           window.location.reload();\n//         });\n//       },\n//       (error) => {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de la modification',\n//           text: error,\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   }\n// }\n//   toggleSidebar() {\n//     this.sidebarOpen = !this.sidebarOpen;\n//   }\n//     logout(): void {\n//         this.authService.logout();\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Vous êtes deconnecté',\n//           showConfirmButton: false,\n//           timer: 1500\n//         }); \n//         this.router.navigate(['/']);\n//       }\n// onImageSelected(event: any) {\n//   const file = event.target.files[0];\n//   if (file) {\n//     // Vérifier le type de fichier\n//     if (!file.type.startsWith('image/')) {\n//       Swal.fire({\n//         icon: 'error',\n//         title: 'Erreur',\n//         text: 'Veuillez sélectionner une image valide',\n//         timer: 1500,\n//         showConfirmButton: false\n//       });\n//       return;\n//     }\n//     // Vérifier la taille (par exemple, max 5MB)\n//     if (file.size > 5 * 1024 * 1024) {\n//       Swal.fire({\n//         icon: 'error',\n//         title: 'Erreur',\n//         text: 'L\\'image ne doit pas dépasser 5MB',\n//         timer: 1500,\n//         showConfirmButton: false\n//       });\n//       return;\n//     }\n//     this.selectedImage = file;\n//   }\n// }\n// sanitizeImage(url: string): string {\n//   if (!url) return '';\n//   // Cas où l'URL est en double\n//   if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n//     const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n//     return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n//   }\n//   return url;\n// }\n// togglePartenaire(p: Partenaire) {\n//   const index = this.selectedPartenaires.findIndex(x => x.id === p.Id);\n//   if (index >= 0) {\n//     this.selectedPartenaires.splice(index, 1); // désélection\n//   } else {\n//     this.selectedPartenaires.push(p); // sélection\n//   }\n// }\n// isSelected(p: Partenaire): boolean {\n//   return this.selectedPartenaires.some(x => x.id === p.Id);\n// }\n// }\n\nimport { Component } from '@angular/core';\nimport { FormationKeejob } from './models/formation-keejob';\nimport { SousFormationKeejob } from './models/sous-formation-keejob';\nimport Swal from 'sweetalert2';\nlet FormationKeejobComponent = class FormationKeejobComponent {\n  constructor(formationsKeejobService, sousFormationService, sanitizer, router) {\n    this.formationsKeejobService = formationsKeejobService;\n    this.sousFormationService = sousFormationService;\n    this.sanitizer = sanitizer;\n    this.router = router; // Variables pour la sidebar et navigation\n\n    this.sidebarOpen = false;\n    this.loading = false; // Variables pour la pagination\n\n    this.currentPage = 1;\n    this.itemsPerPage = 10;\n    this.totalPages = 0;\n    this.pagesArray = [];\n    this.currentItems = []; // Variables pour le stepper\n\n    this.currentStep = 1;\n    this.maxSteps = 2; // FormationKeejob créée à l'étape 1\n\n    this.createdFormationKeejob = null; // Variables pour l'étape 1 (FormationKeejob)\n\n    this.showModal = false;\n    this.modalMode = 'add';\n    this.editId = null;\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: []\n    };\n    this.selectedImage = null;\n    this.selectedPartenaires = [];\n    this.formationsKeejob = []; // Variables pour l'étape 2 (SousFormationKeejob)\n\n    this.sousFormations = [];\n    this.showSousFormationModal = false;\n    this.sousFormationData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: [],\n      formationKeejobId: null\n    };\n    this.selectedSousImage = null;\n    this.selectedSousPartenaires = [];\n  }\n\n  ngOnInit() {\n    this.loadFormations();\n  } // ============== GESTION SIDEBAR ==============\n\n\n  toggleSidebar() {\n    this.sidebarOpen = !this.sidebarOpen;\n  }\n\n  logout() {\n    Swal.fire({\n      title: 'Déconnexion',\n      text: 'Êtes-vous sûr de vouloir vous déconnecter?',\n      icon: 'question',\n      showCancelButton: true,\n      confirmButtonText: 'Oui, déconnecter',\n      cancelButtonText: 'Annuler'\n    }).then(result => {\n      if (result.isConfirmed) {\n        // Logique de déconnexion\n        localStorage.removeItem('token');\n        this.router.navigate(['/login']);\n      }\n    });\n  } // ============== CHARGEMENT DES DONNÉES ==============\n\n\n  loadFormations() {\n    this.loading = true;\n    this.formationsKeejobService.getAllFormationsKeejob().subscribe(data => {\n      this.formationsKeejob = data.map(item => new FormationKeejob(item.Id || item.id, item.Title || item.title, item.Description || item.description, item.Image || item.image, item.Partenaires || item.partenaires || []));\n      this.updatePagination();\n      this.loading = false;\n    }, error => {\n      console.error('Erreur lors du chargement:', error);\n      this.loading = false;\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur',\n        text: 'Impossible de charger les formations'\n      });\n    });\n  } // ============== GESTION DE LA PAGINATION ==============\n\n\n  updatePagination() {\n    this.totalPages = Math.ceil(this.formationsKeejob.length / this.itemsPerPage);\n    this.pagesArray = Array.from({\n      length: this.totalPages\n    }, (_, i) => i + 1);\n    this.updateCurrentItems();\n  }\n\n  updateCurrentItems() {\n    const startIndex = (this.currentPage - 1) * this.itemsPerPage;\n    const endIndex = startIndex + this.itemsPerPage;\n    this.currentItems = this.formationsKeejob.slice(startIndex, endIndex);\n  }\n\n  handlePageChange(page) {\n    if (page >= 1 && page <= this.totalPages) {\n      this.currentPage = page;\n      this.updateCurrentItems();\n    }\n  } // ============== SANITIZE IMAGE ==============\n\n\n  sanitizeImage(image) {\n    if (!image) {\n      return 'assets/images/default-image.png';\n    } // Si l'image est déjà une URL complète\n\n\n    if (image.startsWith('http://') || image.startsWith('https://')) {\n      return this.sanitizer.bypassSecurityTrustUrl(image);\n    } // Si c'est un chemin relatif\n\n\n    return this.sanitizer.bypassSecurityTrustUrl(`http://localhost:8080/${image}`);\n  } // ============== GESTION DU STEPPER ==============\n\n\n  nextStep() {\n    if (this.currentStep < this.maxSteps) {\n      this.currentStep++;\n    }\n  }\n\n  previousStep() {\n    if (this.currentStep > 1) {\n      this.currentStep--;\n    }\n  }\n\n  resetStepper() {\n    this.currentStep = 1;\n    this.createdFormationKeejob = null;\n    this.sousFormations = [];\n    this.resetFormData();\n  } // ============== ÉTAPE 1 : FormationKeejob ==============\n\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.resetFormData();\n    this.showModal = true;\n  }\n\n  handleEdit(formation) {\n    this.modalMode = 'edit';\n    this.formData = {\n      id: formation.Id,\n      title: formation.Title,\n      description: formation.Description,\n      image: formation.Image,\n      partenaires: formation.Partenaires\n    };\n    this.editId = formation.Id;\n    this.showModal = true;\n  }\n\n  handleDelete(id) {\n    Swal.fire({\n      title: 'Êtes-vous sûr?',\n      text: 'Cette action est irréversible!',\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonColor: '#d33',\n      cancelButtonColor: '#3085d6',\n      confirmButtonText: 'Oui, supprimer!',\n      cancelButtonText: 'Annuler'\n    }).then(result => {\n      if (result.isConfirmed) {\n        this.formationsKeejobService.deleteFormationKeejob(id).subscribe(() => {\n          this.formationsKeejob = this.formationsKeejob.filter(item => item.Id !== id);\n          this.updatePagination();\n          Swal.fire({\n            title: 'Supprimé!',\n            text: 'La formation a été supprimée.',\n            icon: 'success',\n            timer: 1500,\n            showConfirmButton: false\n          });\n        }, error => {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'Impossible de supprimer la formation'\n          });\n        });\n      }\n    });\n  }\n\n  resetFormData() {\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: []\n    };\n    this.selectedImage = null;\n    this.selectedPartenaires = [];\n  }\n\n  onImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      this.selectedImage = file;\n    }\n  }\n\n  handleSubmitFormation() {\n    // Vérification des champs obligatoires\n    if (!this.formData.description || !this.formData.title) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Veuillez remplir tous les champs obligatoires',\n        showConfirmButton: true\n      });\n      return;\n    } // Créer FormData pour envoyer les données + l'image\n\n\n    const formData = new FormData();\n    formData.append('title', this.formData.title);\n    formData.append('description', this.formData.description); // Ajouter l'image si elle existe\n\n    if (this.selectedImage) {\n      formData.append('image', this.selectedImage, this.selectedImage.name);\n    }\n\n    formData.append('partenaireIds', JSON.stringify(this.selectedPartenaires.map(p => p.id)));\n\n    if (this.modalMode === 'add') {\n      this.formationsKeejobService.addFormationKeejob(formData).subscribe(response => {\n        this.createdFormationKeejob = new FormationKeejob(response.Id, response.Title, response.Description, response.Image, response.Partenaires);\n        this.formationsKeejob.push(this.createdFormationKeejob);\n        this.updatePagination();\n        this.showModal = false;\n        this.selectedImage = null;\n        Swal.fire({\n          title: 'Succès!',\n          text: 'FormationKeejob créée avec succès',\n          icon: 'success',\n          timer: 1500,\n          showConfirmButton: false\n        }).then(() => {\n          // Passer à l'étape 2\n          this.nextStep();\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors de l\\'ajout',\n          text: error,\n          showConfirmButton: true\n        });\n      });\n    } else {\n      this.formationsKeejobService.putFormationKeejob(this.editId, formData).subscribe(response => {\n        const index = this.formationsKeejob.findIndex(item => item.Id === this.editId);\n\n        if (index !== -1) {\n          this.formationsKeejob[index] = new FormationKeejob(response.Id, response.Title, response.Description, response.Image, response.Partenaires);\n        }\n\n        this.updateCurrentItems();\n        this.showModal = false;\n        this.selectedImage = null;\n        Swal.fire({\n          title: 'Succès!',\n          text: 'FormationKeejob modifiée avec succès',\n          icon: 'success',\n          timer: 1500,\n          showConfirmButton: false\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors de la modification',\n          text: error,\n          showConfirmButton: true\n        });\n      });\n    }\n  } // ============== ÉTAPE 2 : SousFormationKeejob ==============\n\n\n  handleAddSousFormation() {\n    this.resetSousFormationData();\n    this.showSousFormationModal = true;\n  }\n\n  resetSousFormationData() {\n    var _a;\n\n    this.sousFormationData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: [],\n      formationKeejobId: ((_a = this.createdFormationKeejob) === null || _a === void 0 ? void 0 : _a.Id) || null\n    };\n    this.selectedSousImage = null;\n    this.selectedSousPartenaires = [];\n  }\n\n  onSousImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      this.selectedSousImage = file;\n    }\n  }\n\n  handleSubmitSousFormation() {\n    // Vérification des champs obligatoires\n    if (!this.sousFormationData.description || !this.sousFormationData.title) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Veuillez remplir tous les champs obligatoires',\n        showConfirmButton: true\n      });\n      return;\n    }\n\n    if (!this.createdFormationKeejob) {\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur',\n        text: 'Aucune FormationKeejob associée',\n        showConfirmButton: true\n      });\n      return;\n    } // Créer FormData pour envoyer les données + l'image\n\n\n    const formData = new FormData();\n    formData.append('title', this.sousFormationData.title);\n    formData.append('description', this.sousFormationData.description);\n    formData.append('formationKeejobId', this.createdFormationKeejob.Id.toString()); // Ajouter l'image si elle existe\n\n    if (this.selectedSousImage) {\n      formData.append('image', this.selectedSousImage, this.selectedSousImage.name);\n    }\n\n    formData.append('partenaireIds', JSON.stringify(this.selectedSousPartenaires.map(p => p.id))); // Ajouter la SousFormationKeejob\n\n    this.sousFormationService.addSousFormationKeejob(formData).subscribe(response => {\n      const newSousFormation = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, response.Partenaires, this.createdFormationKeejob);\n      this.sousFormations.push(newSousFormation);\n      this.showSousFormationModal = false;\n      this.selectedSousImage = null;\n      Swal.fire({\n        title: 'Succès!',\n        text: 'Sous-formation ajoutée avec succès',\n        icon: 'success',\n        timer: 1500,\n        showConfirmButton: false\n      });\n    }, error => {\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur lors de l\\'ajout',\n        text: error,\n        showConfirmButton: true\n      });\n    });\n  }\n\n  finishProcess() {\n    Swal.fire({\n      title: 'Processus terminé!',\n      text: `Formation créée avec ${this.sousFormations.length} sous-formation(s)`,\n      icon: 'success',\n      confirmButtonText: 'OK'\n    }).then(() => {\n      // Recharger la liste et revenir à l'étape 1\n      this.loadFormations();\n      this.resetStepper();\n    });\n  }\n\n  cancelProcess() {\n    Swal.fire({\n      title: 'Êtes-vous sûr?',\n      text: 'Voulez-vous annuler le processus?',\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonText: 'Oui, annuler',\n      cancelButtonText: 'Non, continuer'\n    }).then(result => {\n      if (result.isConfirmed) {\n        this.resetStepper();\n      }\n    });\n  }\n\n};\nFormationKeejobComponent = __decorate([Component({\n  selector: 'app-formation-keejob',\n  templateUrl: './formation-keejob.component.html',\n  styleUrls: ['./formation-keejob.component.css']\n})], FormationKeejobComponent);\nexport { FormationKeejobComponent };","map":null,"metadata":{},"sourceType":"module"}