{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet AffectExpertToClientComponent = class AffectExpertToClientComponent {\n  constructor(expertService, userService, messageService, documentService // Injecter le service pour r√©cup√©rer les documents\n  ) {\n    this.expertService = expertService;\n    this.userService = userService;\n    this.messageService = messageService;\n    this.documentService = documentService;\n    this.expertId = ''; // ID de l'expert\n\n    this.clientId = ''; // ID du client\n\n    this.documentId = ''; // ID du document s√©lectionn√©\n\n    this.documents = []; // Tableau pour stocker les documents du client\n\n    this.Users = []; // Liste des clients\n\n    this.experts = []; // Liste des experts\n  }\n\n  ngOnInit() {\n    const clientId = this.getUserId();\n    console.log(\"Client ID r√©cup√©r√©:\", clientId); // üîç V√©rifier la valeur\n\n    this.getAllClients();\n    this.getAllExperts();\n  }\n\n  affecterExpert() {\n    // this.documentId est d√©j√† l'ID puisqu'on utilise optionValue dans le template\n    this.expertService.affecterExpert(this.expertId, this.clientId, this.documentId).subscribe(response => {\n      console.log('Affectation r√©ussie :', response);\n      this.messageService.add({\n        severity: 'success',\n        summary: 'Succ√®s',\n        detail: 'Expert affect√© avec succ√®s'\n      });\n    }, error => {\n      console.error('Erreur lors de l\\'affectation :', error);\n      this.messageService.add({\n        severity: 'error',\n        summary: 'Erreur',\n        detail: 'Erreur lors de l\\'affectation'\n      });\n    });\n  } // M√©thode pour r√©cup√©rer tous les clients\n\n\n  getAllClients() {\n    this.userService.getUser().subscribe(ss => {\n      // Filtrer les utilisateurs pour ne garder que ceux avec userType = 'client'\n      this.Users = ss;\n      console.log(\"clients: \", ss);\n    }, error => {\n      console.error(\"Erreur lors de la r√©cup√©ration des utilisateurs:\", error);\n    });\n  } // M√©thode pour r√©cup√©rer tous les experts\n\n\n  getAllExperts() {\n    this.expertService.getExpert().subscribe(experts => {\n      this.experts = experts;\n    }, error => {\n      console.error('Erreur lors de la r√©cup√©ration des experts:', error);\n    });\n  } // M√©thode pour r√©cup√©rer les documents du client s√©lectionn√©\n\n\n  onClientChange(event) {\n    this.clientId = event.value; // R√©cup√®re l'ID du client s√©lectionn√©\n\n    this.getDocumentsByClient(this.clientId); // R√©cup√®re les documents associ√©s √† ce client\n  } // M√©thode pour r√©cup√©rer les documents associ√©s √† un client\n\n\n  getDocumentsByClient(client) {\n    const clientId = client._id || client.id; // üîπ R√©cup√®re l'ID depuis l'objet\n\n    console.log(\"üîç Client ID extrait:\", clientId);\n    console.log(\"üîç URL API:\", `http://localhost:9090/documents/client/${clientId}`);\n    this.documentService.getDocumentsByClient(clientId).subscribe(documents => {\n      // Filtrer les documents pour ne garder que ceux ayant le statut \"Valid√©\"\n      const validatedDocuments = documents.filter(doc => doc.status === 'Valid√©'); // Transformation des documents filtr√©s pour extraire le nom du fichier\n\n      this.documents = validatedDocuments.map(doc => ({\n        label: doc.doc,\n        value: doc._id // L'ID du document comme valeur associ√©e\n\n      }));\n    }, error => {\n      console.error(\"‚ùå Erreur API:\", error);\n    });\n  }\n\n  getUserId() {\n    return localStorage.getItem('user_id'); // Assurez-vous que 'user_id' est bien stock√© sous forme de cha√Æne\n  }\n\n};\nAffectExpertToClientComponent = __decorate([Component({\n  selector: 'app-affect-expert-to-client',\n  templateUrl: './affect-expert-to-client.component.html',\n  styleUrls: ['./affect-expert-to-client.component.scss']\n})], AffectExpertToClientComponent);\nexport { AffectExpertToClientComponent };","map":null,"metadata":{},"sourceType":"module"}