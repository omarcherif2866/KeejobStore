{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, Input, Output, EventEmitter } from '@angular/core';\nimport Swal from 'sweetalert2';\nlet LogicielComponent = class LogicielComponent {\n  constructor(logicielService) {\n    this.logicielService = logicielService;\n    this.logicielSelected = new EventEmitter();\n    this.loading = false;\n    this.logiciels = [];\n    this.selectedLogiciels = [];\n    this.newLogicielName = '';\n    this.selectedImage = null;\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.showModal = false;\n  }\n\n  ngOnInit() {\n    console.log('üöÄ LogicielComponent ngOnInit - sousFormationId:', this.sousFormationId);\n    this.loadLogiciels();\n  } // ‚úÖ SOLUTION : D√©tecter les changements de sousFormationId\n\n\n  ngOnChanges(changes) {\n    if (changes['sousFormationId'] && !changes['sousFormationId'].firstChange) {\n      console.log('üîÑ sousFormationId chang√©:', changes['sousFormationId'].currentValue);\n      this.loadLogiciels();\n    }\n  }\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.selectedImage = null;\n    this.showModal = true;\n  }\n\n  closeModal() {\n    this.showModal = false;\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.selectedImage = null;\n  }\n\n  loadLogiciels() {\n    if (!this.sousFormationId) {\n      console.warn('‚ö†Ô∏è Aucun sousFormationId, chargement de tous les logiciels');\n      this.loading = true;\n      this.logicielService.getLogiciel().subscribe({\n        next: res => {\n          console.log('‚úÖ Tous les logiciels r√©cup√©r√©s:', res);\n          this.logiciels = res || [];\n          this.loading = false;\n        },\n        error: err => {\n          console.error('‚ùå Erreur chargement logiciels:', err);\n          this.logiciels = [];\n          this.loading = false;\n        }\n      });\n      return;\n    } // ‚úÖ Charger les logiciels filtr√©s par sousFormationId\n\n\n    console.log('üì° Chargement des logiciels pour sousFormationId:', this.sousFormationId);\n    this.loading = true;\n    this.logicielService.getLogicielBySousFormationKeejob(this.sousFormationId).subscribe({\n      next: res => {\n        console.log('‚úÖ Logiciels filtr√©s r√©cup√©r√©s:', res);\n        this.logiciels = res || [];\n        this.loading = false;\n      },\n      error: err => {\n        console.error('‚ùå Erreur chargement logiciels filtr√©s:', err); // Fallback: charger tous les logiciels\n\n        this.logicielService.getLogiciel().subscribe({\n          next: allRes => {\n            this.logiciels = allRes || [];\n            this.loading = false;\n          },\n          error: () => {\n            this.logiciels = [];\n            this.loading = false;\n          }\n        });\n      }\n    });\n  }\n\n  onFileSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Veuillez s√©lectionner une image valide',\n          timer: 2000\n        });\n        return;\n      }\n\n      this.selectedImage = file;\n    }\n  }\n\n  addLogiciel() {\n    if (!this.newLogicielName) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Nom du logiciel requis',\n        timer: 2000\n      });\n      return;\n    }\n\n    if (!this.sousFormationId) {\n      console.error('‚ùå sousFormationId manquant');\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur',\n        text: 'Sous-formation non d√©finie',\n        timer: 2000\n      });\n      return;\n    }\n\n    const fd = new FormData();\n    fd.append('name', this.newLogicielName);\n    fd.append('sousFormationKeejobId', this.sousFormationId.toString());\n\n    if (this.selectedImage) {\n      fd.append('image', this.selectedImage, this.selectedImage.name);\n    }\n\n    this.logicielService.addLogiciel(fd).subscribe({\n      next: res => {\n        console.log('‚úÖ Logiciel ajout√©:', res);\n        this.logiciels.push(res);\n        this.toggleLogiciel(res);\n        this.newLogicielName = '';\n        this.selectedImage = null;\n        Swal.fire({\n          icon: 'success',\n          title: 'Logiciel ajout√©!',\n          timer: 1500,\n          showConfirmButton: false\n        });\n      },\n      error: err => {\n        console.error('‚ùå Erreur ajout:', err);\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Impossible d\\'ajouter le logiciel',\n          timer: 2000\n        });\n      }\n    });\n  }\n\n  toggleLogiciel(log) {\n    if (this.isSelected(log)) {\n      this.selectedLogiciels = this.selectedLogiciels.filter(l => l.id !== log.id);\n    } else {\n      this.selectedLogiciels.push(log);\n    }\n\n    this.logicielSelected.emit(this.selectedLogiciels);\n  }\n\n  isSelected(log) {\n    return this.selectedLogiciels.some(l => l.id === log.id);\n  }\n\n  editlogicielFromParent(logiciel) {\n    console.log('üìù Edition logiciel:', logiciel);\n    this.modalMode = 'edit';\n    this.formData = {\n      id: logiciel.id,\n      name: logiciel.name,\n      image: logiciel.image\n    };\n\n    if (this.formData.image) {\n      this.selectedImage = {\n        name: 'Image existante'\n      };\n    }\n\n    this.showModal = true;\n  }\n\n};\n\n__decorate([Input()], LogicielComponent.prototype, \"sousFormationId\", void 0);\n\n__decorate([Output()], LogicielComponent.prototype, \"logicielSelected\", void 0);\n\nLogicielComponent = __decorate([Component({\n  selector: 'app-logiciel',\n  templateUrl: './logiciel.component.html',\n  styleUrls: ['./logiciel.component.css']\n})], LogicielComponent);\nexport { LogicielComponent };","map":null,"metadata":{},"sourceType":"module"}