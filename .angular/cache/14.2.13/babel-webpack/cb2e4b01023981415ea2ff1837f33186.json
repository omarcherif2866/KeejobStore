{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Partenaire } from 'src/app/models/partenaire';\nimport { SousFormationKeejob } from 'src/app/models/sous-formation-keejob';\nimport Swal from 'sweetalert2';\nlet SousFormationKeejobComponent = class SousFormationKeejobComponent {\n  constructor(partenaireservice, sousFormationKeejobervice, authService, router) {\n    this.partenaireservice = partenaireservice;\n    this.sousFormationKeejobervice = sousFormationKeejobervice;\n    this.authService = authService;\n    this.router = router;\n    this.sidebarOpen = true;\n    this.sousFormationKeejob = [];\n    this.partenaires = [];\n    this.selectedPartenaires = [];\n    this.loading = false;\n    this.currentPage = 1;\n    this.itemsPerPage = 5;\n    this.showModal = false;\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      formationKeejob: [],\n      partenaires: []\n    };\n    this.editId = null;\n    this.selectedImage = null;\n  }\n\n  ngOnInit() {\n    this.fetchsousFormationKeejob();\n    this.fetchPartenaires();\n  } // Récupérer les actualités depuis le backend\n\n\n  fetchsousFormationKeejob() {\n    this.loading = true;\n    this.sousFormationKeejobervice.getSousFormationKeejob().subscribe(response => {\n      // Transformer chaque JSON en instance de FormationKeejob\n      this.sousFormationKeejob = response.map(f => new SousFormationKeejob(f.id, f.title, f.description, f.image, f.partenaires, f.formationKeejob));\n      this.sousFormationKeejob = this.sousFormationKeejob; // si pagination ou filtrage\n\n      this.loading = false;\n      console.log('Données reçues: ', this.sousFormationKeejob);\n    }, error => {\n      console.error('Erreur lors du chargement des sousFormationKeejob:', error);\n      this.loading = false;\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur lors du chargement des données',\n        showConfirmButton: false,\n        timer: 1500\n      });\n    });\n  }\n\n  fetchPartenaires() {\n    this.loading = true;\n    this.partenaireservice.getPartenaire().subscribe(response => {\n      // Transformer chaque JSON en instance de Partenaire\n      this.partenaires = response.map(f => new Partenaire(f.id, f.title, f.description, f.image));\n      this.partenaires = this.partenaires; // si pagination ou filtrage\n\n      this.loading = false;\n      console.log('Données reçues: ', this.partenaires);\n    }, error => {\n      console.error('Erreur lors du chargement des partenaires:', error);\n      this.loading = false;\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur lors du chargement des données',\n        showConfirmButton: false,\n        timer: 1500\n      });\n    });\n  } // Pagination\n\n\n  get currentItems() {\n    const indexOfLastItem = this.currentPage * this.itemsPerPage;\n    const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n    return this.sousFormationKeejob.slice(indexOfFirstItem, indexOfLastItem);\n  }\n\n  get totalPages() {\n    return Math.ceil(this.sousFormationKeejob.length / this.itemsPerPage);\n  }\n\n  get pagesArray() {\n    return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n  }\n\n  handlePageChange(pageNumber) {\n    this.currentPage = pageNumber;\n  } // Ajouter un FormationKeejob\n\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      formationKeejob: [],\n      partenaires: []\n    };\n    this.showModal = true;\n  } // Éditer un FormationKeejob\n\n\n  handleEdit(FormationKeejob) {\n    this.modalMode = 'edit';\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      formationKeejob: [],\n      partenaires: []\n    };\n    this.editId = FormationKeejob.Id;\n    this.showModal = true;\n  } // Supprimer une actualité\n\n\n  handleDelete(id) {\n    if (confirm('Êtes-vous sûr de vouloir supprimer cette actualité ?')) {\n      this.sousFormationKeejobervice.deleteSousFormationKeejob(id).subscribe(() => {\n        this.sousFormationKeejob = this.sousFormationKeejob.filter(item => item.Id !== id);\n        Swal.fire({\n          title: 'Success!',\n          text: 'Actualité supprimée avec succès',\n          icon: 'success',\n          confirmButtonText: 'OK',\n          timer: 1500\n        }).then(() => {\n          window.location.reload();\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors de la suppression',\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    }\n  } // Soumettre le formulaire\n\n\n  handleSubmit() {\n    // Vérification des champs obligatoires\n    if (!this.formData.description || !this.formData.title) {\n      alert('Veuillez remplir tous les champs obligatoires');\n      return;\n    } // Créer FormData pour envoyer les données + l'image\n\n\n    const formData = new FormData();\n    formData.append('title', this.formData.title);\n    formData.append('description', this.formData.description); // Ajouter l'image si elle existe\n\n    if (this.selectedImage) {\n      formData.append('image', this.selectedImage, this.selectedImage.name);\n    }\n\n    formData.append(\"partenaireIds\", JSON.stringify(this.selectedPartenaires.map(p => p.id)));\n\n    if (this.modalMode === 'add') {\n      this.sousFormationKeejobervice.addSousFormationKeejob(formData).subscribe(response => {\n        const newFormationKeejob = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, // Ajouter l'image\n        response.Partenaires, response.FormationKeejob);\n        this.sousFormationKeejob.push(newFormationKeejob);\n        this.showModal = false;\n        this.selectedImage = null; // Réinitialiser\n\n        Swal.fire({\n          title: 'Success!',\n          text: 'FormationKeejob ajouté avec succès',\n          icon: 'success',\n          timer: 1500,\n          showConfirmButton: false\n        }).then(() => {\n          window.location.reload();\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors de l\\'ajout',\n          text: error,\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    } else {\n      this.sousFormationKeejobervice.putSousFormationKeejob(this.editId, formData).subscribe(response => {\n        const index = this.sousFormationKeejob.findIndex(item => item.Id === this.editId);\n\n        if (index !== -1) {\n          this.sousFormationKeejob[index] = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, // Ajouter l'image\n          response.Partenaires, response.FormationKeejob);\n        }\n\n        this.showModal = false;\n        this.selectedImage = null; // Réinitialiser\n\n        Swal.fire({\n          title: 'Success!',\n          text: 'FormationKeejob modifié avec succès',\n          icon: 'success',\n          timer: 1500,\n          showConfirmButton: false\n        }).then(() => {\n          window.location.reload();\n        });\n      }, error => {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors de la modification',\n          text: error,\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    }\n  }\n\n  toggleSidebar() {\n    this.sidebarOpen = !this.sidebarOpen;\n  }\n\n  logout() {\n    this.authService.logout();\n    Swal.fire({\n      icon: 'error',\n      title: 'Vous êtes deconnecté',\n      showConfirmButton: false,\n      timer: 1500\n    });\n    this.router.navigate(['/']);\n  }\n\n  onImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      // Vérifier le type de fichier\n      if (!file.type.startsWith('image/')) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Veuillez sélectionner une image valide',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      } // Vérifier la taille (par exemple, max 5MB)\n\n\n      if (file.size > 5 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'L\\'image ne doit pas dépasser 5MB',\n          timer: 1500,\n          showConfirmButton: false\n        });\n        return;\n      }\n\n      this.selectedImage = file;\n    }\n  }\n\n  sanitizeImage(url) {\n    if (!url) return ''; // Cas où l'URL est en double\n\n    if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n      const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n      return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n    }\n\n    return url;\n  }\n\n  togglePartenaire(p) {\n    const index = this.selectedPartenaires.findIndex(x => x.id === p.Id);\n\n    if (index >= 0) {\n      this.selectedPartenaires.splice(index, 1); // désélection\n    } else {\n      this.selectedPartenaires.push(p); // sélection\n    }\n  }\n\n  isSelected(p) {\n    return this.selectedPartenaires.some(x => x.id === p.Id);\n  }\n\n};\nSousFormationKeejobComponent = __decorate([Component({\n  selector: 'app-sous-formation-keejob',\n  templateUrl: './sous-formation-keejob.component.html',\n  styleUrls: ['./sous-formation-keejob.component.css']\n})], SousFormationKeejobComponent);\nexport { SousFormationKeejobComponent };","map":null,"metadata":{},"sourceType":"module"}