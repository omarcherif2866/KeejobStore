{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component, Input, Output, EventEmitter } from '@angular/core';\nimport Swal from 'sweetalert2';\nlet LogicielComponent = class LogicielComponent {\n  constructor(logicielService) {\n    this.logicielService = logicielService;\n    this.showAllLogiciels = true; // ‚úÖ true = tous les logiciels, false = filtr√©s\n\n    this.logicielSelected = new EventEmitter();\n    this.addModeChanged = new EventEmitter();\n    this.loading = false;\n    this.logiciels = [];\n    this.selectedLogiciels = [];\n    this.newLogicielName = '';\n    this.selectedImage = null;\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.showModal = false;\n  }\n\n  ngOnInit() {\n    console.log('üöÄ LogicielComponent ngOnInit');\n    console.log('   - sousFormationId:', this.sousFormationId);\n    console.log('   - showAllLogiciels:', this.showAllLogiciels);\n    this.loadLogiciels();\n  }\n\n  ngOnChanges(changes) {\n    // Recharger si showAllLogiciels change\n    if (changes['showAllLogiciels']) {\n      console.log('üîÑ showAllLogiciels chang√©:', changes['showAllLogiciels'].currentValue);\n      this.loadLogiciels();\n    } // Recharger si sousFormationId change (uniquement si on ne veut pas tous les logiciels)\n\n\n    if (changes['sousFormationId'] && changes['sousFormationId'].currentValue && !this.showAllLogiciels) {\n      console.log('üîÑ sousFormationId chang√©:', changes['sousFormationId'].currentValue);\n      this.loadLogiciels();\n    }\n  }\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.selectedImage = null;\n    this.showModal = true;\n    this.addModeChanged.emit(true); // pr√©vient le parent : mode ajout actif\n  }\n\n  closeModal() {\n    this.showModal = false;\n    this.formData = {\n      id: null,\n      name: '',\n      image: ''\n    };\n    this.selectedImage = null;\n    this.addModeChanged.emit(false); // pr√©vient le parent : mode ajout ferm√©\n  }\n\n  loadLogiciels() {\n    // ‚úÖ OPTION 1 : Si showAllLogiciels = true, charger TOUS les logiciels\n    if (this.showAllLogiciels) {\n      console.log('üì° Chargement de TOUS les logiciels (sans filtre)');\n      this.loading = true;\n      this.logicielService.getLogiciel().subscribe({\n        next: res => {\n          console.log('‚úÖ Tous les logiciels r√©cup√©r√©s:', res);\n          this.logiciels = res || [];\n          this.loading = false;\n        },\n        error: err => {\n          console.error('‚ùå Erreur chargement logiciels:', err);\n          this.logiciels = [];\n          this.loading = false;\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'Impossible de charger les logiciels',\n            timer: 2000\n          });\n        }\n      });\n      return;\n    } // ‚úÖ OPTION 2 : Charger les logiciels filtr√©s par sousFormationId\n\n\n    if (!this.sousFormationId) {\n      console.warn('‚ö†Ô∏è Aucun sousFormationId fourni, chargement de tous les logiciels par d√©faut');\n      this.loading = true;\n      this.logicielService.getLogiciel().subscribe({\n        next: res => {\n          console.log('‚úÖ Tous les logiciels r√©cup√©r√©s (par d√©faut):', res);\n          this.logiciels = res || [];\n          this.loading = false;\n        },\n        error: err => {\n          console.error('‚ùå Erreur chargement logiciels:', err);\n          this.logiciels = [];\n          this.loading = false;\n        }\n      });\n      return;\n    }\n\n    console.log('üì° Chargement des logiciels pour sousFormationId:', this.sousFormationId);\n    this.loading = true;\n    this.logicielService.getLogicielBySousFormationKeejob(this.sousFormationId).subscribe({\n      next: res => {\n        console.log('‚úÖ Logiciels filtr√©s r√©cup√©r√©s:', res);\n        this.logiciels = res || [];\n        this.loading = false;\n      },\n      error: err => {\n        console.error('‚ùå Erreur chargement logiciels filtr√©s:', err); // Fallback: charger tous les logiciels\n\n        this.logicielService.getLogiciel().subscribe({\n          next: allRes => {\n            console.log('‚ö†Ô∏è Fallback: tous les logiciels charg√©s');\n            this.logiciels = allRes || [];\n            this.loading = false;\n          },\n          error: () => {\n            this.logiciels = [];\n            this.loading = false;\n            Swal.fire({\n              icon: 'error',\n              title: 'Erreur',\n              text: 'Impossible de charger les logiciels',\n              timer: 2000\n            });\n          }\n        });\n      }\n    });\n  }\n\n  onFileSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      if (!file.type.startsWith('image/')) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'Veuillez s√©lectionner une image valide',\n          timer: 2000\n        });\n        return;\n      }\n\n      if (file.size > 5 * 1024 * 1024) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: 'L\\'image ne doit pas d√©passer 5MB',\n          timer: 2000\n        });\n        return;\n      }\n\n      this.selectedImage = file;\n    }\n  }\n\n  addLogiciel() {\n    if (!this.newLogicielName.trim()) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Nom du logiciel requis',\n        timer: 2000\n      });\n      return;\n    }\n\n    const fd = new FormData();\n    fd.append('name', this.newLogicielName.trim()); // ‚úÖ Si on a un sousFormationId, on l'ajoute (sinon logiciel global)\n\n    if (this.sousFormationId) {\n      fd.append('sousFormationKeejobId', this.sousFormationId.toString());\n    }\n\n    if (this.selectedImage) {\n      fd.append('image', this.selectedImage, this.selectedImage.name);\n    }\n\n    this.logicielService.addLogiciel(fd).subscribe({\n      next: res => {\n        console.log('‚úÖ Logiciel ajout√©:', res); // Ajouter √† la liste locale\n\n        this.logiciels.push(res); // S√©lectionner automatiquement le nouveau logiciel\n\n        this.toggleLogiciel(res); // R√©initialiser le formulaire\n\n        this.newLogicielName = '';\n        this.selectedImage = null;\n        this.closeModal();\n        Swal.fire({\n          icon: 'success',\n          title: 'Logiciel ajout√©!',\n          timer: 1500,\n          showConfirmButton: false\n        });\n      },\n      error: err => {\n        var _a;\n\n        console.error('‚ùå Erreur ajout:', err);\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur',\n          text: ((_a = err.error) === null || _a === void 0 ? void 0 : _a.message) || 'Impossible d\\'ajouter le logiciel',\n          timer: 2000\n        });\n      }\n    });\n  }\n\n  toggleLogiciel(log) {\n    const index = this.selectedLogiciels.findIndex(l => l.id === log.id);\n\n    if (index > -1) {\n      // D√©s√©lectionner\n      this.selectedLogiciels.splice(index, 1);\n    } else {\n      // S√©lectionner\n      this.selectedLogiciels.push(log);\n    }\n\n    console.log('üìã Logiciels s√©lectionn√©s:', this.selectedLogiciels);\n    this.logicielSelected.emit(this.selectedLogiciels);\n  }\n\n  isSelected(log) {\n    return this.selectedLogiciels.some(l => l.id === log.id);\n  }\n\n  editlogicielFromParent(logiciel) {\n    console.log('üìù Edition logiciel:', logiciel);\n    this.modalMode = 'edit';\n    this.formData = {\n      id: logiciel.id,\n      name: logiciel.name,\n      image: logiciel.image\n    };\n    this.newLogicielName = logiciel.name;\n\n    if (this.formData.image) {\n      this.selectedImage = {\n        name: 'Image existante'\n      };\n    }\n\n    this.showModal = true;\n  } // ‚úÖ M√©thode publique pour forcer le rechargement (appel√©e depuis le parent)\n\n\n  refreshLogiciels() {\n    console.log('üîÑ Rechargement forc√© des logiciels');\n    this.loadLogiciels();\n  }\n\n};\n\n__decorate([Input()], LogicielComponent.prototype, \"sousFormationId\", void 0);\n\n__decorate([Input()], LogicielComponent.prototype, \"showAllLogiciels\", void 0);\n\n__decorate([Output()], LogicielComponent.prototype, \"logicielSelected\", void 0);\n\n__decorate([Output()], LogicielComponent.prototype, \"addModeChanged\", void 0);\n\nLogicielComponent = __decorate([Component({\n  selector: 'app-logiciel',\n  templateUrl: './logiciel.component.html',\n  styleUrls: ['./logiciel.component.css']\n})], LogicielComponent);\nexport { LogicielComponent };","map":null,"metadata":{},"sourceType":"module"}