{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FormationKeejob } from 'src/app/models/formation-keejob';\nimport Swal from 'sweetalert2';\nlet FormationKeejobComponent = class FormationKeejobComponent {\n  constructor(formationsKeejobService, // Remplacer par votre service\n  sousFormationService // Remplacer par votre service\n  ) {\n    this.formationsKeejobService = formationsKeejobService;\n    this.sousFormationService = sousFormationService; // Variables pour le stepper\n\n    this.currentStep = 1;\n    this.maxSteps = 2; // FormationKeejob créée à l'étape 1\n\n    this.createdFormationKeejob = null; // Variables pour l'étape 1 (FormationKeejob)\n\n    this.showModal = false;\n    this.modalMode = 'add';\n    this.editId = null;\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: []\n    };\n    this.selectedImage = null;\n    this.selectedPartenaires = [];\n    this.formationsKeejob = []; // Variables pour l'étape 2 (SousFormationKeejob)\n\n    this.sousFormations = [];\n    this.showSousFormationModal = false;\n    this.sousFormationData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: [],\n      formationKeejobId: null\n    };\n    this.selectedSousImage = null;\n    this.selectedSousPartenaires = [];\n  }\n\n  ngOnInit() {// Initialisation si nécessaire\n  } // ============== GESTION DU STEPPER ==============\n\n\n  nextStep() {\n    if (this.currentStep < this.maxSteps) {\n      this.currentStep++;\n    }\n  }\n\n  previousStep() {\n    if (this.currentStep > 1) {\n      this.currentStep--;\n    }\n  }\n\n  resetStepper() {\n    this.currentStep = 1;\n    this.createdFormationKeejob = null;\n    this.sousFormations = [];\n    this.resetFormData();\n  } // ============== ÉTAPE 1 : FormationKeejob ==============\n\n\n  handleAdd() {\n    this.modalMode = 'add';\n    this.resetFormData();\n    this.showModal = true;\n  }\n\n  resetFormData() {\n    this.formData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: []\n    };\n    this.selectedImage = null;\n    this.selectedPartenaires = [];\n  }\n\n  onImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      this.selectedImage = file;\n    }\n  }\n\n  handleSubmitFormation() {\n    // Vérification des champs obligatoires\n    if (!this.formData.description || !this.formData.title) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Veuillez remplir tous les champs obligatoires',\n        showConfirmButton: true\n      });\n      return;\n    } // Créer FormData pour envoyer les données + l'image\n\n\n    const formData = new FormData();\n    formData.append('title', this.formData.title);\n    formData.append('description', this.formData.description); // Ajouter l'image si elle existe\n\n    if (this.selectedImage) {\n      formData.append('image', this.selectedImage, this.selectedImage.name);\n    }\n\n    formData.append('partenaireIds', JSON.stringify(this.selectedPartenaires.map(p => p.id))); // Ajouter la FormationKeejob\n\n    this.formationsKeejobService.addFormationKeejob(formData).subscribe(response => {\n      this.createdFormationKeejob = new FormationKeejob(response.Id, response.Title, response.Description, response.Image, response.Partenaires);\n      this.showModal = false;\n      this.selectedImage = null;\n      Swal.fire({\n        title: 'Succès!',\n        text: 'FormationKeejob créée avec succès',\n        icon: 'success',\n        timer: 1500,\n        showConfirmButton: false\n      }).then(() => {\n        // Passer à l'étape 2\n        this.nextStep();\n      });\n    }, error => {\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur lors de l\\'ajout',\n        text: error,\n        showConfirmButton: true\n      });\n    });\n  } // ============== ÉTAPE 2 : SousFormationKeejob ==============\n\n\n  handleAddSousFormation() {\n    this.resetSousFormationData();\n    this.showSousFormationModal = true;\n  }\n\n  resetSousFormationData() {\n    var _a;\n\n    this.sousFormationData = {\n      id: null,\n      title: '',\n      description: '',\n      image: '',\n      partenaires: [],\n      formationKeejobId: ((_a = this.createdFormationKeejob) === null || _a === void 0 ? void 0 : _a.Id) || null\n    };\n    this.selectedSousImage = null;\n    this.selectedSousPartenaires = [];\n  }\n\n  onSousImageSelected(event) {\n    const file = event.target.files[0];\n\n    if (file) {\n      this.selectedSousImage = file;\n    }\n  }\n\n  handleSubmitSousFormation() {\n    // Vérification des champs obligatoires\n    if (!this.sousFormationData.description || !this.sousFormationData.title) {\n      Swal.fire({\n        icon: 'warning',\n        title: 'Attention',\n        text: 'Veuillez remplir tous les champs obligatoires',\n        showConfirmButton: true\n      });\n      return;\n    }\n\n    if (!this.createdFormationKeejob) {\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur',\n        text: 'Aucune FormationKeejob associée',\n        showConfirmButton: true\n      });\n      return;\n    } // Créer FormData pour envoyer les données + l'image\n\n\n    const formData = new FormData();\n    formData.append('title', this.sousFormationData.title);\n    formData.append('description', this.sousFormationData.description);\n    formData.append('formationKeejobId', this.createdFormationKeejob.Id.toString()); // Ajouter l'image si elle existe\n\n    if (this.selectedSousImage) {\n      formData.append('image', this.selectedSousImage, this.selectedSousImage.name);\n    }\n\n    formData.append('partenaireIds', JSON.stringify(this.selectedSousPartenaires.map(p => p.id))); // Ajouter la SousFormationKeejob\n\n    this.sousFormationService.addSousFormationKeejob(formData).subscribe(response => {\n      const newSousFormation = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, response.Partenaires, this.createdFormationKeejob);\n      this.sousFormations.push(newSousFormation);\n      this.showSousFormationModal = false;\n      this.selectedSousImage = null;\n      Swal.fire({\n        title: 'Succès!',\n        text: 'Sous-formation ajoutée avec succès',\n        icon: 'success',\n        timer: 1500,\n        showConfirmButton: false\n      });\n    }, error => {\n      Swal.fire({\n        icon: 'error',\n        title: 'Erreur lors de l\\'ajout',\n        text: error,\n        showConfirmButton: true\n      });\n    });\n  }\n\n  finishProcess() {\n    Swal.fire({\n      title: 'Processus terminé!',\n      text: `Formation créée avec ${this.sousFormations.length} sous-formation(s)`,\n      icon: 'success',\n      confirmButtonText: 'OK'\n    }).then(() => {\n      // Rediriger ou recharger\n      window.location.reload();\n    });\n  }\n\n  cancelProcess() {\n    Swal.fire({\n      title: 'Êtes-vous sûr?',\n      text: 'Voulez-vous annuler le processus?',\n      icon: 'warning',\n      showCancelButton: true,\n      confirmButtonText: 'Oui, annuler',\n      cancelButtonText: 'Non, continuer'\n    }).then(result => {\n      if (result.isConfirmed) {\n        this.resetStepper();\n      }\n    });\n  }\n\n};\nFormationKeejobComponent = __decorate([Component({\n  selector: 'app-formation-keejob',\n  templateUrl: './formation-keejob.component.html',\n  styleUrls: ['./formation-keejob.component.css']\n})], FormationKeejobComponent);\nexport { FormationKeejobComponent };","map":null,"metadata":{},"sourceType":"module"}