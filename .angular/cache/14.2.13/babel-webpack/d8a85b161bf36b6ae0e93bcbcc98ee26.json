{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core'; // import { Router } from 'next/router';\n\nimport { Role, User } from 'src/app/models/user';\nimport Swal from 'sweetalert2';\nlet LoginComponent = class LoginComponent {\n  constructor(authService, router) {\n    this.authService = authService;\n    this.router = router;\n    this.user = new User(\"\", '', '', false, '', Role.SIMPLEU);\n  }\n\n  ngOnInit() {}\n\n  login() {\n    const loginData = {\n      username: this.user.Username,\n      password: this.user.Password\n    };\n    this.authService.login(loginData).subscribe(response => {\n      console.log('Response received:', response);\n\n      if (response && response.role && response.accessToken) {\n        // Store user role and access token in localStorage\n        localStorage.setItem(\"userRole\", response.role);\n        localStorage.setItem(\"accessToken\", response.accessToken); // Store user ID from token in localStorage\n\n        this.authService.storeUserIdFromToken(); // Redirect based on user role (assuming role is determined from response)\n\n        const role = response.role;\n\n        if (role === 'Admin') {// this.router.navigate(['profil/', this.authService.getUserId()]); // Redirect to admin profile with user ID\n        } else if (role === 'SIMPLEU') {\n          this.router.navigate(['/', this.authService.getUserId()]); // Redirect to normal user profile with user ID\n        } // Show success message\n\n\n        Swal.fire({\n          icon: 'success',\n          title: 'Connected',\n          showConfirmButton: false,\n          timer: 1500 // Auto hide after 1.5 seconds\n\n        });\n        console.log(\"Connected\");\n      } else {\n        // Handle errors if role or necessary data is missing in the response\n        console.error(\"Role or essential data missing in login response\", response);\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: 'An error occurred during login'\n        });\n      }\n    }, error => {\n      // Handle HTTP errors\n      if (error.status === 401) {\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: 'Incorrect username or password'\n        });\n      } else if (error.status === 403) {\n        // Handle account blocked scenario\n        Swal.fire({\n          icon: 'warning',\n          title: 'Votre Compte est bloqué',\n          text: 'Votre compte a été bloqué. Veuillez contacter l’assistance.'\n        });\n      } else {\n        Swal.fire({\n          icon: 'error',\n          title: 'Error',\n          text: 'An error occurred during login'\n        });\n      }\n\n      console.error(\"Login error\", error);\n    });\n  }\n\n};\nLoginComponent = __decorate([Component({\n  selector: 'app-login',\n  templateUrl: './login.component.html',\n  styleUrls: ['./login.component.css']\n})], LoginComponent);\nexport { LoginComponent };","map":null,"metadata":{},"sourceType":"module"}