{"ast":null,"code":"// import { Component, OnInit } from '@angular/core';\n// import { Router } from '@angular/router';\n// import { FormationKeejob } from 'src/app/models/formation-keejob';\n// import { Partenaire } from 'src/app/models/partenaire';\n// import { AuthService } from 'src/app/services/auth.service';\n// import { FormationKeejobService } from 'src/app/services/formation-keejob.service';\n// import { PartenaireService } from 'src/app/services/partenaire.service';\n// import Swal from 'sweetalert2';\n// @Component({\n//   selector: 'app-formation-keejob',\n//   templateUrl: './formation-keejob.component.html',\n//   styleUrls: ['./formation-keejob.component.css']\n// })\n// export class FormationKeejobComponent implements OnInit {\n// sidebarOpen = true;\n//   formationsKeejob: FormationKeejob[] = [];\n//   partenaires: Partenaire[] = [];\n//   selectedPartenaires: any[] = [];\n//   loading = false;\n//   currentPage = 1;\n//   itemsPerPage = 5;\n//   showModal = false;\n//   modalMode: 'add' | 'edit' = 'add';\n//   formData = {\n//     id: null,\n//     title: '',\n//     description: '',\n//     image:'',\n//     partenaires: []\n//   };\n//   editId: any = null;\n//   selectedImage: File | null = null;\n//   constructor(private partenaireservice: PartenaireService, private formationsKeejobervice: FormationKeejobService, private authService: AuthService,private router:Router) {}\n//   ngOnInit() {\n//     this.fetchformationsKeejob();\n//     this.fetchPartenaires();\n//   }\n//   // Récupérer les actualités depuis le backend\n//   fetchformationsKeejob() {\n//     this.loading = true;\n//     this.formationsKeejobervice.getFormationKeejob().subscribe(\n//       (response: any[]) => {\n//         // Transformer chaque JSON en instance de FormationKeejob\n//         this.formationsKeejob = response.map(f => new FormationKeejob(\n//           f.id,\n//           f.title,\n//           f.description,\n//           f.image,\n//         ));\n//         this.formationsKeejob = this.formationsKeejob; // si pagination ou filtrage\n//         this.loading = false;\n//         console.log('Données reçues: ', this.formationsKeejob);\n//       },\n//       (error) => {\n//         console.error('Erreur lors du chargement des formationsKeejob:', error);\n//         this.loading = false;\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors du chargement des données',\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   }\n//     fetchPartenaires() {\n//       this.loading = true;\n//       this.partenaireservice.getPartenaire().subscribe(\n//         (response: any[]) => {\n//           // Transformer chaque JSON en instance de Partenaire\n//           this.partenaires = response.map(f => new Partenaire(\n//             f.id,\n//             f.title,\n//             f.description,\n//             f.image,\n//           ));\n//           this.partenaires = this.partenaires; // si pagination ou filtrage\n//           this.loading = false;\n//           console.log('Données reçues: ', this.partenaires);\n//         },\n//         (error) => {\n//           console.error('Erreur lors du chargement des partenaires:', error);\n//           this.loading = false;\n//           Swal.fire({\n//             icon: 'error',\n//             title: 'Erreur lors du chargement des données',\n//             showConfirmButton: false,\n//             timer: 1500\n//           });\n//         }\n//       );\n//     }\n//   // Pagination\n//   get currentItems(): FormationKeejob[] {\n//     const indexOfLastItem = this.currentPage * this.itemsPerPage;\n//     const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n//     return this.formationsKeejob.slice(indexOfFirstItem, indexOfLastItem);\n//   }\n//   get totalPages(): number {\n//     return Math.ceil(this.formationsKeejob.length / this.itemsPerPage);\n//   }\n//   get pagesArray(): number[] {\n//     return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n//   }\n//   handlePageChange(pageNumber: number) {\n//     this.currentPage = pageNumber;\n//   }\n// // Ajouter un FormationKeejob\n// handleAdd() {\n//   this.modalMode = 'add';\n//   this.formData = {\n//     id: null,\n//     title: '',\n//     description: '',\n//     image: '',\n//     partenaires: []\n//   };\n//   this.showModal = true;\n// }\n// // Éditer un FormationKeejob\n// handleEdit(FormationKeejob: FormationKeejob) {\n//   this.modalMode = 'edit';\n//   this.formData = {\n//     id: FormationKeejob.Id,\n//     title: FormationKeejob.Title,\n//     description: FormationKeejob.Description,\n//     image: FormationKeejob.Image,\n//     partenaires: FormationKeejob.Partenaires,\n//   };\n//   this.editId = FormationKeejob.Id;\n//   this.showModal = true;\n// }\n//   // Supprimer une actualité\n//   handleDelete(id: any) {\n//     if (confirm('Êtes-vous sûr de vouloir supprimer cette actualité ?')) {\n//       this.formationsKeejobervice.deleteFormationKeejob(id).subscribe(\n//         () => {\n//           this.formationsKeejob = this.formationsKeejob.filter(item => item.Id !== id);\n//           Swal.fire({\n//             title: 'Success!',\n//             text: 'Actualité supprimée avec succès',\n//             icon: 'success',\n//             confirmButtonText: 'OK',\n//             timer: 1500,\n//           }).then(() => {\n//             window.location.reload();\n//           });         \n//         },\n//         (error) => {\n//           Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de la suppression',\n//           showConfirmButton: false,\n//           timer: 1500\n//         });          \n//         }\n//       );\n//     }\n//   }\n//   // Soumettre le formulaire\n// handleSubmit() {\n//   // Vérification des champs obligatoires\n//   if (\n//     !this.formData.description || !this.formData.title   ) {\n//     alert('Veuillez remplir tous les champs obligatoires');\n//     return;\n//   }\n//   // Créer FormData pour envoyer les données + l'image\n//   const formData = new FormData();\n//   formData.append('title', this.formData.title);\n//   formData.append('description', this.formData.description);\n//   // Ajouter l'image si elle existe\n//   if (this.selectedImage) {\n//     formData.append('image', this.selectedImage, this.selectedImage.name);\n//   }\n//   formData.append(\"partenaireIds\", JSON.stringify(\n//   this.selectedPartenaires.map(p => p.id)\n// ));\n//   if (this.modalMode === 'add') {\n//     this.formationsKeejobervice.addFormationKeejob(formData).subscribe(\n//       (response) => {\n//         const newFormationKeejob = new FormationKeejob(\n//             response.Id,\n//             response.Title,\n//             response.Description,\n//             response.Image, // Ajouter l'image\n//             response.Partenaires \n//         );\n//         this.formationsKeejob.push(newFormationKeejob);\n//         this.showModal = false;\n//         this.selectedImage = null; // Réinitialiser\n//         Swal.fire({\n//           title: 'Success!',\n//           text: 'FormationKeejob ajouté avec succès',\n//           icon: 'success',\n//           timer: 1500,\n//           showConfirmButton: false\n//         }).then(() => {\n//           window.location.reload();\n//         });\n//       },\n//       (error) => {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de l\\'ajout',\n//           text: error,\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   } else {\n//     this.formationsKeejobervice.putFormationKeejob(this.editId, formData).subscribe(\n//       (response) => {\n//         const index = this.formationsKeejob.findIndex(item => item.Id === this.editId);\n//         if (index !== -1) {\n//           this.formationsKeejob[index] = new FormationKeejob(\n//             response.Id,\n//             response.Title,\n//             response.Description,\n//             response.Image ,\n//             response.Partenaires \n//           );\n//         }\n//         this.showModal = false;\n//         this.selectedImage = null; // Réinitialiser\n//         Swal.fire({\n//           title: 'Success!',\n//           text: 'FormationKeejob modifié avec succès',\n//           icon: 'success',\n//           timer: 1500,\n//           showConfirmButton: false\n//         }).then(() => {\n//           window.location.reload();\n//         });\n//       },\n//       (error) => {\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Erreur lors de la modification',\n//           text: error,\n//           showConfirmButton: false,\n//           timer: 1500\n//         });\n//       }\n//     );\n//   }\n// }\n//   toggleSidebar() {\n//     this.sidebarOpen = !this.sidebarOpen;\n//   }\n//     logout(): void {\n//         this.authService.logout();\n//         Swal.fire({\n//           icon: 'error',\n//           title: 'Vous êtes deconnecté',\n//           showConfirmButton: false,\n//           timer: 1500\n//         }); \n//         this.router.navigate(['/']);\n//       }\n// onImageSelected(event: any) {\n//   const file = event.target.files[0];\n//   if (file) {\n//     // Vérifier le type de fichier\n//     if (!file.type.startsWith('image/')) {\n//       Swal.fire({\n//         icon: 'error',\n//         title: 'Erreur',\n//         text: 'Veuillez sélectionner une image valide',\n//         timer: 1500,\n//         showConfirmButton: false\n//       });\n//       return;\n//     }\n//     // Vérifier la taille (par exemple, max 5MB)\n//     if (file.size > 5 * 1024 * 1024) {\n//       Swal.fire({\n//         icon: 'error',\n//         title: 'Erreur',\n//         text: 'L\\'image ne doit pas dépasser 5MB',\n//         timer: 1500,\n//         showConfirmButton: false\n//       });\n//       return;\n//     }\n//     this.selectedImage = file;\n//   }\n// }\n// sanitizeImage(url: string): string {\n//   if (!url) return '';\n//   // Cas où l'URL est en double\n//   if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n//     const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n//     return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n//   }\n//   return url;\n// }\n// togglePartenaire(p: Partenaire) {\n//   const index = this.selectedPartenaires.findIndex(x => x.id === p.Id);\n//   if (index >= 0) {\n//     this.selectedPartenaires.splice(index, 1); // désélection\n//   } else {\n//     this.selectedPartenaires.push(p); // sélection\n//   }\n// }\n// isSelected(p: Partenaire): boolean {\n//   return this.selectedPartenaires.some(x => x.id === p.Id);\n// }\n// }","map":null,"metadata":{},"sourceType":"script"}