{"ast":null,"code":"import { Partenaire } from 'src/app/models/partenaire';\nimport { SousFormationKeejob } from 'src/app/models/sous-formation-keejob';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/services/partenaire.service\";\nimport * as i2 from \"src/app/services/sous-formation-keejob.service\";\nimport * as i3 from \"src/app/services/auth.service\";\nimport * as i4 from \"@angular/router\";\nexport let SousFormationKeejobComponent = /*#__PURE__*/(() => {\n  class SousFormationKeejobComponent {\n    constructor(partenaireservice, sousFormationKeejobervice, authService, router) {\n      this.partenaireservice = partenaireservice;\n      this.sousFormationKeejobervice = sousFormationKeejobervice;\n      this.authService = authService;\n      this.router = router;\n      this.sidebarOpen = true;\n      this.sousFormationKeejob = [];\n      this.partenaires = [];\n      this.selectedPartenaires = [];\n      this.loading = false;\n      this.currentPage = 1;\n      this.itemsPerPage = 5;\n      this.showModal = false;\n      this.modalMode = 'add';\n      this.formData = {\n        id: null,\n        title: '',\n        description: '',\n        image: '',\n        formationKeejob: [],\n        partenaires: []\n      };\n      this.editId = null;\n      this.selectedImage = null;\n    }\n\n    ngOnInit() {\n      this.fetchsousFormationKeejob();\n      this.fetchPartenaires();\n\n      if (this.formationId) {\n        console.log(\"ID de la formation reçu:\", this.formationId); // tu peux charger les sous-formations liées à cette formation ici\n      }\n    } // Récupérer les actualités depuis le backend\n\n\n    fetchsousFormationKeejob() {\n      this.loading = true;\n      this.sousFormationKeejobervice.getSousFormationKeejob().subscribe(response => {\n        // Transformer chaque JSON en instance de FormationKeejob\n        this.sousFormationKeejob = response.map(f => new SousFormationKeejob(f.id, f.title, f.description, f.image, f.partenaires, f.formationKeejob));\n        this.sousFormationKeejob = this.sousFormationKeejob; // si pagination ou filtrage\n\n        this.loading = false;\n        console.log('Données reçues: ', this.sousFormationKeejob);\n      }, error => {\n        console.error('Erreur lors du chargement des sousFormationKeejob:', error);\n        this.loading = false;\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors du chargement des données',\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    }\n\n    fetchPartenaires() {\n      this.loading = true;\n      this.partenaireservice.getPartenaire().subscribe(response => {\n        // Transformer chaque JSON en instance de Partenaire\n        this.partenaires = response.map(f => new Partenaire(f.id, f.title, f.description, f.image));\n        this.partenaires = this.partenaires; // si pagination ou filtrage\n\n        this.loading = false;\n        console.log('Données reçues: ', this.partenaires);\n      }, error => {\n        console.error('Erreur lors du chargement des partenaires:', error);\n        this.loading = false;\n        Swal.fire({\n          icon: 'error',\n          title: 'Erreur lors du chargement des données',\n          showConfirmButton: false,\n          timer: 1500\n        });\n      });\n    } // Pagination\n\n\n    get currentItems() {\n      const indexOfLastItem = this.currentPage * this.itemsPerPage;\n      const indexOfFirstItem = indexOfLastItem - this.itemsPerPage;\n      return this.sousFormationKeejob.slice(indexOfFirstItem, indexOfLastItem);\n    }\n\n    get totalPages() {\n      return Math.ceil(this.sousFormationKeejob.length / this.itemsPerPage);\n    }\n\n    get pagesArray() {\n      return Array(this.totalPages).fill(0).map((_, i) => i + 1);\n    }\n\n    handlePageChange(pageNumber) {\n      this.currentPage = pageNumber;\n    } // Ajouter un FormationKeejob\n\n\n    handleAdd() {\n      this.modalMode = 'add';\n      this.formData = {\n        id: null,\n        title: '',\n        description: '',\n        image: '',\n        formationKeejob: [],\n        partenaires: []\n      };\n      this.showModal = true;\n    } // Éditer un FormationKeejob\n\n\n    handleEdit(FormationKeejob) {\n      this.modalMode = 'edit';\n      this.formData = {\n        id: null,\n        title: '',\n        description: '',\n        image: '',\n        formationKeejob: [],\n        partenaires: []\n      };\n      this.editId = FormationKeejob.Id;\n      this.showModal = true;\n    } // Supprimer une actualité\n\n\n    handleDelete(id) {\n      if (confirm('Êtes-vous sûr de vouloir supprimer cette actualité ?')) {\n        this.sousFormationKeejobervice.deleteSousFormationKeejob(id).subscribe(() => {\n          this.sousFormationKeejob = this.sousFormationKeejob.filter(item => item.Id !== id);\n          Swal.fire({\n            title: 'Success!',\n            text: 'Actualité supprimée avec succès',\n            icon: 'success',\n            confirmButtonText: 'OK',\n            timer: 1500\n          }).then(() => {\n            window.location.reload();\n          });\n        }, error => {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur lors de la suppression',\n            showConfirmButton: false,\n            timer: 1500\n          });\n        });\n      }\n    } // Soumettre le formulaire\n\n\n    handleSubmit() {\n      // Vérification des champs obligatoires\n      if (!this.formData.description || !this.formData.title) {\n        alert('Veuillez remplir tous les champs obligatoires');\n        return;\n      } // Créer FormData pour envoyer les données + l'image\n\n\n      const formData = new FormData();\n      formData.append('title', this.formData.title);\n      formData.append('description', this.formData.description); // Ajouter l'image si elle existe\n\n      if (this.selectedImage) {\n        formData.append('image', this.selectedImage, this.selectedImage.name);\n      }\n\n      formData.append(\"partenaireIds\", JSON.stringify(this.selectedPartenaires.map(p => p.id)));\n\n      if (this.modalMode === 'add') {\n        this.sousFormationKeejobervice.addSousFormationKeejob(formData).subscribe(response => {\n          const newFormationKeejob = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, // Ajouter l'image\n          response.Partenaires, response.FormationKeejob);\n          this.sousFormationKeejob.push(newFormationKeejob);\n          this.showModal = false;\n          this.selectedImage = null; // Réinitialiser\n\n          Swal.fire({\n            title: 'Success!',\n            text: 'FormationKeejob ajouté avec succès',\n            icon: 'success',\n            timer: 1500,\n            showConfirmButton: false\n          }).then(() => {\n            window.location.reload();\n          });\n        }, error => {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur lors de l\\'ajout',\n            text: error,\n            showConfirmButton: false,\n            timer: 1500\n          });\n        });\n      } else {\n        this.sousFormationKeejobervice.putSousFormationKeejob(this.editId, formData).subscribe(response => {\n          const index = this.sousFormationKeejob.findIndex(item => item.Id === this.editId);\n\n          if (index !== -1) {\n            this.sousFormationKeejob[index] = new SousFormationKeejob(response.Id, response.Title, response.Description, response.Image, // Ajouter l'image\n            response.Partenaires, response.FormationKeejob);\n          }\n\n          this.showModal = false;\n          this.selectedImage = null; // Réinitialiser\n\n          Swal.fire({\n            title: 'Success!',\n            text: 'FormationKeejob modifié avec succès',\n            icon: 'success',\n            timer: 1500,\n            showConfirmButton: false\n          }).then(() => {\n            window.location.reload();\n          });\n        }, error => {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur lors de la modification',\n            text: error,\n            showConfirmButton: false,\n            timer: 1500\n          });\n        });\n      }\n    }\n\n    toggleSidebar() {\n      this.sidebarOpen = !this.sidebarOpen;\n    }\n\n    logout() {\n      this.authService.logout();\n      Swal.fire({\n        icon: 'error',\n        title: 'Vous êtes deconnecté',\n        showConfirmButton: false,\n        timer: 1500\n      });\n      this.router.navigate(['/']);\n    }\n\n    onImageSelected(event) {\n      const file = event.target.files[0];\n\n      if (file) {\n        // Vérifier le type de fichier\n        if (!file.type.startsWith('image/')) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'Veuillez sélectionner une image valide',\n            timer: 1500,\n            showConfirmButton: false\n          });\n          return;\n        } // Vérifier la taille (par exemple, max 5MB)\n\n\n        if (file.size > 5 * 1024 * 1024) {\n          Swal.fire({\n            icon: 'error',\n            title: 'Erreur',\n            text: 'L\\'image ne doit pas dépasser 5MB',\n            timer: 1500,\n            showConfirmButton: false\n          });\n          return;\n        }\n\n        this.selectedImage = file;\n      }\n    }\n\n    sanitizeImage(url) {\n      if (!url) return ''; // Cas où l'URL est en double\n\n      if (url.includes(\"https://res.cloudinary.com\") && url.split(\"https://res.cloudinary.com\").length > 2) {\n        const parts = url.split(\"https://res.cloudinary.com/daxkymr4t/image/upload/\");\n        return \"https://res.cloudinary.com/daxkymr4t/image/upload/\" + parts[parts.length - 1];\n      }\n\n      return url;\n    }\n\n    togglePartenaire(p) {\n      const index = this.selectedPartenaires.findIndex(x => x.id === p.Id);\n\n      if (index >= 0) {\n        this.selectedPartenaires.splice(index, 1); // désélection\n      } else {\n        this.selectedPartenaires.push(p); // sélection\n      }\n    }\n\n    isSelected(p) {\n      return this.selectedPartenaires.some(x => x.id === p.Id);\n    }\n\n  }\n\n  SousFormationKeejobComponent.ɵfac = function SousFormationKeejobComponent_Factory(t) {\n    return new (t || SousFormationKeejobComponent)(i0.ɵɵdirectiveInject(i1.PartenaireService), i0.ɵɵdirectiveInject(i2.SousFormationKeejobService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.Router));\n  };\n\n  SousFormationKeejobComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: SousFormationKeejobComponent,\n    selectors: [[\"app-sous-formation-keejob\"]],\n    inputs: {\n      formationId: \"formationId\"\n    },\n    decls: 1,\n    vars: 0,\n    template: function SousFormationKeejobComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtext(0, \"\\nE3E3\");\n      }\n    },\n    styles: [\".app-container[_ngcontent-%COMP%]{display:flex;height:100vh;background-color:#f3f4f6;font-family:Segoe UI,Tahoma,Geneva,Verdana,sans-serif}.sidebar[_ngcontent-%COMP%]{width:0;background-color:#111827;color:#fff;overflow:hidden;transition:width .3s}.sidebar.open[_ngcontent-%COMP%]{width:250px}.sidebar-content[_ngcontent-%COMP%]{padding:24px}.sidebar[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;font-weight:700;margin-bottom:2.5rem}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;align-items:center;padding:12px 15px;margin-bottom:5px;border-radius:8px;text-decoration:none;color:#d1d5db;transition:background .3s,color .3s}.sidebar[_ngcontent-%COMP%]   nav[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#1f2937;color:#fff}.icon[_ngcontent-%COMP%]{width:24px;height:24px;margin-right:10px}.main-area[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column}header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:24px;background-color:#fff;box-shadow:0 2px 4px #0000001a;position:sticky;top:0;z-index:10}header[_ngcontent-%COMP%]   .sidebar-toggle[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer}header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1f2937}.spacer[_ngcontent-%COMP%]{width:40px}.content-box[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;box-shadow:0 4px 8px #0000000d;padding:32px}.header-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}.header-actions[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:20px;font-weight:600;color:#1f2937}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;border:none;cursor:pointer;font-size:14px;transition:all .3s}.btn-blue[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff}.btn-blue[_ngcontent-%COMP%]:hover{background-color:#1e40af}.btn-gray[_ngcontent-%COMP%]{background-color:#e5e7eb;color:#1f2937}.btn-gray[_ngcontent-%COMP%]:hover{background-color:#d1d5db}.btn-icon[_ngcontent-%COMP%]{border:none;background:none;cursor:pointer;font-size:16px}.loader[_ngcontent-%COMP%]{text-align:center;padding:48px 0}.spinner[_ngcontent-%COMP%]{display:inline-block;width:40px;height:40px;border:4px solid #2563eb;border-bottom-color:transparent;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:12px}@keyframes spin{to{transform:rotate(360deg)}}.empty-state[_ngcontent-%COMP%]{text-align:center;color:#9ca3af;font-size:16px;padding:48px 0}.table-container[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]{background-color:#f9fafb}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:12px 15px;text-align:left;font-size:14px;border-bottom:1px solid #e5e7eb}tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]:hover{background-color:#f3f4f6}.actions[_ngcontent-%COMP%]{display:flex;gap:.5rem}.action-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;padding:6px;border:none;border-radius:6px;cursor:pointer;transition:all .2s ease}.action-btn[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{width:16px;height:16px}.edit-btn[_ngcontent-%COMP%]{background-color:#3b82f6;color:#fff}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#2563eb}.delete-btn[_ngcontent-%COMP%]{background-color:#ef4444;color:#fff}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#b91c1c}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-end;margin-top:24px}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:6px 12px;margin-left:4px;border-radius:6px;border:1px solid #d1d5db;background-color:#fff;cursor:pointer}.pagination[_ngcontent-%COMP%]   button.active[_ngcontent-%COMP%]{background-color:#2563eb;color:#fff;border:none}.pagination[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:disabled{opacity:.5;cursor:not-allowed}.modal[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:50}.modal-content-rectangle[_ngcontent-%COMP%]{width:80vw;max-width:1000px;height:75vh;background:white;border-radius:10px;padding:20px;display:flex;flex-direction:column}.modal-body.scrollable[_ngcontent-%COMP%]{overflow-y:auto;padding-right:10px;max-height:70vh}.modal-content-rectangle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .modal-content-rectangle[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border-radius:6px;border:1px solid #d1d5db;margin-bottom:16px}.modal-content-rectangle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .modal-content-rectangle[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 2px #2563eb4d}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:16px}@keyframes fadeIn{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.truncate[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}a[_ngcontent-%COMP%]{cursor:pointer}.ev-image[_ngcontent-%COMP%]{width:120px;height:120px;-o-object-fit:cover;object-fit:cover;border-radius:50%;transition:transform .2s ease;display:block}.ev-image[_ngcontent-%COMP%]:hover{transform:scale(1.1);cursor:pointer}.partenaire-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));grid-gap:12px;gap:12px;margin:10px 0}.partenaire-item[_ngcontent-%COMP%]{padding:8px;border:2px solid #ccc;border-radius:10px;text-align:center;cursor:pointer;transition:.2s}.partenaire-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:80px;-o-object-fit:contain;object-fit:contain}.partenaire-item.selected[_ngcontent-%COMP%]{border-color:#007bff;background:#e5f1ff}.container-formulaire[_ngcontent-%COMP%]{max-height:90vh;overflow-y:auto;padding-right:10px}.landscape[_ngcontent-%COMP%]{width:100vh;height:100vw;transform:rotate(90deg);transform-origin:left top;position:absolute;top:0;left:0}\"]\n  });\n  return SousFormationKeejobComponent;\n})();","map":null,"metadata":{},"sourceType":"module"}