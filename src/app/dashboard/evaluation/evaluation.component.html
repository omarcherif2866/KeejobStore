<div class="app-container">
  <!-- Sidebar -->
  <div [class]="sidebarOpen ? 'sidebar open' : 'sidebar'">
    <div class="sidebar-content">
      <h2>Admin Panel</h2>
      <nav>
        <a href="#">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
          </svg>
          <span>Dashboard</span>
        </a>
        <a href="actualites">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
          </svg>
          <span>Actualit√©s</span>
        </a>
        <a href="formateurs">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Formateurs</span>
        </a>
        <a href="evaluations">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Evaluations</span>
        </a>     
        <a href="formationFormateur">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Mes formations</span>
        </a>       
        <a href="serviceFormateur">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Mes services</span>
        </a>       
        <a href="partenaire">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Partenaires</span>
        </a> 
        <a href="formationKeejob">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Formations Keejob</span>
        </a>
        <a href="cv">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>CV et Lettre de motivations</span>
        </a>    
        <a href="coaching">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
          </svg>
          <span>Coaching Emploi</span>
        </a>       
        <a (click)="logout(); $event.preventDefault()">
          <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <span>Se d√©connecter</span>
        </a>
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-area">
    <header>
      <button (click)="toggleSidebar()" class="sidebar-toggle">
        <svg class="icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
      <h1>Gestion des Evaluations</h1>
      <div class="spacer"></div>
    </header>

    <main>
      <div class="content-box">
        <div class="header-actions">
          <h2>Liste des Evaluations</h2>
          <button (click)="handleAdd()" class="btn btn-blue">
            <span>Ajouter</span>
          </button>
        </div>

        <!-- Loader -->
        <div *ngIf="loading" class="loader">
          <div class="spinner"></div>
          <p>Chargement des Evaluations...</p>
        </div>

        <!-- Empty State -->
        <div *ngIf="!loading && evaluations.length === 0" class="empty-state">
          Aucun ev disponible
        </div>

        <!-- Table -->
<div *ngIf="!loading && evaluations.length > 0" class="table-container">
  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Logo</th>
        <th>Nom</th>
        <th>Description</th>
        <th>Cat√©gorie</th> <!-- NOUVELLE COLONNE -->
        <th>Sections</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let evaluation of currentItems">
        <td>{{evaluation.Id}}</td>
        <td>
          <img [src]="sanitizeImage(evaluation.Logo)" alt="Photo evaluation" class="ev-image" />
        </td>
        <td>{{evaluation.Name}}</td>
        <td>{{evaluation.Description}}</td>
        <td>
          <!-- NOUVELLE CELLULE POUR LA CAT√âGORIE -->
          <span class="category-badge-table" *ngIf="evaluation.Category">
            {{ evaluation.Category }}
          </span>
          <span class="category-badge-table no-category" *ngIf="!evaluation.Category">
            Non d√©finie
          </span>
        </td>
        <td>
          <span class="badge">{{ evaluation.Sections?.length || 0 }} section(s)</span>
        </td>
        <td class="actions">
          <button (click)="handleEdit(evaluation)" class="action-btn edit-btn" title="Modifier l'√©valuation">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
            </svg>
          </button>

          <button (click)="handleDelete(evaluation.Id)" class="action-btn delete-btn" title="Supprimer l'√©valuation">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>


        <!-- Pagination -->
        <div *ngIf="!loading && evaluations.length > 0" class="pagination">
          <button (click)="handlePageChange(currentPage - 1)" [disabled]="currentPage === 1">‚óÄ</button>
          <button *ngFor="let page of pagesArray" (click)="handlePageChange(page)" 
                  [class.active]="currentPage === page">{{page}}</button>
          <button (click)="handlePageChange(currentPage + 1)" [disabled]="currentPage === totalPages">‚ñ∂</button>
        </div>
      </div>
    </main>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal">
  <div class="modal-content-large">
    <h3>{{modalMode === 'add' ? 'Ajouter une √©valuation' : 'Modifier l\'√©valuation'}}</h3>

    <!-- Stepper Header -->
    <div class="stepper-header">
      <!-- Step 1 -->
      <div class="step" [class.active]="currentModalStep === 1" [class.completed]="currentModalStep > 1">
        <div class="step-circle" (click)="goToModalStep(1)">
          <span *ngIf="currentModalStep > 1">‚úì</span>
          <span *ngIf="currentModalStep <= 1">1</span>
        </div>
        <div class="step-label">Informations</div>
      </div>

      <div class="step-line" [class.completed]="currentModalStep > 1"></div>

      <!-- Step 2 -->
      <div class="step" [class.active]="currentModalStep === 2" [class.completed]="currentModalStep > 2">
        <div class="step-circle" (click)="goToModalStep(2)">
          <span *ngIf="currentModalStep > 2">‚úì</span>
          <span *ngIf="currentModalStep <= 2">2</span>
        </div>
        <div class="step-label">Section 1</div>
      </div>

      <div class="step-line" [class.completed]="currentModalStep > 2"></div>

      <!-- Step 3 -->
      <div class="step" [class.active]="currentModalStep === 3" [class.completed]="currentModalStep > 3">
        <div class="step-circle" (click)="goToModalStep(3)">
          <span *ngIf="currentModalStep > 3">‚úì</span>
          <span *ngIf="currentModalStep <= 3">3</span>
        </div>
        <div class="step-label">Section 2</div>
      </div>

      <div class="step-line" [class.completed]="currentModalStep > 3"></div>

      <!-- Step 4 -->
      <div class="step" [class.active]="currentModalStep === 4" [class.completed]="currentModalStep > 4">
        <div class="step-circle" (click)="goToModalStep(4)">
          <span *ngIf="currentModalStep > 4">‚úì</span>
          <span *ngIf="currentModalStep <= 4">4</span>
        </div>
        <div class="step-label">Section 3</div>
      </div>

      <div class="step-line" [class.completed]="currentModalStep > 4"></div>

      <!-- Step 5 -->
      <div class="step" [class.active]="currentModalStep === 5" [class.completed]="currentModalStep > 5">
        <div class="step-circle" (click)="goToModalStep(5)">
          <span *ngIf="currentModalStep > 5">‚úì</span>
          <span *ngIf="currentModalStep <= 5">5</span>
        </div>
        <div class="step-label">Section 4</div>
      </div>

  <div class="step-line" [class.completed]="currentModalStep > 5"></div>
  <div class="step" [class.active]="currentModalStep === 6" [class.completed]="currentModalStep > 6">
    <div class="step-circle" (click)="goToModalStep(6)">
      <span *ngIf="currentModalStep > 6">‚úì</span>
      <span *ngIf="currentModalStep <= 6">6</span>
    </div>
    <div class="step-label">Partenaires</div>
  </div>
  
  <!-- Step 7: Catalogues -->
  <div class="step-line" [class.completed]="currentModalStep > 6"></div>
  <div class="step" [class.active]="currentModalStep === 7" [class.completed]="currentModalStep > 7">
    <div class="step-circle" (click)="goToModalStep(7)">
      <span *ngIf="currentModalStep > 7">‚úì</span>
      <span *ngIf="currentModalStep <= 7">7</span>
    </div>
    <div class="step-label">Catalogues</div>
  </div>
</div>

<!-- Progress Indicator - Mettre √† jour pour 7 steps -->
<div class="progress-indicator">
  <div class="progress-text">√âtape {{ currentModalStep }} sur 7</div>
  <div class="progress-bar">
    <div class="progress-fill" [style.width.%]="(currentModalStep / 7) * 100"></div>
  </div>
</div>      

    <!-- Stepper Content -->
    <div class="modal-body scrollable">
      
      <!-- STEP 1: Informations g√©n√©rales -->
      <div *ngIf="currentModalStep === 1" class="step-content">
        <h4>üìã Informations de base</h4>

        <label>Nom *</label>
        <input type="text" 
               [(ngModel)]="formData.name" 
               placeholder="Entrez le nom de l'√©valuation"
               class="form-input">

        <label>Description</label>
        <textarea [(ngModel)]="formData.description" 
                  rows="4" 
                  placeholder="D√©crivez l'objectif de cette √©valuation"
                  class="form-input"></textarea>

  <label>Cat√©gorie d'√©valuation *</label>
  <select [(ngModel)]="formData.evaluationCategory" class="form-input category-select">
    <option [ngValue]="null" disabled>-- S√©lectionnez une cat√©gorie --</option>
<option *ngFor="let category of availableEvaluationCategories" [ngValue]="category">
  {{ formatCategory(category) }}
</option>

  </select>
  <small class="form-text">Choisissez le type d'√©valuation</small>

  <!-- Aper√ßu de la cat√©gorie s√©lectionn√©e -->
  <div *ngIf="formData.evaluationCategory" class="selected-category-preview">
    <span class="category-badge-large">
      {{ formData.evaluationCategory }}
    </span>
  </div>


        <label>Logo *</label>
        <input 
          type="file" 
          id="image" 
          class="form-input"
          accept="image/*"
          (change)="onLogoSelected($event)">
        <small class="form-text">Formats accept√©s: JPG, PNG, GIF (Max 5MB)</small>
        
        <div *ngIf="selectedLogo" class="selected-file">
          <p>‚úì Image s√©lectionn√©e: {{ selectedLogo.name }}</p>
        </div>

        <div *ngIf="modalMode === 'edit' && formData.image && !selectedImage" class="current-image">
          <p>Logo actuel:</p>
          <img [src]="sanitizeImage(formData.logo)" alt="Logo actuel" style="max-width: 60px; border-radius: 8px;">
        </div>

        <label>Image *</label>
        <input 
          type="file" 
          id="image" 
          class="form-input"
          accept="image/*"
          (change)="onImageSelected($event)">
        <small class="form-text">Formats accept√©s: JPG, PNG, GIF (Max 5MB)</small>
        
        <div *ngIf="selectedImage" class="selected-file">
          <p>‚úì Image s√©lectionn√©e: {{ selectedImage.name }}</p>
        </div>

        <div *ngIf="modalMode === 'edit' && formData.image && !selectedImage" class="current-image">
          <p>Image actuelle:</p>
          <img [src]="sanitizeImage(formData.image)" alt="Image actuelle" style="max-width: 100px; border-radius: 8px;">
        </div>
      </div>

      <!-- STEP 2: Section 1 -->
<div *ngIf="currentModalStep === 2" class="step-content">
  <h4>üìä Section 1</h4>
  
  <div class="section-card">
    <label>Titre principal (Headline) *</label>
    <input type="text" 
           [(ngModel)]="sections[0].headline" 
           placeholder="Ex: Comp√©tences techniques"
           class="form-input">

    <label>Sous-titre</label>
    <input type="text" 
           [(ngModel)]="sections[0].subtitle" 
           placeholder="Ex: √âvaluation des comp√©tences en programmation"
           class="form-input">

    <!-- D√©tails -->
    <div class="details-section">
      <div class="details-header">
        <h5>D√©tails de la section</h5>
      </div>

      <div *ngFor="let detail of sections[0].details; let i = index" class="detail-card">
        <div class="detail-header">
          <span class="detail-number">D√©tail #{{ i + 1 }}</span>
        </div>

        <label>Titre *</label>
        <input type="text" 
               [(ngModel)]="detail.titre" 
               placeholder="Ex: JavaScript"
               class="form-input">

        <label>Description</label>
        <textarea [(ngModel)]="detail.description" 
                  rows="2" 
                  placeholder="Ex: Ma√Ætrise du langage JavaScript et ses frameworks"
                  class="form-input"></textarea>

        <!-- Upload d'ic√¥ne -->
        <label>Ic√¥ne * (Image)</label>
        <div class="icon-upload-section">
          <!-- Preview de l'ic√¥ne -->
          <div *ngIf="isImageIcon(detail.icon)" class="icon-preview">
            <img [src]="getIconPreview(detail.icon)" alt="Icon preview" class="icon-thumbnail">
            <button type="button" 
                    (click)="removeIcon(detail)" 
                    class="btn-remove-icon"
                    title="Supprimer l'ic√¥ne">
              ‚úï
            </button>
          </div>

          <!-- Input file pour upload -->
          <div class="file-input-wrapper">
            <input type="file" 
                   (change)="onIconSelected($event, detail)" 
                   accept="image/*"
                   [id]="'icon-input-0-' + i"
                   class="file-input">
            <label [for]="'icon-input-0-' + i" class="file-label">
              <span class="file-icon">üìÅ</span>
              <span>{{ detail.icon ? 'Changer l\'ic√¥ne' : 'Choisir une ic√¥ne' }}</span>
            </label>
          </div>
          
          <small class="form-text">Format accept√©: JPG, PNG, SVG (Max 2MB)</small>
        </div>

        <div class="detail-header">
          <button type="button" 
                  (click)="removeDetailFromSection(0, i)" 
                  class="btn-icon btn-danger"
                  title="Supprimer ce d√©tail">
            üóëÔ∏è
          </button>
        </div>
      </div>

      <div *ngIf="sections[0].details.length === 0" class="no-details">
        <p>Aucun d√©tail ajout√©. Cliquez sur "+ Ajouter un d√©tail" pour commencer.</p>
      </div>
    </div>
    
    <div class="details-header">
      <button type="button" (click)="addDetailToSection(0)" class="btn btn-sm btn-blue">
        + Ajouter un d√©tail
      </button>
    </div>
  </div>
</div>

      <!-- STEP 3: Section 2 -->
      <div *ngIf="currentModalStep === 3" class="step-content">
        <h4>üìà Section 2</h4>
        
        <div class="section-card">
          <label>Titre principal (Headline) *</label>
          <input type="text" 
                 [(ngModel)]="sections[1].headline" 
                 placeholder="Ex: Soft Skills"
                 class="form-input">

          <label>Sous-titre</label>
          <input type="text" 
                 [(ngModel)]="sections[1].subtitle" 
                 placeholder="Ex: Communication et travail d'√©quipe"
                 class="form-input">

          <!-- D√©tails -->
          <div class="details-section">
            <div class="details-header">
              <h5>D√©tails de la section</h5>
              <!-- <button type="button" (click)="addDetailToSection(1)" class="btn btn-sm btn-blue">
                + Ajouter un d√©tail
              </button> -->
            </div>

            <div *ngFor="let detail of sections[1].details; let i = index" class="detail-card">
              <div class="detail-header">
                <span class="detail-number">D√©tail #{{ i + 1 }}</span>
                <!-- <button type="button" 
                        (click)="removeDetailFromSection(1, i)" 
                        class="btn-icon btn-danger"
                        title="Supprimer ce d√©tail">
                  üóëÔ∏è
                </button> -->
              </div>

              <label>Titre *</label>
              <input type="text" 
                     [(ngModel)]="detail.titre" 
                     placeholder="Ex: Communication"
                     class="form-input">

              <label>Description</label>
              <textarea [(ngModel)]="detail.description" 
                        rows="2" 
                        placeholder="Ex: Capacit√© √† communiquer efficacement"
                        class="form-input"></textarea>

              <label>Ic√¥ne * (Image)</label>
              <div class="icon-upload-section">
                <!-- Preview de l'ic√¥ne -->
                <div *ngIf="isImageIcon(detail.icon)" class="icon-preview">
                  <img [src]="getIconPreview(detail.icon)" alt="Icon preview" class="icon-thumbnail">
                  <button type="button" 
                          (click)="removeIcon(detail)" 
                          class="btn-remove-icon"
                          title="Supprimer l'ic√¥ne">
                    ‚úï
                  </button>
                </div>

                <!-- Input file pour upload -->
                <div class="file-input-wrapper">
                  <input type="file" 
                        (change)="onIconSelected($event, detail)" 
                        accept="image/*"
                        [id]="'icon-input-0-' + i"
                        class="file-input">
                  <label [for]="'icon-input-0-' + i" class="file-label">
                    <span class="file-icon">üìÅ</span>
                    <span>{{ detail.icon ? 'Changer l\'ic√¥ne' : 'Choisir une ic√¥ne' }}</span>
                  </label>
                </div>
                
                <small class="form-text">Format accept√©: JPG, PNG, SVG (Max 2MB)</small>
              </div>

              <div class="detail-header">
                <button type="button" 
                        (click)="removeDetailFromSection(1, i)" 
                        class="btn-icon btn-danger"
                        title="Supprimer ce d√©tail">
                  üóëÔ∏è
                </button>
              </div>
            </div>

            <div *ngIf="sections[1].details.length === 0" class="no-details">
              <p>Aucun d√©tail ajout√©. Cliquez sur "+ Ajouter un d√©tail" pour commencer.</p>
            </div>
          </div>
            <div class="details-header">
              <button type="button" (click)="addDetailToSection(1)" class="btn btn-sm btn-blue">
                + Ajouter un d√©tail
              </button>
            </div>
        </div>
      </div>

      <!-- STEP 4: Section 3 -->
      <div *ngIf="currentModalStep === 4" class="step-content">
        <h4>üéØ Section 3</h4>
        
        <div class="section-card">
          <label>Titre principal (Headline) *</label>
          <input type="text" 
                 [(ngModel)]="sections[2].headline" 
                 placeholder="Ex: Gestion de projet"
                 class="form-input">

          <label>Sous-titre *</label>
          <input type="text" 
                 [(ngModel)]="sections[2].subtitle" 
                 placeholder="Ex: Planification et organisation"
                 class="form-input">

          <!-- D√©tails -->
          <div class="details-section">
            <div class="details-header">
              <h5>D√©tails de la section</h5>
              <!-- <button type="button" (click)="addDetailToSection(2)" class="btn btn-sm btn-blue">
                + Ajouter un d√©tail
              </button> -->
            </div>

            <div *ngFor="let detail of sections[2].details; let i = index" class="detail-card">
              <div class="detail-header">
                <span class="detail-number">D√©tail #{{ i + 1 }}</span>
                <!-- <button type="button" 
                        (click)="removeDetailFromSection(2, i)" 
                        class="btn-icon btn-danger"
                        title="Supprimer ce d√©tail">
                  üóëÔ∏è
                </button> -->
              </div>

              <label>Titre *</label>
              <input type="text" 
                     [(ngModel)]="detail.titre" 
                     placeholder="Ex: Planification"
                     class="form-input">

              <label>Description</label>
              <textarea [(ngModel)]="detail.description" 
                        rows="2" 
                        placeholder="Ex: Capacit√© √† planifier et organiser les t√¢ches"
                        class="form-input"></textarea>

              <label>Ic√¥ne * (Image)</label>
              <div class="icon-upload-section">
                <!-- Preview de l'ic√¥ne -->
                <div *ngIf="isImageIcon(detail.icon)" class="icon-preview">
                  <img [src]="getIconPreview(detail.icon)" alt="Icon preview" class="icon-thumbnail">
                  <button type="button" 
                          (click)="removeIcon(detail)" 
                          class="btn-remove-icon"
                          title="Supprimer l'ic√¥ne">
                    ‚úï
                  </button>
                </div>

                <!-- Input file pour upload -->
                <div class="file-input-wrapper">
                  <input type="file" 
                        (change)="onIconSelected($event, detail)" 
                        accept="image/*"
                        [id]="'icon-input-0-' + i"
                        class="file-input">
                  <label [for]="'icon-input-0-' + i" class="file-label">
                    <span class="file-icon">üìÅ</span>
                    <span>{{ detail.icon ? 'Changer l\'ic√¥ne' : 'Choisir une ic√¥ne' }}</span>
                  </label>
                </div>
                
                <small class="form-text">Format accept√©: JPG, PNG, SVG (Max 2MB)</small>
              </div>
              <div class="detail-header">
                <button type="button" 
                        (click)="removeDetailFromSection(3, i)" 
                        class="btn-icon btn-danger"
                        title="Supprimer ce d√©tail">
                  üóëÔ∏è
                </button>
              </div>
            </div>

            <div *ngIf="sections[2].details.length === 0" class="no-details">
              <p>Aucun d√©tail ajout√©. Cliquez sur "+ Ajouter un d√©tail" pour commencer.</p>
            </div>
          </div>
             <div class="details-header">
              <button type="button" (click)="addDetailToSection(2)" class="btn btn-sm btn-blue">
                + Ajouter un d√©tail
              </button>
            </div>         
        </div>
      </div>

      <!-- STEP 5: Section 4 -->
<!-- STEP 5: Section 4 avec Category -->
<div *ngIf="currentModalStep === 5" class="step-content">
  <h4>‚ú® Section 4</h4>
  
  <div class="section-card">
    <label>Titre principal (Headline) *</label>
    <input type="text" 
           [(ngModel)]="sections[3].headline" 
           placeholder="Ex: Innovation et cr√©ativit√©"
           class="form-input">

    <label>Sous-titre *</label>
    <input type="text" 
           [(ngModel)]="sections[3].subtitle" 
           placeholder="Ex: Capacit√© √† proposer des solutions innovantes"
           class="form-input">

    <!-- D√©tails -->
    <div class="details-section">
      <div class="details-header">
        <h5>D√©tails de la section</h5>
        <!-- <button type="button" (click)="addDetailToSection(3)" class="btn btn-sm btn-blue">
          + Ajouter un d√©tail
        </button> -->
      </div>

      <div *ngFor="let detail of sections[3].details; let i = index" class="detail-card">
        <div class="detail-header">
          <span class="detail-number">D√©tail #{{ i + 1 }}</span>
          <!-- <button type="button" 
                  (click)="removeDetailFromSection(3, i)" 
                  class="btn-icon btn-danger"
                  title="Supprimer ce d√©tail">
            üóëÔ∏è
          </button> -->
        </div>

        <label>Titre *</label>
        <input type="text" 
               [(ngModel)]="detail.titre" 
               placeholder="Ex: Cr√©ativit√©"
               class="form-input">

        <label>Description</label>
        <textarea [(ngModel)]="detail.description" 
                  rows="2" 
                  placeholder="Ex: Capacit√© √† proposer des id√©es innovantes"
                  class="form-input"></textarea>

        <label>Ic√¥ne * (Image)</label>
        <div class="icon-upload-section">
          <!-- Preview de l'ic√¥ne -->
          <div *ngIf="isImageIcon(detail.icon)" class="icon-preview">
            <img [src]="getIconPreview(detail.icon)" alt="Icon preview" class="icon-thumbnail">
            <button type="button" 
                    (click)="removeIcon(detail)" 
                    class="btn-remove-icon"
                    title="Supprimer l'ic√¥ne">
              ‚úï
            </button>
          </div>

          <!-- Input file pour upload -->
          <div class="file-input-wrapper">
            <input type="file" 
                   (change)="onIconSelected($event, detail)" 
                   accept="image/*"
                   [id]="'icon-input-0-' + i"
                   class="file-input">
            <label [for]="'icon-input-0-' + i" class="file-label">
              <span class="file-icon">üìÅ</span>
              <span>{{ detail.icon ? 'Changer l\'ic√¥ne' : 'Choisir une ic√¥ne' }}</span>
            </label>
          </div>
          
          <small class="form-text">Format accept√©: JPG, PNG, SVG (Max 2MB)</small>
        </div>

        <!-- NOUVEAU: Champ Category -->
        <label>Cat√©gorie </label>
        <div class="category-selector">
          <select [(ngModel)]="detail.category" class="form-input">
            <option [ngValue]="null">-- S√©lectionnez une cat√©gorie --</option>
            <option *ngFor="let cat of getAllCategories()" [ngValue]="cat">
              {{ cat }}
            </option>
          </select>
          <button type="button" 
                  (click)="addCustomCategory(3, i)" 
                  class="btn btn-sm btn-outline"
                  title="Ajouter une cat√©gorie personnalis√©e">
            + Nouvelle cat√©gorie
          </button>
        </div>
        
        <div *ngIf="detail.category" class="selected-category">
          <span class="category-badge">üìÇ {{ detail.category }}</span>
        </div>

        <div class="detail-header">
          <button type="button" 
                  (click)="removeDetailFromSection(3, i)" 
                  class="btn-icon btn-danger"
                  title="Supprimer ce d√©tail">
            üóëÔ∏è
          </button>
        </div>        
      </div>

      <div *ngIf="sections[3].details.length === 0" class="no-details">
        <p>Aucun d√©tail ajout√©. Cliquez sur "+ Ajouter un d√©tail" pour commencer.</p>
      </div>
    </div>
      <div class="details-header">
        <button type="button" (click)="addDetailToSection(3)" class="btn btn-sm btn-blue">
          + Ajouter un d√©tail
        </button>
      </div>
  </div>

  <!-- R√©sum√© final -->
  <div class="summary-box">
    <h5>üìù R√©sum√© de votre √©valuation</h5>
    <div class="summary-item">
      <strong>Nom:</strong> {{ formData.name || 'Non renseign√©' }}
    </div>
    <div class="summary-item">
      <strong>Description:</strong> {{ formData.description || 'Non renseign√©e' }}
    </div>
    <div class="summary-item">
      <strong>Sections compl√©t√©es:</strong> 
      {{ countCompletedSections() }} / 4
    </div>
    <div class="summary-item">
      <strong>Total de d√©tails:</strong> 
      {{ sections[0].details.length + sections[1].details.length + sections[2].details.length + sections[3].details.length }}
    </div>
  </div>
</div>


<div *ngIf="currentModalStep === 6" class="step-content">
  <h4>ü§ù Partenaires</h4>
  
  <div class="partners-section">
    <div class="section-header">
      <p class="section-description">
        S√©lectionnez les partenaires associ√©s √† cette √©valuation
      </p>
    </div>

    <!-- Liste des partenaires disponibles -->
    <div class="partners-grid">
      <div *ngFor="let partenaire of allPartenaires" 
          class="partner-card"
          [class.selected]="isPartenaireSelected(partenaire)"
          (click)="togglePartenaireSelection(partenaire)">
        
        <input type="checkbox" 
              [checked]="isPartenaireSelected(partenaire)">
        
        <div class="partner-image">
          <img [src]="sanitizeImage(partenaire.image)" [alt]="partenaire.name">
        </div>
        
        <div class="partner-info">
          <h5>{{ partenaire.name }}</h5>
        </div>
      </div>
      <div *ngIf="allPartenaires.length === 0" class="no-partners">
        <p>Aucun partenaire disponible</p>
      </div>
    </div>

    <!-- R√©sum√© des partenaires s√©lectionn√©s -->
    <div *ngIf="selectedPartenaires.length > 0" class="selected-partners-summary">
      <h5>‚úì Partenaires s√©lectionn√©s ({{ selectedPartenaires.length }})</h5>
      <div class="selected-chips">
        <span *ngFor="let p of selectedPartenaires" class="partner-chip">
          {{ p.Name }}
          <button type="button" 
                  (click)="togglePartenaireSelection(p)" 
                  class="chip-remove">√ó</button>
        </span>
      </div>
    </div>
    
    <div *ngIf="selectedPartenaires.length === 0" class="info-box">
      <p>‚ÑπÔ∏è Aucun partenaire s√©lectionn√©. Vous pouvez continuer sans s√©lectionner de partenaires.</p>
    </div>
  </div>
</div>


<div *ngIf="currentModalStep === 7" class="step-content">
  <h4>üìö Catalogues</h4>
  
  <div class="catalogues-section">
    <div class="section-header">
      <p class="section-description">
        Ajoutez des catalogues associ√©s √† cette √©valuation (brochures, documents...)
      </p>
      <!-- <button type="button" (click)="addCatalogue()" class="btn btn-blue">
        + Ajouter un catalogue
      </button> -->
    </div>

    <!-- Liste des catalogues -->
    <div class="catalogues-list">
      <div *ngFor="let catalogue of catalogues; let i = index" class="catalogue-card">
        <div class="catalogue-header">
          <span class="catalogue-number">Catalogue #{{ i + 1 }}</span>
          <!-- <button type="button" 
                  (click)="removeCatalogue(i)" 
                  class="btn-icon btn-danger"
                  title="Supprimer ce catalogue">
            üóëÔ∏è
          </button> -->
        </div>
        
        <div class="catalogue-body">
          <div class="catalogue-field">
            <label>Titre du catalogue *</label>
            <input type="text" 
                   [(ngModel)]="catalogue.title" 
                   placeholder="Ex: Catalogue des formations 2024"
                   class="form-input">
          </div>
          
          <div class="catalogue-field">
            <label>Image du catalogue *</label>
            <input type="file" 
                   class="form-input" 
                   accept="image/*"
                   (change)="onCatalogueImageSelected($event, i)">
            <small class="form-text">Formats accept√©s: JPG, PNG (Max 5MB)</small>
          </div>
          
          <!-- Aper√ßu de l'image -->
          <div *ngIf="catalogue.imagePreview" class="catalogue-preview">
            <img [src]="catalogue.imagePreview" 
                 alt="Aper√ßu"
                 class="preview-image">
          </div>
        </div>

        <div class="catalogue-header">
          <button type="button" 
                  (click)="removeCatalogue(i)" 
                  class="btn-icon btn-danger"
                  title="Supprimer ce catalogue">
            üóëÔ∏è
          </button>
        </div>

      </div>
      
      <div *ngIf="catalogues.length === 0" class="no-catalogues">
        <p>Aucun catalogue ajout√©. Cliquez sur "+ Ajouter un catalogue" pour commencer.</p>
      </div>
    </div>

    <!-- R√©sum√© final de l'√©valuation -->
    <div class="summary-box">
      <h5>üìù R√©sum√© complet de votre √©valuation</h5>
      <div class="summary-grid">
        <div class="summary-item">
          <strong>Nom:</strong> {{ formData.name || 'Non renseign√©' }}
        </div>
        <div class="summary-item">
          <strong>Description:</strong> {{ formData.description || 'Non renseign√©e' }}
        </div>
        <div class="summary-item">
          <strong>Sections compl√©t√©es:</strong> {{ countCompletedSections() }} / 4
        </div>
        <div class="summary-item">
          <strong>Total de d√©tails:</strong> 
          {{ sections[0].details.length + sections[1].details.length + 
             sections[2].details.length + sections[3].details.length }}
        </div>
        <div class="summary-item">
          <strong>Partenaires:</strong> {{ selectedPartenaires.length }}
        </div>
        <div class="summary-item">
          <strong>Catalogues:</strong> {{ catalogues.length }}
        </div>
      </div>
    </div>
  </div>
      <div class="section-header">
      <button type="button" (click)="addCatalogue()" class="btn btn-blue">
        + Ajouter un catalogue
      </button>
    </div>
</div>
    </div>

    <!-- Modal Actions -->
<div class="modal-actions">
  <div class="actions-left">
    <button *ngIf="currentModalStep > 1" 
            (click)="previousModalStep()" 
            class="btn btn-gray">
      ‚Üê Pr√©c√©dent
    </button>
  </div>
  <div class="actions-right">
    <button (click)="closeModal()" class="btn btn-gray">Annuler</button>
    <button *ngIf="currentModalStep < 7" 
            (click)="nextModalStep()" 
            class="btn btn-blue">
      Suivant ‚Üí
    </button>
    <button *ngIf="currentModalStep === 7" 
            (click)="handleSubmit()" 
            class="btn btn-success">
      {{modalMode === 'add' ? '‚úì Cr√©er l\'√©valuation' : '‚úì Enregistrer les modifications'}}
    </button>
  </div>
</div>
  </div>
</div>

