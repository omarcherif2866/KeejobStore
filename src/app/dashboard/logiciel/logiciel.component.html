<!-- ======================== MODE INLINE (dans le modal parent) ======================== -->
<div *ngIf="displayMode === 'inline'">
  <!-- Formulaire TOUJOURS VISIBLE en mode inline -->
  <div class="modal-content-rectangle" style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
    <h4 style="margin-bottom: 15px;">{{ modalMode === 'add' ? 'Ajouter un logiciel' : 'Modifier le logiciel' }}</h4>
    
    <label>Nom du logiciel *</label>
    <input type="text" 
           placeholder="Entrez le nom du logiciel" 
           [(ngModel)]="newLogicielName" 
           class="form-input" />

    <label>Image</label>
    <input type="file" 
           (change)="onFileSelected($event)" 
           class="form-input" />

    <div *ngIf="selectedImage" class="selected-file">
      <p>✓ Image sélectionnée : {{ selectedImage.name }}</p>
    </div>

    <button (click)="addLogiciel()" class="btn btn-blue" style="margin-top: 10px;">
      {{ modalMode === 'add' ? '+ Ajouter le logiciel' : '✓ Modifier' }}
    </button>
  </div>

  <!-- Grille des logiciels existants -->
  <!-- <div class="existing-logiciels" *ngIf="!loading && logiciels?.length" style="margin-top: 20px;">
    <h4>Logiciels de cette sous-formation ({{ logiciels.length }})</h4>
    <div class="logiciel-grid">
      <div *ngFor="let log of logiciels" 
           class="logiciel-item" 
           [class.selected]="isSelected(log)">
        <img [src]="log.image || 'assets/default-software.png'" 
             [alt]="log.name">
        <p>{{ log.name }}</p>
      </div>
    </div>
  </div> -->

  <!-- Message si aucun logiciel -->
  <div *ngIf="!loading && (!logiciels || logiciels.length === 0)" class="no-data" style="margin-top: 20px;">
    <p>Aucun logiciel pour cette sous-formation. Ajoutez-en un ci-dessus !</p>
  </div>

  <!-- Loader -->
  <div *ngIf="loading" class="loader">
    <div class="spinner"></div>
    <p>Chargement des logiciels...</p>
  </div>
</div>

<!-- ======================== STEP 3 : affichage DANS STEP 3 UNIQUEMENT ======================== -->
<div *ngIf="displayMode === 'modal' && !loading && logiciels?.length && !showModal" class="existing-logiciels step3">
  <h4>Logiciels de cette sous-formation (Step 3)</h4>
  <div class="logiciel-grid">
    <div *ngFor="let log of logiciels" class="logiciel-item" 
         [class.selected]="isSelected(log)" 
         (click)="toggleLogiciel(log)">
      <img [src]="log.image || 'assets/default-software.png'" [alt]="log.name">
      <p>{{ log.name }}</p>
    </div>
  </div>
</div>

<!-- ======================== MODAL AJOUT / MODIFICATION (mode modal uniquement) ======================== -->
<div *ngIf="displayMode === 'modal' && !loading && logiciels?.length && !showModal" class="modal" (click)="closeModal()">
  <div class="modal-content-rectangle" (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="modal-header">
      <h3>{{ modalMode === 'add' ? 'Ajouter' : 'Modifier' }} un logiciel</h3>
      <button class="close-btn" (click)="closeModal()">×</button>
    </div>

    <!-- Corps du formulaire -->
    <div class="modal-body scrollable">
      <!-- Formulaire d'ajout/modification -->
      <div class="add-logiciel" style="margin-bottom: 20px;">
        <label>Nom du logiciel *</label>
        <input type="text" 
               placeholder="Nom du logiciel" 
               [(ngModel)]="newLogicielName" 
               class="form-input" />

        <label>Image</label>
        <input type="file" 
               (change)="onFileSelected($event)" 
               class="form-input" />

        <div *ngIf="selectedImage" class="selected-file">
          <p>✓ Image sélectionnée : {{ selectedImage.name }}</p>
        </div>
      </div>

      <!-- Grille des logiciels existants DANS LE MODAL -->
      <div class="existing-logiciels modal-grid" *ngIf="logiciels?.length">
        <h4>Logiciels existants</h4>
        <div class="logiciel-grid">
          <div *ngFor="let log of logiciels" 
               class="logiciel-item" 
               [class.selected]="isSelected(log)" 
               (click)="toggleLogiciel(log)">
            <img [src]="log.image || 'assets/default-software.png'" 
                 [alt]="log.name">
            <p>{{ log.name }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions du modal -->
    <div class="modal-actions">
      <button (click)="addLogiciel()" class="btn btn-blue">
        {{ modalMode === 'add' ? 'Ajouter' : 'Modifier' }}
      </button>
      <button (click)="closeModal()" class="btn btn-gray">Annuler</button>
    </div>
  </div>
</div>

<!-- ======================== LOADER (mode modal) ======================== -->
<div *ngIf="displayMode === 'modal' && loading" class="loader">
  <div class="spinner"></div>
  <p>Chargement des logiciels...</p>
</div>